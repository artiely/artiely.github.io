import{i as a,o as p,c as e,j as s,k as o}from"./app.8f9fe947.js";const l=o(`<h1 id="puppeteer-%26-pm2" tabindex="-1"><span class="prefix"></span><span class="content">puppeteer &amp; pm2</span><span class="suffix"></span></h1><h2 id="%E9%97%AE%E9%A2%981%E5%9C%A8linux%E4%B8%8Bchrome%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5" tabindex="-1"><span class="prefix"></span><span class="content">\u95EE\u98981\u5728linux\u4E0Bchrome\u542F\u52A8\u5931\u8D25</span><span class="suffix"></span></h2><p>\u5B98\u65B9\u7C7B\u4F3C\u7684 issues \u975E\u5E38\u591A\uFF0C\u5927\u591A\u6570\u89E3\u51B3\u65B9\u6CD5\u90FD\u590D\u6742\u4E14\u4E0D\u594F\u6548 \u5BF9\u4E8E\u6211\u6700\u6709\u6548\u7684\u65B9\u5F0F\u662F</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> chromium-browser chromium-codecs-ffmpeg

<span class="token function">npm</span> i puppeteer-core

</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token operator">-</span> <span class="token keyword">const</span>  puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;puppeteer&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span> <span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;puppeteer-core&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">slowMo</span><span class="token operator">:</span> <span class="token number">250</span><span class="token punctuation">,</span>
      <span class="token literal-property property">devtools</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">args</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;--no-sandbox&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;--disable-setuid-sandbox&#39;</span><span class="token punctuation">,</span><span class="token string">&#39;--use-gl=egl&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">executablePath</span><span class="token operator">:</span> <span class="token string">&#39;/usr/bin/chromium-browser&#39;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="pm2-%E6%89%A7%E8%A1%8Cpackage.json%E4%B8%AD%E7%9A%84script" tabindex="-1"><span class="prefix"></span><span class="content">pm2 \u6267\u884Cpackage.json\u4E2D\u7684script</span><span class="suffix"></span></h2><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"> <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rm -rf build &amp;&amp; pkg index.js --out-path build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;postbuild&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cp -R ./node_modules/puppeteer/.local-chromium build/chromium&quot;</span>
  <span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">pm2 start <span class="token function">npm</span> --name <span class="token string">&quot;puppeteer-pm2&quot;</span> -- run build
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u6CE8\u610F<code class="">-- run build</code> \uFF0C\u8FD9\u91CC\u7684build\u662Fpackage.json\u4E2D\u7684script\u7684build;pm2\u7684\u53C2\u6570\u5E94\u8BE5\u5728-- run \u524D\u9762</p><p>\u793A\u4F8B\u811A\u672C</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token shebang important">#!/usr/bin/env sh</span>

<span class="token comment"># abort on errors</span>
<span class="token builtin class-name">set</span> -e

<span class="token builtin class-name">cd</span> front

<span class="token function">pnpm</span> i <span class="token operator">&amp;&amp;</span>  <span class="token function">yarn</span> build

<span class="token builtin class-name">cd</span> -

<span class="token builtin class-name">cd</span> back


<span class="token function">yarn</span> <span class="token operator">&amp;&amp;</span> pm2 start index.js --name <span class="token string">&quot;backend-3003-9001&quot;</span> --max-memory-restart <span class="token string">&quot;1G&quot;</span>

<span class="token builtin class-name">cd</span> -
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-bash ext-bash code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-bash line-numbers-mode"><code class="language-bash">pm2 <span class="token function">kill</span> \u6740\u6B7B\u6240\u6709\u8FDB\u7A0B
pm2 delete <span class="token operator">&lt;</span>id<span class="token operator">&gt;</span> \u5220\u9664\u6307\u5B9A\u8FDB\u7A0B
pm2 logs \u67E5\u770B\u8FDB\u7A0B\u65E5\u5FD7
pm2 flush \u5220\u9664\u6240\u6709\u65E5\u5FD7
pm2 <span class="token function">install</span> pm2-logrotate   // \u6CE8\u610F\u662Fpm2 install\u800C\u4E0D\u662Fnpm <span class="token function">install</span>

pm2 <span class="token builtin class-name">set</span> pm2-logrotate-ext:retain <span class="token number">7</span>   //\u4FDD\u5B587\u4E2A\u6587\u4EF6
pm2 <span class="token builtin class-name">set</span> pm2-logrotate-ext:max_size 100M  //\u6BCF\u4E2A\u5907\u4EFD\u6587\u4EF6\u5927\u5C0F\u4E3A100M

</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><a href="https://www.npmjs.com/package/pm2-logrotate" target="_blank" rel="noopener">pm2-logrotate</a></p>`,13),t=[l],d={tag:["puppeteteer","pm2"],cover:"/2022-05-10-18-14-26.png",tinyCover:"/cover/2022-05-10-18-14-26.png",coverWidth:564,coverHeight:841,meta:[]},r={__name:"index",setup(c,{expose:n}){return a({meta:[]}),n({frontmatter:{tag:["puppeteteer","pm2"],cover:"/2022-05-10-18-14-26.png",tinyCover:"/cover/2022-05-10-18-14-26.png",coverWidth:564,coverHeight:841,meta:[]}}),(u,m)=>(p(),e("div",null,t))}};typeof s=="function"&&s(r);export{r as default,d as frontmatter};
