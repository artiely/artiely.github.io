import{i as a,o as p,c as e,j as s,k as t}from"./app.f76da5f1.js";const o=t(`<h1 id="pm2%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8%E4%B9%8B%E4%B8%80%E9%94%AE%E5%8F%91%E5%B8%83" tabindex="-1"><span class="prefix"></span><span class="content">pm2\u8FDB\u9636\u4F7F\u7528\u4E4B\u4E00\u952E\u53D1\u5E03</span><span class="suffix"></span></h1><h2 id="%E5%90%AF%E7%94%A8%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F" tabindex="-1"><span class="prefix"></span><span class="content">\u542F\u7528\u96C6\u7FA4\u6A21\u5F0F</span><span class="suffix"></span></h2><p>\u53EA\u9700\u8981\u5728\u542F\u52A8\u5E94\u7528\u65F6\u5E26\u4E0Ai\u53C2\u6570</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">pm2 start app.js -i max
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>max\uFF1A\u610F\u5473\u7740PM2\u5C06\u81EA\u52A8\u68C0\u6D4B\u53EF\u7528\u7684CPU\u6570\u91CF\u548C\u8FD0\u884C\u591A\u4E2A\u8FDB\u7A0B\u53EF\u4EE5\u5728\u8D1F\u8F7D\u5747\u8861\u6A21\u5F0F(\u4F46\u662F\u4E0D\u63A8\u8350\u4F7F\u7528)</p><p>\u6216\u8005\u4F7F\u7528json\u6587\u4EF6\u542F\u52A8\u7684</p><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">&quot;apps&quot;</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;script&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;api.js&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;instances&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;max&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;exec_mode&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;cluster&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>\u5F53\u7136\u8FD8\u652F\u6301js\u548Cylm\u6587\u4EF6,js\u793A\u4F8B\u5982\u4E0B <a href="http://pm2.keymetrics.io/docs/usage/application-declaration/" target="_blank" rel="noopener">\u76F8\u5173\u8D44\u6599</a></p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">apps</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span>        <span class="token operator">:</span> <span class="token string">&quot;worker&quot;</span><span class="token punctuation">,</span><span class="token comment">//\u5E94\u7528\u540D\u79F0</span>
    <span class="token literal-property property">script</span>      <span class="token operator">:</span> <span class="token string">&quot;./worker.js&quot;</span><span class="token punctuation">,</span> <span class="token comment">//\u811A\u672C\u8DEF\u5F84\u76F8\u5BF9\u4E8Epm2\u5F00\u59CB</span>
    <span class="token literal-property property">watch</span>       <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//\u5F00\u542F\u76D1\u5BDF\uFF0C\u6587\u4EF6\u6539\u53D8\u81EA\u52A8\u91CD\u542F</span>
    <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">&quot;PORT&quot;</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
      <span class="token string-property property">&quot;NODE_ENV&quot;</span><span class="token operator">:</span> <span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">env_production</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token string-property property">&quot;PORT&quot;</span><span class="token operator">:</span> <span class="token number">80</span>
       <span class="token string-property property">&quot;NODE_ENV&quot;</span><span class="token operator">:</span> <span class="token string">&quot;production&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span>       <span class="token operator">:</span> <span class="token string">&quot;api-app&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">script</span>     <span class="token operator">:</span> <span class="token string">&quot;./api.js&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cwd</span>         <span class="token operator">:</span> <span class="token string">&quot;/home/www/project_root/current&quot;</span><span class="token punctuation">,</span><span class="token comment">// </span>
    <span class="token string-property property">&quot;error_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./logs/app.err.log&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;out_file&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./logs/app.out.log&quot;</span><span class="token punctuation">,</span> 
    <span class="token string-property property">&quot;log_date_format&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;YYYY-MM-DD HH:mm Z&quot;</span>
    <span class="token literal-property property">instances</span>  <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// \u5B9E\u4F8B\uFF08\u591A\u6838\uFF09</span>
    <span class="token literal-property property">exec_mode</span>  <span class="token operator">:</span> <span class="token string">&quot;cluster&quot;</span> <span class="token comment">// \u96C6\u7FA4\u6A21\u5F0F</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>\u7136\u540E\u518D\u542F\u52A8\u8FDB\u7A0B</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">pm2 start processes.json
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u91CD\u8F7D\u5E94\u7528</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">pm2 reload <span class="token operator">&lt;</span>app_name<span class="token operator">&gt;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u6216\u8005</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">pm2 reload process.json
pm2 reload process.json --only api
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="%E4%B8%80%E9%94%AE%E5%8F%91%E5%B8%83" tabindex="-1"><span class="prefix"></span><span class="content">\u4E00\u952E\u53D1\u5E03</span><span class="suffix"></span></h2><p>yml\u7684\u4E66\u5199\u65B9\u5F0F(process.yml)</p><div class="language-yml ext-yml code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-yml line-numbers-mode"><code class="language-yml"><span class="token key atrule">apps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">script</span><span class="token punctuation">:</span> server.js
    <span class="token key atrule">name</span><span class="token punctuation">:</span> pm2 test
    <span class="token key atrule">watch</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> development
    <span class="token key atrule">env_production</span><span class="token punctuation">:</span>
      <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> production
<span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token key atrule">production</span><span class="token punctuation">:</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span> root
    <span class="token key atrule">key</span><span class="token punctuation">:</span> C<span class="token punctuation">:</span>/Windows/SSH<span class="token punctuation">-</span>ubuntu.pem <span class="token comment"># \u670D\u52A1\u5668sshkey(\u963F\u91CC\u4E91\u518D\u670D\u52A1\u5668\u955C\u50CF\u521B\u5EFA\u7684\u65F6\u5019\u4F1A\u751F\u6210 \u7136\u540E\u4FDD\u5B58\u5230\u672C\u5730)</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 120.78.174.212 <span class="token comment"># \u670D\u52A1\u5668ip</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">22</span>
    <span class="token key atrule">ref</span><span class="token punctuation">:</span> origin/master
    <span class="token key atrule">repo</span><span class="token punctuation">:</span> git@gitee.com<span class="token punctuation">:</span>artiely/pm2test.git <span class="token comment"># \u4ED3\u5E93\u5730\u5740</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /www/pm2test/production <span class="token comment"># \u53D1\u5E03\u5730\u5740</span>
    <span class="token key atrule">ssh_options</span><span class="token punctuation">:</span> StrictHostKeyChecking=no <span class="token comment"># ssh\u6743\u9650</span>
    <span class="token key atrule">pre-deploy</span><span class="token punctuation">:</span> git fetch <span class="token punctuation">-</span><span class="token punctuation">-</span>all <span class="token comment"># \u53D1\u5E03\u524D\u7684\u64CD\u4F5C</span>
    <span class="token key atrule">post-deploy</span><span class="token punctuation">:</span> <span class="token string">&#39;npm install &amp;&amp; npm run build &amp;&amp; pm2 startOrRestart process.yml --env production&#39;</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">NODE_ENV</span><span class="token punctuation">:</span> production
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>\u7B2C\u4E00\u6B21\u53D1\u5E03\u672C\u5730\u6267\u884C</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">pm2 deploy process.yml production setup
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>\u7136\u540E\u6BCF\u6B21\u53D1\u5E03\u53EA\u9700\u672C\u5730\u6267\u884C\u5982\u4E0B\u547D\u4EE4\uFF0C\u670D\u52A1\u5668\u5C31\u4F1A\u81EA\u52A8\u62C9\u53D6\u521B\u5E93\u4EE3\u7801\u5E76\u53D1\u5E03</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">pm2 deploy process.yml production
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" tabindex="-1"><span class="prefix"></span><span class="content">\u6CE8\u610F\u4E8B\u9879</span><span class="suffix"></span></h2><p>github\u4E0A\u5FC5\u987B\u6709\u670D\u52A1\u5668\u7684\u516C\u94A5\u548C\u672C\u5730\u7684\u516C\u94A5</p><p><a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/" target="_blank" rel="noopener">https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/</a></p><p>\u8FD9\u91CC\u6709\u5404\u4E2A\u7CFB\u7EDF\u751F\u6210id_rsa\u7684\u65B9\u6CD5</p><p>1.\u670D\u52A1\u5668node\u7248\u672C\u5C3D\u91CF\u4F7F\u7528\u6700\u9AD8\u7A33\u5B9A\u7248 2.devDependencies\u91CC\u7684\u4EE3\u7801\u5728\u53D1\u5E03\u65F6\u4E0D\u4F1A\u88AB\u4E0B\u8F7D\u5B89\u88C5\uFF0C\u5982\u6709\u9700\u8981\u8BF7\u79FB\u52A8\u5230dependencies 3.\u5982\u679C\u51FA\u73B0Host key verification failed. \u89E3\u51B3\u65B9\u6848</p><ol><li><p>\u5220\u9664~/.ssh/known_hosts \u6587\u4EF6\u4E2D\u5305\u542B&quot;gitlab.xxx.com&quot;\u8FD9\u4E00\u884C\u7684\u8BB0\u5F55</p></li><li><p>\u5220\u9664~/.ssh/known_hosts\u6574\u4E2A\u6587\u4EF6</p></li><li><p>\u4FEE\u6539open ssh\u914D\u7F6E\u6587\u4EF6\uFF0C\u5B89\u5168\u7EA7\u522B\u8C03\u4F4E\uFF08\u4E0D\u63A8\u8350\uFF0C\u4EC5\u9650\u5185\u7F51\u7B49\u5B89\u5168\u7EA7\u522B\u8F83\u9AD8\u7684\u73AF\u5883\uFF0C\u516C\u7F51\u4E0D\u8981\u4F7F\u7528\uFF09</p></li></ol><p>SSH\u5BF9\u4E3B\u673A\u7684public_key\u7684\u68C0\u67E5\u7B49\u7EA7\u662F\u6839\u636EStrictHostKeyChecking\u53D8\u91CF\u6765\u914D\u7F6E\u7684\u3002\u53EF\u4EE5\u901A\u8FC7\u964D\u4F4E\u5B89\u5168\u7EA7\u522B\u7684\u65B9\u5F0F\uFF0C\u6765\u51CF\u5C11\u8FD9\u4E00\u7C7B\u63D0\u793A\u3002</p><p>\u4FEE\u6539\u65B9\u6CD5\uFF1A \u7F16\u8F91~/.ssh/config\uFF08\u4EE3\u8868\u4E2A\u4EBA\u914D\u7F6E\uFF0C\u6216/etc/ssh/ssh_config\uFF0C\u4EE3\u8868\u5168\u5C40\u914D\u7F6E\uFF09 \u6DFB\u52A0\u4EE5\u4E0B\u884C Shell\u4EE3\u7801 \u6536\u85CF\u4EE3\u7801 StrictHostKeyChecking no<br> UserKnownHostsFile /dev/null # \u4E3A\u4E86\u66F4\u7B80\u5316\uFF0C\u628Aknown_hosts\u4E5F\u7701\u7565\u6389\u4E86</p><p>\u4E0B\u9762\u9644\u4E0AStrictHostKeyChecking\u914D\u7F6E\u9879\u7684\u8BF4\u660E\u3002 StrictHostKeyChecking=no \u6700\u4E0D\u5B89\u5168\u7684\u7EA7\u522B\uFF0C\u5F53\u7136\u4E5F\u6CA1\u6709\u90A3\u4E48\u591A\u70E6\u4EBA\u7684\u63D0\u793A\u4E86\uFF0C\u76F8\u5BF9\u5B89\u5168\u7684\u5185\u7F51\u6D4B\u8BD5\u65F6\u5EFA\u8BAE\u4F7F\u7528\u3002\u5982\u679C\u8FDE\u63A5server\u7684key\u5728\u672C\u5730\u4E0D\u5B58\u5728\uFF0C\u90A3\u4E48\u5C31\u81EA\u52A8\u6DFB\u52A0\u5230\u6587\u4EF6\u4E2D\uFF08\u9ED8\u8BA4\u662Fknown_hosts\uFF09\uFF0C\u5E76\u4E14\u7ED9\u51FA\u4E00\u4E2A\u8B66\u544A\u3002 StrictHostKeyChecking=ask \u9ED8\u8BA4\u7684\u7EA7\u522B\uFF0C\u5C31\u662F\u51FA\u73B0\u521A\u624D\u7684\u63D0\u793A\u4E86\u3002\u5982\u679C\u8FDE\u63A5\u548Ckey\u4E0D\u5339\u914D\uFF0C\u7ED9\u51FA\u63D0\u793A\uFF0C\u5E76\u62D2\u7EDD\u767B\u5F55\u3002 StrictHostKeyChecking=yes \u6700\u5B89\u5168\u7684\u7EA7\u522B\uFF0C\u5982\u679C\u8FDE\u63A5\u4E0Ekey\u4E0D\u5339\u914D\uFF0C\u5C31\u62D2\u7EDD\u8FDE\u63A5\uFF0C\u4E0D\u4F1A\u63D0\u793A\u8BE6\u7EC6\u4FE1\u606F\u3002</p><h2 id="%E6%9C%80%E5%90%8E" tabindex="-1"><span class="prefix"></span><span class="content">\u6700\u540E</span><span class="suffix"></span></h2><p>\u8FD8\u53EF\u4EE5\u914D\u5408<code class="">Keymetrics</code>\u53D1\u6325\u66F4\u5927\u7684\u7528\u5904</p>`,33),l=[o],m={title:"pm2\u8FDB\u9636\u4F7F\u7528\u4E4B\u4E00\u952E\u53D1\u5E03",tag:["pm2","nodejs"],author:"Artiely",date:"2018-10-10",cover:"/2022-05-14-21-56-56.png",base64:301286,tinyCover:"/cover/2022-05-14-21-56-56.png",coverWidth:564,coverHeight:797,coverPrimary:"e38b42",coverSecondary:"1c74bd",meta:[{property:"og:title",content:"pm2\u8FDB\u9636\u4F7F\u7528\u4E4B\u4E00\u952E\u53D1\u5E03"}]},r={__name:"2018-10-10-pm2",setup(c,{expose:n}){return a({title:"pm2\u8FDB\u9636\u4F7F\u7528\u4E4B\u4E00\u952E\u53D1\u5E03",meta:[{property:"og:title",content:"pm2\u8FDB\u9636\u4F7F\u7528\u4E4B\u4E00\u952E\u53D1\u5E03"}]}),n({frontmatter:{title:"pm2\u8FDB\u9636\u4F7F\u7528\u4E4B\u4E00\u952E\u53D1\u5E03",tag:["pm2","nodejs"],author:"Artiely",date:"2018-10-10",cover:"/2022-05-14-21-56-56.png",base64:301286,tinyCover:"/cover/2022-05-14-21-56-56.png",coverWidth:564,coverHeight:797,coverPrimary:"e38b42",coverSecondary:"1c74bd",meta:[{property:"og:title",content:"pm2\u8FDB\u9636\u4F7F\u7528\u4E4B\u4E00\u952E\u53D1\u5E03"}]}}),(u,k)=>(p(),e("div",null,l))}};typeof s=="function"&&s(r);export{r as default,m as frontmatter};
