<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/192.png"><link rel="mask-icon" href="/192.png" color="#00aba9"><meta name="msapplication-TileColor" content="#00aba9"><meta name="theme-color" content="#ffffff"><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script type="module" async="" crossorigin="" src="/assets/app.f46e7dd4.js"></script><style>@charset "UTF-8";.nav{padding:0 20px;height:80px;width:100vw;background:var(--primary-bg);backdrop-filter:saturate(180%) blur(20px);position:fixed;top:0;left:0;transform:translateZ(0);z-index:9;display:flex;align-items:center;justify-content:center;color:var(--c-text);transition:transform .3s;box-shadow:0 0 10px #0000001a}.nav nav{display:flex;align-items:center;justify-content:space-between;max-width:1200px;flex:1}.nav .logo{padding:20px;font-family:Josefin Sans,serif}.nav .menu{display:flex;align-items:center;justify-content:center}.nav .menu li{padding:20px;cursor:pointer}pre[class*=language-]::-webkit-scrollbar-thumb{background:var(--3b7ca6b3)}.icon{font-size:2em;color:#00aba9;cursor:pointer;position:fixed;bottom:2em;right:2em}.el-drawer{background-color:var(--c-bg)}@media screen and (max-width:768px){.el-drawer{width:100%!important}}.el-drawer__header{box-shadow:0 0 10px #0000001a;padding-bottom:32px;margin-bottom:0}:root{--main-bg-color:#fff;--main-text-color:#888888;--index-bg:radial-gradient(#eaf0ec, #c7d5cc);--clock-shadow:0 -15px 15px rgba(255, 255, 255, .05),inset 0 -15px 15px rgba(255, 255, 255, .05),0 15px 15px rgba(0, 0, 0, .1),inset 0 15px 15px rgba(0, 0, 0, .1);--card-bg:hsla(0, 0%, 100%, .5)}:root{--faded-yellow:#fdf9d3;--faded-green:#e4ffee;--faded-purple:#d2d6e9;--faded-red:#f8e8e5;--faded-blue:#eff7fa}*,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:currentColor}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}body{margin:0;line-height:inherit}h1,h2,h3,h4,h5{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}strong{font-weight:bolder}code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button{font-family:inherit;font-size:100%;line-height:inherit;color:inherit;margin:0;padding:0}button{text-transform:none}[type=button],button{-webkit-appearance:button;background-color:transparent;background-image:none}blockquote,figure,h1,h2,h3,h4,h5,p,pre{margin:0}ol,ul{list-style:none;margin:0;padding:0}button{cursor:pointer}img,svg{display:block;vertical-align:middle}img{max-width:100%;height:auto}:root{--el-color-white:#ffffff;--el-color-black:#000000;--el-color-primary-rgb:64,158,255;--el-color-success-rgb:103,194,58;--el-color-warning-rgb:230,162,60;--el-color-danger-rgb:245,108,108;--el-color-error-rgb:245,108,108;--el-color-info-rgb:144,147,153;--el-font-size-extra-large:20px;--el-font-size-large:18px;--el-font-size-medium:16px;--el-font-size-base:14px;--el-font-size-small:13px;--el-font-size-extra-small:12px;--el-font-family:"Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","\5fae\8f6f\96c5\9ed1",Arial,sans-serif;--el-font-weight-primary:500;--el-font-line-height-primary:24px;--el-index-normal:1;--el-index-top:1000;--el-index-popper:2000;--el-border-radius-base:4px;--el-border-radius-small:2px;--el-border-radius-round:20px;--el-border-radius-circle:100%;--el-transition-duration:.3s;--el-transition-duration-fast:.2s;--el-transition-function-ease-in-out-bezier:cubic-bezier(.645, .045, .355, 1);--el-transition-function-fast-bezier:cubic-bezier(.23, 1, .32, 1);--el-transition-all:all var(--el-transition-duration) var(--el-transition-function-ease-in-out-bezier);--el-transition-fade:opacity var(--el-transition-duration) var(--el-transition-function-fast-bezier);--el-transition-md-fade:transform var(--el-transition-duration) var(--el-transition-function-fast-bezier),opacity var(--el-transition-duration) var(--el-transition-function-fast-bezier);--el-transition-fade-linear:opacity var(--el-transition-duration-fast) linear;--el-transition-border:border-color var(--el-transition-duration-fast) var(--el-transition-function-ease-in-out-bezier);--el-transition-box-shadow:box-shadow var(--el-transition-duration-fast) var(--el-transition-function-ease-in-out-bezier);--el-transition-color:color var(--el-transition-duration-fast) var(--el-transition-function-ease-in-out-bezier);--el-component-size-large:40px;--el-component-size:32px;--el-component-size-small:24px}:root{color-scheme:light;--el-color-white:#ffffff;--el-color-black:#000000;--el-color-primary:#409eff;--el-color-primary-light-3:#79bbff;--el-color-primary-light-5:#a0cfff;--el-color-primary-light-7:#c6e2ff;--el-color-primary-light-8:#d9ecff;--el-color-primary-light-9:#ecf5ff;--el-color-primary-dark-2:#337ecc;--el-color-success:#67c23a;--el-color-success-light-3:#95d475;--el-color-success-light-5:#b3e19d;--el-color-success-light-7:#d1edc4;--el-color-success-light-8:#e1f3d8;--el-color-success-light-9:#f0f9eb;--el-color-success-dark-2:#529b2e;--el-color-warning:#e6a23c;--el-color-warning-light-3:#eebe77;--el-color-warning-light-5:#f3d19e;--el-color-warning-light-7:#f8e3c5;--el-color-warning-light-8:#faecd8;--el-color-warning-light-9:#fdf6ec;--el-color-warning-dark-2:#b88230;--el-color-danger:#f56c6c;--el-color-danger-light-3:#f89898;--el-color-danger-light-5:#fab6b6;--el-color-danger-light-7:#fcd3d3;--el-color-danger-light-8:#fde2e2;--el-color-danger-light-9:#fef0f0;--el-color-danger-dark-2:#c45656;--el-color-error:#f56c6c;--el-color-error-light-3:#f89898;--el-color-error-light-5:#fab6b6;--el-color-error-light-7:#fcd3d3;--el-color-error-light-8:#fde2e2;--el-color-error-light-9:#fef0f0;--el-color-error-dark-2:#c45656;--el-color-info:#909399;--el-color-info-light-3:#b1b3b8;--el-color-info-light-5:#c8c9cc;--el-color-info-light-7:#dedfe0;--el-color-info-light-8:#e9e9eb;--el-color-info-light-9:#f4f4f5;--el-color-info-dark-2:#73767a;--el-bg-color:#ffffff;--el-bg-color-page:#f2f3f5;--el-bg-color-overlay:#ffffff;--el-text-color-primary:#303133;--el-text-color-regular:#606266;--el-text-color-secondary:#909399;--el-text-color-placeholder:#a8abb2;--el-text-color-disabled:#c0c4cc;--el-border-color:#dcdfe6;--el-border-color-light:#e4e7ed;--el-border-color-lighter:#ebeef5;--el-border-color-extra-light:#f2f6fc;--el-border-color-dark:#d4d7de;--el-border-color-darker:#cdd0d6;--el-fill-color:#f0f2f5;--el-fill-color-light:#f5f7fa;--el-fill-color-lighter:#fafafa;--el-fill-color-extra-light:#fafcff;--el-fill-color-dark:#ebedf0;--el-fill-color-darker:#e6e8eb;--el-fill-color-blank:#ffffff;--el-box-shadow:0px 12px 32px 4px rgba(0, 0, 0, .04),0px 8px 20px rgba(0, 0, 0, .08);--el-box-shadow-light:0px 0px 12px rgba(0, 0, 0, .12);--el-box-shadow-lighter:0px 0px 6px rgba(0, 0, 0, .12);--el-box-shadow-dark:0px 16px 48px 16px rgba(0, 0, 0, .08),0px 12px 32px rgba(0, 0, 0, .12),0px 8px 16px -8px rgba(0, 0, 0, .16);--el-disabled-bg-color:var(--el-fill-color-light);--el-disabled-text-color:var(--el-text-color-placeholder);--el-disabled-border-color:var(--el-border-color-light);--el-overlay-color:rgba(0, 0, 0, .8);--el-overlay-color-light:rgba(0, 0, 0, .7);--el-overlay-color-lighter:rgba(0, 0, 0, .5);--el-mask-color:rgba(255, 255, 255, .9);--el-mask-color-extra-light:rgba(255, 255, 255, .3);--el-border-width:1px;--el-border-style:solid;--el-border-color-hover:var(--el-text-color-disabled);--el-border:var(--el-border-width) var(--el-border-style) var(--el-border-color);--el-svg-monochrome-grey:var(--el-border-color)}@-webkit-keyframes rotating{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.el-icon{--color:inherit;height:1em;width:1em;line-height:1em;display:inline-flex;justify-content:center;align-items:center;position:relative;fill:currentColor;color:var(--color);font-size:inherit}.el-icon svg{height:1em;width:1em}:root{--el-popup-modal-bg-color:var(--el-color-black);--el-popup-modal-opacity:.5}@-webkit-keyframes v-modal-in{0%{opacity:0}}@-webkit-keyframes v-modal-out{to{opacity:0}}@-webkit-keyframes dialog-fade-in{0%{transform:translate3d(0,-20px,0);opacity:0}to{transform:translateZ(0);opacity:1}}@-webkit-keyframes dialog-fade-out{0%{transform:translateZ(0);opacity:1}to{transform:translate3d(0,-20px,0);opacity:0}}@-webkit-keyframes modal-fade-in{0%{opacity:0}to{opacity:1}}@-webkit-keyframes modal-fade-out{0%{opacity:1}to{opacity:0}}.el-drawer{--el-drawer-bg-color:var(--el-dialog-bg-color, var(--el-bg-color));--el-drawer-padding-primary:var(--el-dialog-padding-primary, 20px)}.el-drawer{position:absolute;box-sizing:border-box;background-color:var(--el-drawer-bg-color);display:flex;flex-direction:column;box-shadow:var(--el-box-shadow-dark);overflow:hidden;transition:all var(--el-transition-duration)}.el-drawer__sr-focus:focus{outline:0!important}.el-drawer__header{align-items:center;color:#72767b;display:flex;margin-bottom:32px;padding:var(--el-drawer-padding-primary);padding-bottom:0}.el-drawer__header>:first-child{flex:1}.el-drawer__title{margin:0;flex:1;line-height:inherit;font-size:1rem}.el-drawer__close-btn{border:none;cursor:pointer;font-size:var(--el-font-size-extra-large);color:inherit;background-color:transparent;outline:0}.el-drawer__close-btn:focus i,.el-drawer__close-btn:hover i{color:var(--el-color-primary)}.el-drawer__close-btn .el-icon{font-size:inherit;vertical-align:text-bottom}.el-drawer.rtl{height:100%;top:0;bottom:0}.el-drawer.rtl{right:0}@-webkit-keyframes viewer-fade-in{0%{transform:translate3d(0,-20px,0);opacity:0}to{transform:translateZ(0);opacity:1}}@-webkit-keyframes viewer-fade-out{0%{transform:translateZ(0);opacity:1}to{transform:translate3d(0,-20px,0);opacity:0}}:root{--el-loading-spinner-size:42px;--el-loading-fullscreen-spinner-size:50px}@-webkit-keyframes loading-rotate{to{transform:rotate(360deg)}}@-webkit-keyframes loading-dash{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}:root{--el-menu-active-color:var(--el-color-primary);--el-menu-text-color:var(--el-text-color-primary);--el-menu-hover-text-color:var(--el-color-primary);--el-menu-bg-color:var(--el-fill-color-blank);--el-menu-hover-bg-color:var(--el-color-primary-light-9);--el-menu-item-height:56px;--el-menu-sub-item-height:calc(var(--el-menu-item-height) - 6px);--el-menu-horizontal-sub-item-height:36px;--el-menu-item-font-size:var(--el-font-size-base);--el-menu-item-hover-fill:var(--el-color-primary-light-9);--el-menu-border-color:var(--el-border-color);--el-menu-base-level-padding:20px;--el-menu-level-padding:20px;--el-menu-icon-width:24px;--el-menu-icon-transform-closed:none;--el-menu-icon-transform-open:rotateZ(180deg)}@-webkit-keyframes msgbox-fade-in{0%{transform:translate3d(0,-20px,0);opacity:0}to{transform:translateZ(0);opacity:1}}@-webkit-keyframes msgbox-fade-out{0%{transform:translateZ(0);opacity:1}to{transform:translate3d(0,-20px,0);opacity:0}}.el-overlay{position:fixed;top:0;right:0;bottom:0;left:0;z-index:2000;height:100%;background-color:var(--el-overlay-color-lighter);overflow:auto}@-webkit-keyframes progress{0%{background-position:0 0}to{background-position:32px 0}}@-webkit-keyframes indeterminate{0%{left:-100%}to{left:100%}}@-webkit-keyframes el-skeleton-loading{0%{background-position:100% 50%}to{background-position:0 50%}}@-webkit-keyframes rotate{to{transform:rotate(360deg)}}@-webkit-keyframes dash{0%{stroke-dasharray:1,150;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-35}to{stroke-dasharray:90,150;stroke-dashoffset:-124}}@-webkit-keyframes slideInRight-enter{0%{opacity:0;transform-origin:0 0;transform:translate(100%)}to{opacity:1;transform-origin:0 0;transform:translate(0)}}@-webkit-keyframes slideInRight-leave{0%{transform-origin:0 0;transform:translate(0);opacity:1}to{transform-origin:0 0;transform:translate(100%);opacity:0}}@-webkit-keyframes slideInLeft-enter{0%{opacity:0;transform-origin:0 0;transform:translate(-100%)}to{opacity:1;transform-origin:0 0;transform:translate(0)}}@-webkit-keyframes slideInLeft-leave{0%{transform-origin:0 0;transform:translate(0);opacity:1}to{transform-origin:0 0;transform:translate(-100%);opacity:0}}:root{--c-bg:#fafafa;--primary-bg:#fafafabf;--light-shadow:4px 2px 40px rgb(0 0 0 / 10%);--primary-color:#1c6b48;--c-brand:var(--primary-color);--el-color-white:var(--primary-color);--c-brand:#3fb9b8;--c-brand-light:#50e5e5;--c-text:#2c3e50;--c-text-light:#3a5169;--c-text-lighter:#4e6e8e;--c-text-lightest:#6a8bad;--c-text-quote:#999999;--c-bg:#ffffff;--c-bg-light:#f3f4f5;--c-bg-lighter:#eeeeee;--c-bg-navbar:var(--c-bg);--c-bg-sidebar:var(--c-bg);--c-bg-arrow:#cccccc;--c-border:#eaecef;--c-border-dark:#dfe2e5}@font-face{font-family:Josefin Sans;font-style:normal;font-weight:300;src:local("Josefin Sans Light"),local("JosefinSans-Light"),url(/fonts/Josefin-light.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:fallback}@font-face{font-family:Josefin Sans;font-style:normal;font-weight:400;src:local("Josefin Sans Regular"),local("JosefinSans-Regular"),url(/fonts/Josefin.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:fallback}@font-face{font-family:Consolas;font-style:normal;font-weight:400;src:url(/fonts/consola.ttf);font-display:fallback}@font-face{font-family:League Mono;src:url(/fonts/LeagueMono-Regular.woff2);font-display:fallback}.sino{font-size:16px;font-weight:400;line-height:1.5;overflow-wrap:break-word;word-wrap:break-word;hyphens:auto}.sino:after,.sino:before{content:"";display:table}.sino:after{clear:both}.sino>:first-child{margin-block-start:0!important}.sino>:last-child{margin-block-end:0!important}.sino figure{display:block;text-align:center}.sino figure>img{display:block;margin-inline-start:auto;margin-inline-end:auto}.sino h1,.sino h2,.sino h3,.sino h4,.sino h5{position:relative;margin:0;margin-block-start:24px;margin-block-end:12px;font-weight:600}.sino h1{margin-block-end:24px;font-size:1.6em;line-height:48px}.sino h2{font-size:1.3em;line-height:36px}.sino h3{font-size:1.2em;line-height:36px}.sino h4,.sino h5{font-size:1em;line-height:24px}.sino h1,.sino h2,.sino h3{letter-spacing:.05em}.sino h1+h2,.sino h2+h3,.sino h3+h4,.sino h4+h5{margin-block-start:12px}.sino a{text-decoration:none}.sino a:hover{padding-block-end:1px;border-block-end:1px solid currentColor;text-decoration:none}.sino strong{font-weight:600}.sino strong{font-weight:600}.sino{font-family:Helvetica Neue,helvetica,arial,Hei,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol}:root{--prism-scheme:light;--prism-foreground:#6e6e6e;--prism-background:#f4f4f4;--prism-comment:#a8a8a8;--prism-string:#555555;--prism-literal:#333333;--prism-keyword:#000000;--prism-function:#4f4f4f;--prism-deleted:#333333;--prism-class:#333333;--prism-builtin:#757575;--prism-property:#333333;--prism-namespace:#4f4f4f;--prism-punctuation:#ababab;--prism-decorator:var(--prism-class);--prism-operator:var(--prism-punctuation);--prism-number:var(--prism-literal);--prism-boolean:var(--prism-literal);--prism-variable:var(--prism-literal);--prism-constant:var(--prism-literal);--prism-symbol:var(--prism-literal);--prism-interpolation:var(--prism-literal);--prism-selector:var(--prism-keyword);--prism-keyword-control:var(--prism-keyword);--prism-regex:var(--prism-string);--prism-json-property:var(--prism-property);--prism-inline-background:var(--prism-background);--prism-comment-style:italic;--prism-url-decoration:underline;--prism-line-number:#a5a5a5;--prism-line-number-gutter:#333333;--prism-line-highlight-background:#eeeeee;--prism-selection-background:#aaaaaa;--prism-marker-color:var(--prism-foreground);--prism-marker-opacity:.4;--prism-marker-font-size:.8em;--prism-font-size:1em;--prism-line-height:1.4em;--prism-font-family:monospace;--prism-inline-font-size:var(--prism-font-size);--prism-block-font-size:var(--prism-font-size);--prism-tab-size:2;--prism-block-padding-x:1em;--prism-block-padding-y:1em;--prism-block-margin-x:0;--prism-block-margin-y:.5em;--prism-block-radius:.3em;--prism-inline-padding-x:.3em;--prism-inline-padding-y:.1em;--prism-inline-radius:.3em}code[class*=language-],div[class*=language-],pre[class*=language-]{font-size:var(--prism-font-size);font-family:var(--prism-font-family);direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:var(--prism-line-height);-moz-tab-size:var(--prism-tab-size);-o-tab-size:var(--prism-tab-size);tab-size:var(--prism-tab-size);-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;color:var(--prism-foreground)!important}div[class*=language-],pre[class*=language-]{font-size:var(--prism-block-font-size);padding:var(--prism-block-padding-y) var(--prism-block-padding-x);margin:var(--prism-block-margin-y) var(--prism-block-margin-x);border-radius:var(--prism-block-radius);overflow:auto;background:var(--prism-background)}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:var(--prism-selection-background)}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:var(--prism-selection-background)}.token.comment{color:var(--prism-comment);font-style:var(--prism-comment-style)}.token.interpolation{color:var(--prism-interpolation)}.token.string{color:var(--prism-string)}.token.punctuation{color:var(--prism-punctuation)}.token.operator{color:var(--prism-operator)}.language-json .token.boolean,.token.boolean{color:var(--prism-boolean)}.language-json .token.number,.token.number{color:var(--prism-number)}.token.keyword{color:var(--prism-keyword)}.token.attr-value{color:var(--prism-selector)}.token.function{color:var(--prism-function)}.token.class-name{color:var(--prism-class)}.token.tag{color:var(--prism-builtin)}.token.attr-name,.token.property{color:var(--prism-property)}.language-json .token.property{color:var(--prism-json-property)}:root{--c-tip:#42b983;--c-info:hsl(245deg 100% 60%);--c-info-bg:hsl(210deg 55% 92%);--c-tip-bg:hsl(160deg 100% 40% / 10%);--c-tip-title:var(--c-text);--c-tip-text:var(--c-text);--c-tip-text-accent:var(--c-text-accent);--c-warning:hsl(37deg 100% 50%);--c-warning-bg:hsl(52deg 100% 50% / 25%);--c-warning-text-accent:var(--c-text);--c-danger:#cc0000;--c-danger-bg:#ffe0e0;--c-danger-title:#990000;--c-danger-text:#660000;--c-danger-text-accent:var(--c-text);--c-details-bg:#eeeeee}html:not(.dark){--prism-foreground:#393a34;--prism-background:#fbfbfb;--prism-comment:#a0ada0;--prism-string:#b56959;--prism-literal:#2f8a89;--prism-number:#296aa3;--prism-keyword:#1c6b48;--prism-function:#6c7834;--prism-boolean:#1c6b48;--prism-constant:#a65e2b;--prism-deleted:#a14f55;--prism-class:#2993a3;--prism-builtin:#ab5959;--prism-property:#b58451;--prism-namespace:#b05a78;--prism-punctuation:#8e8f8b;--prism-decorator:#bd8f8f;--prism-regex:#ab5e3f;--prism-json-property:#698c96;--prism-font-family:ui-monospace,SFMono-Regular,SF Mono,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace,"League Mono",Consolas,-apple-system;--rainbow-gradient:linear-gradient(-90deg, #557e6d 0, #1b6787 30%, #81524c 50%, #36673b 70%, #575a31 90%, #345346 100%);--c-text-heading:#0f0f0d}.markdown-body{padding:100px 40px;max-width:52em;font-size:16px;margin:auto;box-sizing:border-box;color:var(--c-text);font-family:var(--font-family)}.markdown-body p{margin:1em 0;line-height:1.75}.markdown-body li{line-height:1.75}.markdown-body h1 .content{position:relative;color:var(--md-text);z-index:2;background-image:var(--rainbow-gradient,#fff);background-size:100%;background-repeat:repeat;-webkit-background-clip:text;-webkit-text-fill-color:transparent;-moz-background-clip:text;-moz-text-fill-color:transparent;filter:drop-shadow(0 0 2rem #000);text-shadow:none!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5{color:var(--c-text-heading)}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5{font-weight:600}.markdown-body a:not(.header-anchor){color:var(--c-brand);padding-block-end:1px;border-block-end:1px solid currentColor}.markdown-body code{color:var(--c-text-lighter)!important;padding:.15rem .5rem;margin:0 .25rem;background-color:var(--c-bg-light);border-radius:3px;overflow-wrap:break-word;transition:background-color var(--t-color);font-size:14px}div[class*=language-].ext-html:before{content:"html  ";position:absolute;top:.6rem;right:4rem;opacity:.5;text-transform:uppercase;font-size:14px}div[class*=language-].ext-js:before{content:"js  ";position:absolute;top:.6rem;right:4rem;opacity:.5;text-transform:uppercase;font-size:14px}div[class*=language-].ext-json:before{content:"json  ";position:absolute;top:.6rem;right:4rem;opacity:.5;text-transform:uppercase;font-size:14px}div[class*=language-].ext-shell:before{content:"shell  ";position:absolute;top:.6rem;right:4rem;opacity:.5;text-transform:uppercase;font-size:14px}div[class*=language-].code-wrapper{padding:2.5em 0 1em;background-color:var(--prism-background);position:relative;border-radius:12px;overflow:hidden;margin-bottom:1em}div[class*=language-].code-wrapper .code-inner{position:relative;padding-left:2.5em;padding-right:.5em}pre[class*=language-]{position:relative;padding:0 0 0 .5em;margin:0;background:0 0;font-size:14px}pre[class*=language-] code{background-color:transparent;padding:0;margin:0}.line-numbers-wrapper{position:absolute;top:2.5rem;left:0;line-height:1.4;margin:0;text-align:right;padding-right:.5em;border-right:1px solid rgba(95,95,95,.06);width:2.5em;font-size:14px}.line-numbers-wrapper .line-number{display:inline-block;line-height:1.4;opacity:.5}.cbt-traffic_light{position:absolute;top:12px;left:13px;display:flex;align-items:center}.cbt-traffic_light span{margin-right:8px;width:12px;height:12px;border-radius:50%}.cbt-traffic_light span:nth-child(1){background-color:#ff5f56}.cbt-traffic_light span:nth-child(2){background-color:#ffbd2e}.cbt-traffic_light span:nth-child(3){background-color:#27c93f}[class*=language-]>span.copy{position:absolute;top:8px;right:8px;z-index:2;display:block;justify-content:center;align-items:center;border-radius:4px;height:40px;background-color:var(--vp-code-block-bg);cursor:pointer;background-image:var(--vp-icon-copy);background-position:50%;background-size:20px;background-repeat:no-repeat;transition:opacity .25s}[class*=language-]>span.copy:before{content:"\590d\5236\4ee3\7801";padding:2px 8px;border-radius:4px;font-size:10px;background:var(--c-bg-light);color:var(--c-text)}[class*=language-]>span.copy:hover:before{background:var(--c-bg-lighter)}[class*=language-]:hover>span.copy{opacity:1}body,html{--font-family:"League Mono",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;padding:0;margin:0;background-color:var(--c-bg);transition:background-color var(--t-color);font-family:var(--font-family);display:flex;flex-direction:column;min-height:100vh;width:100%;overflow-x:hidden;color:var(--c-text)}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:16px;color:var(--c-text)}#app{display:flex;flex-direction:column;min-height:100vh;width:100%;overflow-x:hidden}#app main.px-4{flex:1}a{font-weight:500;color:var(--c-text-accent);text-decoration:none;overflow-wrap:break-word}img{position:relative}img:after{position:absolute;width:100%;height:100%;content:"";display:block;top:0;left:0;background-color:var(--c-bg);background-size:100%}.i-ant-design\:comment-outlined{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 1024 1024' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M573 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40zm-280 0c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z'/%3E%3Cpath fill='currentColor' d='M894 345c-48.1-66-115.3-110.1-189-130v.1c-17.1-19-36.4-36.5-58-52.1c-163.7-119-393.5-82.7-513 81c-96.3 133-92.2 311.9 6 439l.8 132.6c0 3.2.5 6.4 1.5 9.4c5.3 16.9 23.3 26.2 40.1 20.9L309 806c33.5 11.9 68.1 18.7 102.5 20.6l-.5.4c89.1 64.9 205.9 84.4 313 49l127.1 41.4c3.2 1 6.5 1.6 9.9 1.6c17.7 0 32-14.3 32-32V753c88.1-119.6 90.4-284.9 1-408zM323 735l-12-5l-99 31l-1-104l-8-9c-84.6-103.2-90.2-251.9-11-361c96.4-132.2 281.2-161.4 413-66c132.2 96.1 161.5 280.6 66 412c-80.1 109.9-223.5 150.5-348 102zm505-17l-8 10l1 104l-98-33l-12 5c-56 20.8-115.7 22.5-171 7l-.2-.1C613.7 788.2 680.7 742.2 729 676c76.4-105.3 88.8-237.6 44.4-350.4l.6.4c23 16.5 44.1 37.1 62 62c72.6 99.6 68.5 235.2-8 330z'/%3E%3Cpath fill='currentColor' d='M433 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-carbon-dicom-overlay=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 32 32' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath d='M28 6v20H4V6h24m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z' fill='currentColor'/%3E%3Cpath d='M6 8h10v2H6z' fill='currentColor'/%3E%3Cpath d='M6 12h10v2H6z' fill='currentColor'/%3E%3Cpath d='M6 16h6v2H6z' fill='currentColor'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-carbon-logo-github=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 32 32' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' fill-rule='evenodd' d='M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2Z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-iconoir\:home-simple-door=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='none' stroke='currentColor' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M9 21H7a4 4 0 0 1-4-4v-6.292a4 4 0 0 1 1.927-3.421l5-3.03a4 4 0 0 1 4.146 0l5 3.03A4 4 0 0 1 21 10.707V17a4 4 0 0 1-4 4h-2m-6 0v-4a3 3 0 0 1 3-3v0a3 3 0 0 1 3 3v4m-6 0h6'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ph\:image-fill=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 256 256' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M168 100a12 12 0 0 1-12 12a12.3 12.3 0 0 1-8.5-3.5a11.9 11.9 0 0 1-3.5-8.5a12 12 0 0 1 24 0Zm64-44v144a16 16 0 0 1-16 16H40a16 16 0 0 1-16-16V56a16 16 0 0 1 16-16h176a16 16 0 0 1 16 16Zm-16 108.7V56H40v92.7L76.7 112a16.1 16.1 0 0 1 22.6 0l44.7 44.7l20.7-20.7a16.1 16.1 0 0 1 22.6 0Z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i~=carbon-sun]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 32 32' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6ZM5.394 6.813L6.81 5.399l3.505 3.506L8.9 10.319zM2 15.005h5v2H2zm3.394 10.193L8.9 21.692l1.414 1.414l-3.505 3.506zM15 25.005h2v5h-2zm6.687-1.9l1.414-1.414l3.506 3.506l-1.414 1.414zm3.313-8.1h5v2h-5zm-3.313-6.101l3.506-3.506l1.414 1.414l-3.506 3.506zM15 2.005h2v5h-2z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.icon-btn{display:inline-block;cursor:pointer;user-select:none;opacity:.75;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms;transition-duration:.2s}.icon-btn:hover{--un-text-opacity:1;color:rgba(13,148,136,var(--un-text-opacity));opacity:1}.mx-2{margin-left:.5rem;margin-right:.5rem}[mt-6=""]{margin-top:1.5rem}.flex{display:flex}.justify-between{justify-content:space-between}.px-4{padding-left:1rem;padding-right:1rem}.py-10,[py-10=""]{padding-top:2.5rem;padding-bottom:2.5rem}[pt-10=""]{padding-top:2.5rem}.text-center,[text-center=""]{text-align:center}.text-left{text-align:left}.font-sans{font-family:"DM Sans",ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}[text-xl=""]{font-size:1.25rem;line-height:1.75rem}.text-gray-500{--un-text-opacity:1;color:rgba(107,114,128,var(--un-text-opacity))}.text-gray-700{--un-text-opacity:1;color:rgba(55,65,81,var(--un-text-opacity))}[color~="\#00aba9"]{--un-text-opacity:1;color:rgba(0,171,169,var(--un-text-opacity))}.\!outline-none{outline:2px solid transparent!important;outline-offset:2px!important}[content~="\#00aba9"]{content:"#00aba9"}[content~="\#ffffff"]{content:"#ffffff"}[content~="initial-scale\=1\.0"]{content:"initial-scale=1.0"}[content~="width\=device-width\2c "]{content:"width=device-width,"}:root{--md-text-color:#111827;--md-code-background:rgba(27,31,35,.05);--code-font:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}</style><link rel="preload" href="/assets/app.646ecbe7.css" as="style"><link rel="manifest" href="/manifest.webmanifest"><link rel="modulepreload" crossorigin="" href="/assets/2019-4-15-nodejs-tcp-udp-h2.3c5086d8.js"><link rel="preload" href="/assets/README.e12ad7ac.css" as="style"><title>Node.js 网络通信</title><meta name="description" content="artiely blog"><meta property="og:title" content="Node.js 网络通信"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="head:count" content="3"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/Josefin-light.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/Josefin.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/num.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/ipix.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/Nunito.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/consola.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/Artiely.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/MicrosoftYaqiHeiLight.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/LeagueMono-Regular.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYhh0.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmsans/v11/rP2Hp2ywxg089UriOZQ.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmserifdisplay/v10/-nFnOHM81r4j6k0gjAW3mujVU2B2K_c.ttf"></head><body class="font-sans"><div id="app" data-server-rendered="true"><!--[--><!--[--><nav class="nav show" style="--3b7ca6b3:rgba(92, 110, 130, 0.05)"><nav><div style="display:flex;align-items:center"><a class="logo" href="/">Artiely's Blog </a><button class="icon-btn mx-2 !outline-none" title="Toggle dark mode"><div i="carbon-sun dark:carbon-moon"></div></button></div><div><ul class="menu"><!--[--><li><a href="/" class="">首页</a></li><li><a href="/posts" class="">编码</a></li><li><a href="/bookmark" class="">书签</a></li><li><a href="/about" class="">关于</a></li><li><a href="https://github.com/artiely" target="_blank">Github</a></li><!--]--></ul></div></nav></nav><main class="px-4 py-10 text-center text-gray-700 dark:text-gray-200" style="--3b7ca6b3:rgba(92, 110, 130, 0.05)"><div class="is-blog markdown-body sino text-left"><div><h1 id="node.js-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1" tabindex="-1"><span class="prefix"></span><span class="content">Node.js 网络通信</span><span class="suffix"></span></h1><p>Node 是一个面向网络而生的平台，它具有事件驱动、无阻塞、单线程等特性，具备良好的可伸缩性，使得它十分轻量，适合在分布式网络中扮演各种各样的角色。同时 Node 提供的 API 十分贴合网络，适合用它基础的 API 构建灵活的网络服务。就是给大家介绍 Node 在网络通信编程方面的具体能力。</p><p>利用 Node 可以十分方便的搭建网络服务器。在 Web 领域，大多数的编程语言需要专门的 Web 服务器作为容器，如 ASP、ASP.NET 需要 IIS 作为服务器，PHP 需要打在 Apache 或 Nginx 环境等，JSP 需要 Tomcat 服务器等。但对于 Node 而言，只需要几行代码即可构建服务器，无需额外的容器。</p><p>Node 提供了 net、dgram、http、https 这4个模块，分别用于处理 TCP、UDP、HTTP、HTTPS，适用于服务器端和客户端。</p><h1 id="%E7%AC%AC1%E7%AB%A0-%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5" tabindex="-1"><span class="prefix"></span><span class="content">第1章 网络通信相关概念</span><span class="suffix"></span></h1><p>我们每天使用互联网，你是否想过，它是如何实现的？</p><p>全世界几十亿台电脑，连接在一起，两两通信。上海的某一块网卡送出信号，洛杉矶的另一块网卡居然就收到了，两者实际上根本不知道对方的物理位置，你不觉得这是很神奇的事情吗？</p><p>互联网的核心是一系列协议，总称为"互联网协议"（Internet Protocol Suite）。它们对电脑如何连接和组网，做出了详尽的规定。理解了这些协议，就理解了互联网的原理。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105411.jpeg" alt=""></figure><h2 id="%E7%BD%91%E7%BB%9C%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B" tabindex="-1"><span class="prefix"></span><span class="content">网络七层模型</span><span class="suffix"></span></h2><p>互联网的实现，分成好几层。每一层都有自己的功能，就像建筑物一样，每一层都靠下一层支持。</p><p>用户接触到的，只是最上面的一层，根本没有感觉到下面的层。要理解互联网，必须从最下层开始，自下而上理解每一层的功能。</p><p>如何分层有不同的模型，有的模型分七层</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105412.png" alt="网络七层模型"></figure><p>为了好理解，有的模型分五层</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105413.png" alt="网络五层模型"></figure><p>越下面的层，越靠近硬件；越上面的层，越靠近用户。</p><h2 id="mac-%E5%9C%B0%E5%9D%80" tabindex="-1"><span class="prefix"></span><span class="content">mac 地址</span><span class="suffix"></span></h2><p>ping 127.0.0.1 能ping通即代表电脑网卡没有问题，网络正常就能上网</p><h2 id="ip-%E5%9C%B0%E5%9D%80" tabindex="-1"><span class="prefix"></span><span class="content">IP 地址</span><span class="suffix"></span></h2><p>计算机在网络中的标识号码，好比每个人的电话号码。</p><p>ip地址的作用： 通过ip地址在网络中找到对应的设备，然后可以给这个设备发送数据</p><p>ip地址类型分为：ipv4、ipv6</p><h2 id="port-%E7%AB%AF%E5%8F%A3%E5%8F%B7" tabindex="-1"><span class="prefix"></span><span class="content">Port 端口号</span><span class="suffix"></span></h2><p>端口号分为知名端口号和动态端口号（知名端口号是系统使用的，动态端口号是程序员设置使用的）</p><p>知名端口号：范围从 <code class="">0-1023</code></p><p>动态端口范围：<code class="">1024-65535</code> ，当程序关闭时，同时也就释放了所占用的端口号</p><p>查看端口号：<code class="">netstat -an</code></p><p>查看端口号被哪个程序占用： <code class="">lsof -i[tcp/udp]:端口号</code> (找不到时，使用管理员权限，加sudo)</p><p>根据进程编号杀死指定进程：<code class="">kill -9 进程号</code></p><h2 id="%E5%9F%9F%E5%90%8D" tabindex="-1"><span class="prefix"></span><span class="content">域名</span><span class="suffix"></span></h2><p>方便记忆某台电脑的主机地址，域名能解析出来一个ip地址（DNS解析）</p><h2 id="tcp-%E5%92%8C-udp" tabindex="-1"><span class="prefix"></span><span class="content">TCP 和 UDP</span><span class="suffix"></span></h2><blockquote><p><strong>TCP和UDP: 都是数据传输方式的协议.比如说我要给你钱, 我是以手把手的方式拿给你呢还是以快递的方式寄给你呢.</strong></p></blockquote><p>TCP（传输控制协议）</p><ul><li>需要建立连接（三次握手）,形成一条传输通道,才能传输数据</li><li>传输数据的大小不受限制</li><li>是安全可靠的协议,但是速度稍慢</li></ul><p>UDP（用户数据报协议）</p><p>概念：英文全拼（User Datagram Protocol）简称用户数据报协议，它是无连接的、不可靠的网络传输协议</p><p><strong>核心特点</strong>：无连接、资源开销小、传输速度快、UDP每个数据包最大是64K</p><p><strong>优点</strong>：不需要连接，传输速度快，资源开销小</p><p><strong>缺点</strong>：传输数据不可靠，容易丢失数据包，没有流量控制，当对方没有及时接收数据，发送方一直发送数据会导致缓冲区数据满了，电脑出现卡死情况，所以接收方需要及时接收数据</p><ul><li>不需要建立连接, 把数据封装成数据包扔给对面</li><li>每个数据包大小限制在64K内</li><li>因为不建立连接,所以对方可能收到也可能收不到数据(丢包),因此是不安全的协议, 但是速度比较快</li></ul><p>什么时候用 TCP，什么时候用 UDP？</p><ul><li>对速度要求比较高的时候使用UDP，例如视频聊天, QQ聊天</li><li>对数据安全要求比较高的时候使用TCP，例如数据传输,文件下载</li><li>假如对于视频聊天来说,如果画质优先那就选用TCP, 如果流畅度优先那就选用UDP</li></ul><h2 id="%E4%BB%80%E4%B9%88%E6%98%AF-socket" tabindex="-1"><span class="prefix"></span><span class="content">什么是 Socket</span><span class="suffix"></span></h2><p>Socket应用于两个不同客户端之间的通信及数据传输.中文名字叫套接字. 编程源于生活. 打个活生生的例子来说, 汽车和加油机.我们如果想把加油机里面的油输到汽车上, 那么汽车这边需要有一个端口, 加油机这边也要有一个端口, 两边端口各加一个套接头套着(好比adaptor),然后中间连上管道来输油. 我认为Socket的角色就是这个套接头. 简单来说, 要想在两个客户端之间传数据, 那么两个客户端各自都要有一个Socket.</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105414.JPG" alt="img"></figure><h1 id="%E7%AC%AC2%E7%AB%A0-%E6%9E%84%E5%BB%BA-tcp-%E6%9C%8D%E5%8A%A1" tabindex="-1"><span class="prefix"></span><span class="content">第2章 构建 TCP 服务</span><span class="suffix"></span></h1><p>TCP 服务在网络应用中十分常见，目前大多数的应用都是基于TCP搭建而成的。</p><p>TCP 全名为传输控制协议，在 OSI 模型（由七层模型，分别为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层）中属于传输层协议。许多应用层协议基于TCP构建，典型的是HTTP、SMTP、IMAP等协议。</p><p>七层协议示意图如下：</p><table><thead><tr><th>层级</th><th>作用</th></tr></thead><tbody><tr><td>应用层</td><td>HTTP、SMTP、IMAP等</td></tr><tr><td>表示层</td><td>加密/解密等</td></tr><tr><td>会话层</td><td>通信连接/维持会话</td></tr><tr><td>传输层</td><td>TCP/UDP</td></tr><tr><td>网络层</td><td>IP</td></tr><tr><td>链路层</td><td>网络特有的链路接口</td></tr><tr><td>物理层</td><td>网络物理硬件</td></tr></tbody></table><p>TCP 是面向连接的协议，其显著的特征是在传输之前需要3次握手形成会话，如下图所示</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313151129.png" alt="TCP连接3次握手"></figure><p>只有会话形成之后，服务器端和客户端之间才能互相发送数据。在创建会话的过程中，服务器端和客户端分别提供一个套接字，这个两个套接字共同形成一个连接。服务器端与客户端则通过套接字实现两者之间连接通信的操作。下面是一个基于 Socket 套接字编程的网络通信模型。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313151150.png" alt="Socket 通信模型"></figure><h2 id="%E5%9F%BA%E6%9C%AC%E7%A4%BA%E4%BE%8B" tabindex="-1"><span class="prefix"></span><span class="content">基本示例</span><span class="suffix"></span></h2><p>服务端：</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript"><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 'connection' listener</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'client connected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  c<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'client disconnected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  c<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'hello\r\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  c<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8124</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server bound'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>客户端：</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript"><span class="token keyword">const</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'net'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8124</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 'connect' listener</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'connected to server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  client<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">'world!\r\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  client<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'disconnected from server'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="%E7%9B%B8%E5%85%B3-api" tabindex="-1"><span class="prefix"></span><span class="content">相关 API</span><span class="suffix"></span></h2><blockquote><p>官方API文档：<a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html" target="_blank" rel="noopener">https://nodejs.org/dist/latest-v10.x/docs/api/net.html</a></p></blockquote><h3 id="%E6%9C%8D%E5%8A%A1%E7%AB%AF%E7%9B%B8%E5%85%B3-api" tabindex="-1"><span class="prefix"></span><span class="content">服务端相关 API</span><span class="suffix"></span></h3><blockquote><p><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_class_net_server" target="_blank" rel="noopener">Class: net.Server</a></p></blockquote><ul><li>[new net.Server(<a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_new_net_server_options_connectionlistener" target="_blank" rel="noopener">options][, connectionListener])</a> 创建服务器</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_event_close" target="_blank" rel="noopener">Event: ‘close’</a> 当服务器关闭时，触发该事件</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_event_connection" target="_blank" rel="noopener">Event: ‘connection’</a> 当有新的客户端连接进来时，触发该事件</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_event_error" target="_blank" rel="noopener">Event: ‘error’</a> 当服务器发生错误时，触发该事件</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_event_listening" target="_blank" rel="noopener">Event: ‘listening’</a> 当调用 server.listen() 绑定端口后触发，简洁写法为 server.listen(port, listeningListener)，通过 listen() 方法的第二个参数传入</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_address" target="_blank" rel="noopener">server.address()</a> 服务器创建侦听成功后，可以用来获取服务器地址相关信息，包含 <code class="">{ port: 12346, family: 'IPv4', address: '127.0.0.1' }</code> 信息</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_close_callback" target="_blank" rel="noopener">server.close([callback])</a> 当服务器关闭时触发，在调用 server.close() 后，服务器将停止接受新的套接字连接，但保持当前存在的连接，等待所有连接都断开后，会触发该事件</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_connections" target="_blank" rel="noopener">server.connections</a> 获取当前已建立连接的数量<ul><li>注意：该 API 即将废弃，推荐使用 <code class="">server.getConnections()</code> 替换</li></ul></li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_getconnections_callback" target="_blank" rel="noopener">server.getConnections(callback)</a> 获取当前已建立连接的数量</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_listen" target="_blank" rel="noopener">server.listen()</a> 绑定端口号启动服务，开始等待侦听<ul><li>[server.listen(handle<a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_listen_handle_backlog_callback" target="_blank" rel="noopener">, backlog][, callback])</a></li><li>[server.listen(options<a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_listen_options_callback" target="_blank" rel="noopener">, callback])</a></li><li>[server.listen(path<a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_listen_path_backlog_callback" target="_blank" rel="noopener">, backlog][, callback])</a></li><li>[server.listen(<a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_listen_port_host_backlog_callback" target="_blank" rel="noopener">port[, host[, backlog]]][, callback])</a></li></ul></li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_listening" target="_blank" rel="noopener">server.listening</a> 获取服务器的侦听状态</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_maxconnections" target="_blank" rel="noopener">server.maxConnections</a> 在服务器连接数较高的时候，可以通过设置该属性用于拒绝超过最大数的连接</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_ref" target="_blank" rel="noopener">server.ref()</a> 恢复服务器侦听</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_server_unref" target="_blank" rel="noopener">server.unref()</a> 暂停服务器侦听，可以使用 <code class="">server.ref()</code> 恢复服务器侦听</li></ul><h3 id="%E5%A5%97%E6%8E%A5%E5%AD%97-socket-%E7%9B%B8%E5%85%B3-api" tabindex="-1"><span class="prefix"></span><span class="content">套接字 Socket 相关 API</span><span class="suffix"></span></h3><blockquote><p><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_class_net_socket" target="_blank" rel="noopener">Class: net.Socket</a></p></blockquote><ul><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_new_net_socket_options" target="_blank" rel="noopener">new net.Socket([options])</a> 创建 Socket 连接</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_event_close_1" target="_blank" rel="noopener">Event: ‘close’</a> 当套接字完全关闭时，触发该事件</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_event_connect" target="_blank" rel="noopener">Event: ‘connect’</a> 该事件用于客户端，当套接字与服务端连接成功时会被触发</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_event_data" target="_blank" rel="noopener">Event: ‘data’</a> 当一端调用 <code class="">write()</code> 发送数据时，另一端会触发 <code class="">data</code> 事件，事件传递的数据即是 <code class="">write()</code> 发送的数据</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_event_drain" target="_blank" rel="noopener">Event: ‘drain’</a> 当任意一端调用 write() 发送数据时，当前这端会触发该事件</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_event_end" target="_blank" rel="noopener">Event: ‘end’</a> 当连接中的任意一端发送了 FIN 数据时，将会触发该事件</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_event_error_1" target="_blank" rel="noopener">Event: ‘error’</a> 当异常发生时，触发该事件</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_event_timeout" target="_blank" rel="noopener">Event: ‘timeout’</a> 当一定时间后连接不再活跃时，该事件将会被触发，通知用户当前连接已经被闲置了</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_socket_address" target="_blank" rel="noopener">socket.address()</a> 获取套接字的连接信息，例如 <code class="">{ port: 12346, family: 'IPv4', address: '127.0.0.1' }</code></li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_socket_localaddress" target="_blank" rel="noopener">socket.localAddress</a> 获取当前套接字地址</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_socket_localport" target="_blank" rel="noopener">socket.localPort</a> 获取当前套接字端口号</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_socket_remoteaddress" target="_blank" rel="noopener">socket.remoteAddress</a> 获取另一端套接字地址</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_socket_remotefamily" target="_blank" rel="noopener">socket.remoteFamily</a> 获取另一端套接字IP协议版本</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_socket_remoteport" target="_blank" rel="noopener">socket.remotePort</a> 获取另一端套接字连接端口号</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_socket_setencoding_encoding" target="_blank" rel="noopener">socket.setEncoding([encoding])</a> 设置获取数据解析的编码格式，默认不处理</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_socket_write_data_encoding_callback" target="_blank" rel="noopener">socket.write(data[, encoding][, callback])</a> 通过套接字发送数据</li></ul><h3 id="%E5%85%B6%E5%AE%83-api" tabindex="-1"><span class="prefix"></span><span class="content">其它 API</span><span class="suffix"></span></h3><ul><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_net_connect" target="_blank" rel="noopener">net.connect()</a> 创建 Socket 客户端连接，和 <code class="">net.createConnection()</code> 作用相等<ul><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_net_connect_options_connectlistener" target="_blank" rel="noopener">net.connect(options[, connectListener])</a></li><li>[net.connect(port<a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_net_connect_port_host_connectlistener" target="_blank" rel="noopener">, host][, connectListener])</a></li></ul></li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_net_createconnection" target="_blank" rel="noopener">net.createConnection()</a> 创建 Socket 客户端连接<ul><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_net_createconnection_options_connectlistener" target="_blank" rel="noopener">net.createConnection(options[, connectListener])</a></li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_net_createconnection_path_connectlistener" target="_blank" rel="noopener">net.createConnection(path[, connectListener])</a></li><li>[net.createConnection(port<a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_net_createconnection_port_host_connectlistener" target="_blank" rel="noopener">, host][, connectListener])</a></li></ul></li><li>[net.createServer(<a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_net_createserver_options_connectionlistener" target="_blank" rel="noopener">options][, connectionListener])</a> 创建Socket服务端，等价于 <code class="">new net.Server()</code></li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_net_isip_input" target="_blank" rel="noopener">net.isIP(input)</a> 判断是否是IP地址</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_net_isipv4_input" target="_blank" rel="noopener">net.isIPv4(input)</a> 判断是否是符合 IPv4协议的地址</li><li><a href="https://nodejs.org/dist/latest-v10.x/docs/api/net.html#net_net_isipv6_input" target="_blank" rel="noopener">net.isIPv6(input)</a> 判断是否是符合 IPv6 协议的地址</li></ul><h2 id="%E6%A1%88%E4%BE%8B%EF%BC%9A%E8%81%8A%E5%A4%A9%E5%AE%A4" tabindex="-1"><span class="prefix"></span><span class="content">案例：聊天室</span><span class="suffix"></span></h2><h3 id="%E5%88%9D%E5%A7%8B%E5%8C%96" tabindex="-1"><span class="prefix"></span><span class="content">初始化</span><span class="suffix"></span></h3><h3 id="%E6%A0%B8%E5%BF%83%E9%9C%80%E6%B1%82" tabindex="-1"><span class="prefix"></span><span class="content">核心需求</span><span class="suffix"></span></h3><ul><li><p>用户第一次进来，提示用户输入昵称进行注册</p><ul><li>昵称不允许重复</li></ul></li><li><p>广播消息（群发）</p></li><li><p>用户昵称</p></li><li><p>点对点消息（私聊）</p></li></ul><h3 id="%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F%E8%AE%BE%E8%AE%A1%EF%BC%88%E8%AF%AD%E8%A8%80%E5%8D%8F%E8%AE%AE%EF%BC%89" tabindex="-1"><span class="prefix"></span><span class="content">数据格式设计（语言协议）</span><span class="suffix"></span></h3><ul><li>什么是数据格式<ul><li>数据格式（data format）是描述数据保存在文件或记录中的规则。可以是字符形式的文本格式，或二进制数据形式的压缩格式</li></ul></li><li>为什么要进行数据格式设计</li><li>比较常见的数据传输格式<ul><li><strong>JSON</strong></li><li>XML</li><li>YAML</li><li>…</li></ul></li></ul><blockquote><p><strong>用户登录</strong></p></blockquote><p>客户端：</p><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"login"</span><span class="token punctuation">,</span>
  <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"xxx"</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>服务端：</p><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"login"</span><span class="token punctuation">,</span>
  <span class="token property">"success"</span><span class="token operator">:</span> <span class="token boolean">true</span> | <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"登录成功|失败"</span><span class="token punctuation">,</span>
  <span class="token property">"sumUsers"</span><span class="token operator">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p><strong>广播消息</strong></p></blockquote><p>客户端：</p><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"broadcast"</span><span class="token punctuation">,</span>
  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"xxx"</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>服务端：</p><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"broadcast"</span><span class="token punctuation">,</span>
  <span class="token property">"nickname"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span>
  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"xxx"</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p><strong>点对点消息</strong></p></blockquote><p>客户端：</p><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"p2p"</span><span class="token punctuation">,</span>
  <span class="token property">"to"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span>
  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"xxx"</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>服务端：</p><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"p2p"</span><span class="token punctuation">,</span>
  <span class="token property">"from"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span>
  <span class="token property">"to"</span><span class="token operator">:</span> <span class="token string">"xxx"</span><span class="token punctuation">,</span>
  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"xxx"</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><p>上线|离线通知日志</p></blockquote><p>服务端：</p><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"log"</span><span class="token punctuation">,</span>
  <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"xxx 进入|离开了聊天室，当前在线人数：xx"</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95" tabindex="-1"><span class="prefix"></span><span class="content">用户登录</span><span class="suffix"></span></h3><ul><li>客户端输入昵称发送到服务端</li><li>服务端接收数据，校验昵称是否重复<ul><li>如果已重复，则发送通知告诉客户端</li><li>如果可以使用，则将用户昵称及通信 Socket 存储到容器中用于后续使用</li></ul></li></ul><h3 id="%E7%BE%A4%E5%8F%91%E6%B6%88%E6%81%AF" tabindex="-1"><span class="prefix"></span><span class="content">群发消息</span><span class="suffix"></span></h3><ul><li>客户端输入消息发送到服务端</li><li>服务端将消息发送给所有当前连接（也就是存储客户端Socket的容器）的客户端</li><li>客户端收到消息，将消息输出到终端</li></ul><h3 id="%E7%A7%81%E8%81%8A" tabindex="-1"><span class="prefix"></span><span class="content">私聊</span><span class="suffix"></span></h3><ul><li>客户端输入消息发送到服务端</li><li>服务端根据消息内容从容器中找到对应的通信客户端，然后将消息发送给该客户端</li><li>对应的客户端收到消息，将消息输入到终端</li></ul><h3 id="%E4%B8%8A%E7%BA%BF%7C%E7%A6%BB%E7%BA%BF%E9%80%9A%E7%9F%A5" tabindex="-1"><span class="prefix"></span><span class="content">上线|离线通知</span><span class="suffix"></span></h3><ul><li>上线通知</li><li>离线通知</li></ul><h2 id="%E6%80%BB%E7%BB%93" tabindex="-1"><span class="prefix"></span><span class="content">总结</span><span class="suffix"></span></h2><ul><li>TCP 必须建立连接（三次握手建立连接）才能通信</li></ul><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313151243.png" alt="TCP连接3次握手"></figure><ul><li>TCP 只是负责数据的传输，不关心传输的数据格式问题</li></ul><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"xxx"</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>如果需要使用 TCP 通信完成某种功能，则需要制定数据格式协议，或者使用第三方协议</li><li>Socket 就是与之通信的另一端，通过 Socket 接收或是发送数据</li><li>Socket 通信模型</li></ul><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313151323.png" alt="Socket 通信模型"></figure><h1 id="%E7%AC%AC3%E7%AB%A0-%E6%9E%84%E5%BB%BA-udp-%E6%9C%8D%E5%8A%A1" tabindex="-1"><span class="prefix"></span><span class="content">第3章 构建 UDP 服务</span><span class="suffix"></span></h1><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105415.jpg" alt="img"></figure><p>内容安排：</p><ul><li>UDP 介绍</li><li>Node 中的核心模块 dgram</li><li>使用 Node 实现 UDP 单播</li><li>使用 Node 实现 UDP 广播</li><li>使用 Node 实现 UDP 组播</li></ul><h2 id="udp-%E7%AE%80%E4%BB%8B" tabindex="-1"><span class="prefix"></span><span class="content">UDP 简介</span><span class="suffix"></span></h2><ul><li><p>User Datagram Protocol，简称 UDP ，又称用户数据报协议</p></li><li><p>和 TCP 一样，位于网络传输层用于处理数据包</p></li><li><p>UDP 最大的特点是<strong>无连接</strong></p></li><li><p>UDP 传输<strong>速度快</strong></p></li><li><p>UDP 数据传输<strong>不可靠</strong></p><ul><li>不提供数据包分组、组装和不能对数据包进行排序的缺点，也就是说，当报文发送之后，是无法得知其是否安全完整到达的</li><li>可靠性由应用层负责</li></ul></li><li><p>支持一对一通信，也支持一对多通信</p></li><li><p>许多关键的互联网应用程序使用 UDP</p><ul><li>如 DNS 域名系统服务、TFTP 简单文件传输协议、DHCP 动态主机设置协议 等</li></ul></li><li><p>UDP 适用于对速度要求比较高，对数据质量要求不严谨的应用</p><ul><li>例如流媒体、实时多人游戏、实时音视频</li></ul></li></ul><h3 id="tcp-%E5%92%8C-udp-1" tabindex="-1"><span class="prefix"></span><span class="content">TCP 和 UDP</span><span class="suffix"></span></h3><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105416.jpg" alt="TCP_vs_UDP.JPG"></figure><blockquote><p><strong>TCP和UDP: 都是数据传输方式的协议.比如说我要给你钱, 我是以手把手的方式拿给你呢还是以快递的方式寄给你呢.</strong></p></blockquote><table><thead><tr><th></th><th>UDP</th><th>TCP</th></tr></thead><tbody><tr><td>连接</td><td>无连接</td><td>面向连接</td></tr><tr><td>速度</td><td>无需建立连接，速度较快</td><td>需要建立连接，速度较慢</td></tr><tr><td>目的主机</td><td>一对一，一对多</td><td>仅能一对一</td></tr><tr><td>带宽</td><td>UDP 报头较短，消耗带宽更少</td><td>消耗更多的带宽</td></tr><tr><td>消息边界</td><td>有</td><td>无</td></tr><tr><td>可靠性</td><td>低</td><td>高</td></tr><tr><td>顺序</td><td>无序</td><td>有序</td></tr></tbody></table><blockquote><p>注：事实上，UDP协议的这种乱序性基本上很少出现，通常只会在网络非常拥挤的情况下才有可能发生。</p></blockquote><p>什么时候用 TCP，什么时候用 UDP？</p><ul><li>对速度要求比较高的时候使用UDP，例如视频聊天, QQ聊天</li><li>对数据安全要求比较高的时候使用TCP，例如数据传输,文件下载</li><li>假如对于视频聊天来说,如果画质优先那就选用TCP, 如果流畅度优先那就选用UDP</li></ul><h3 id="udp-%E7%9A%84%E4%B8%89%E7%A7%8D%E4%BC%A0%E6%92%AD%E6%96%B9%E5%BC%8F" tabindex="-1"><span class="prefix"></span><span class="content">UDP 的三种传播方式</span><span class="suffix"></span></h3><p>1、UDP 单播</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105417.png" alt="image-20190422104032626"></figure><ul><li>单播是目的地址为单一目标的一种传播方式</li><li>地址范围：<code class="">0.0.0.0 ~ 223.255.255.255</code></li></ul><p>2、UDP 广播</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105418.png" alt="image-20190422104655365"></figure><ul><li><p>目的地址为网络中的所有设备</p></li><li><p>地址范围分为两种</p><ul><li>受限广播：它不被路由转发，IP 地址的网络字段和主机字段全为1就是地址 <code class="">255.255.255.255</code></li><li>直接广播：会被路由转发，IP地址的网络字段定义这个网络，主机字段通常全为1，如 <code class="">192.168.10.255</code></li></ul></li></ul><p>3、UDP 组播</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105419.png" alt="image-20190422104735038"></figure><ul><li><p>多播（Multicast）也叫组播，把信息传递给一组目的地地址</p></li><li><p>地址范围：<code class="">224.0.0.0 ~ 239.255.255.255</code></p></li><li><p><code class="">224.0.0.0 ~ 224.0.0.255</code> 为永久组地址，<code class="">224.0.0.0.0</code> 保留不分配，其它供路由协议使用</p></li><li><p><code class="">224.0.1.0 ~ 224.0.1.255</code> 为公用组播地址，可以用于 Internet</p></li><li><p><code class="">224.0.2.0 ~ 238.255.255.255</code> 为用户可用的组播地址（临时组），全网范围有效，使用需要申请</p></li><li><p><code class="">239.0.0.0 ~ 239.255.255.255</code> 为本地管理组播地址，仅在特定本地范围有效</p></li></ul><h3 id="udp-%E4%B8%80%E5%AF%B9%E5%A4%9A%E9%80%9A%E4%BF%A1%E5%9C%BA%E6%99%AF" tabindex="-1"><span class="prefix"></span><span class="content">UDP 一对多通信场景</span><span class="suffix"></span></h3><p>单播传输（Unicast）：在发送者和每一接收者之间实现<a href="https://baike.baidu.com/item/%E7%82%B9%E5%AF%B9%E7%82%B9" target="_blank" rel="noopener">点对点</a>网络连接。如果一台发送者同时给多个的接收者传输相同的数据，也必须相应的复制多份的相同<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%8C%85" target="_blank" rel="noopener">数据包</a>。如果有大量<a href="https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA" target="_blank" rel="noopener">主机</a>希望获得<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%8C%85" target="_blank" rel="noopener">数据包</a>的同一份拷贝时，将导致发送者负担沉重、延迟长、<a href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E6%8B%A5%E5%A1%9E" target="_blank" rel="noopener">网络拥塞</a>；为保证一定的服务质量需增加<a href="https://baike.baidu.com/item/%E7%A1%AC%E4%BB%B6" target="_blank" rel="noopener">硬件</a>和<a href="https://baike.baidu.com/item/%E5%B8%A6%E5%AE%BD" target="_blank" rel="noopener">带宽</a>。</p><p>广播（Broadcast）：是指在IP<a href="https://baike.baidu.com/item/%E5%AD%90%E7%BD%91" target="_blank" rel="noopener">子网</a>内<a href="https://baike.baidu.com/item/%E5%B9%BF%E6%92%AD%E6%95%B0%E6%8D%AE%E5%8C%85" target="_blank" rel="noopener">广播数据包</a>，所有在<a href="https://baike.baidu.com/item/%E5%AD%90%E7%BD%91" target="_blank" rel="noopener">子网</a>内部的<a href="https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA" target="_blank" rel="noopener">主机</a>都将收到这些数据包。广播意味着网络向子网每一个<a href="https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA" target="_blank" rel="noopener">主机</a>都投递一份数据包，不论这些主机是否乐于接收该数据包。所以广播的使用范围非常小，只在本地<a href="https://baike.baidu.com/item/%E5%AD%90%E7%BD%91" target="_blank" rel="noopener">子网</a>内有效，通过<a href="https://baike.baidu.com/item/%E8%B7%AF%E7%94%B1%E5%99%A8" target="_blank" rel="noopener">路由器</a>和<a href="https://baike.baidu.com/item/%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87" target="_blank" rel="noopener">网络设备</a>控制广播传输。在网络中的应用较多，如客户机通过DHCP自动获得IP地址的过程就是通过广播来实现的。但是与单播和多播相比，广播几乎占用了子网内网络的所有带宽</p><p>组播：<a href="https://baike.baidu.com/item/%E7%BB%84%E6%92%AD" target="_blank" rel="noopener">组播</a>解决了<a href="https://baike.baidu.com/item/%E5%8D%95%E6%92%AD" target="_blank" rel="noopener">单播</a>和广播方式效率低的问题。当网络中的某些用户需求特定信息时，<a href="https://baike.baidu.com/item/%E7%BB%84%E6%92%AD" target="_blank" rel="noopener">组播</a>源（即组播信息发送者）仅发送一次信息，组播<a href="https://baike.baidu.com/item/%E8%B7%AF%E7%94%B1%E5%99%A8" target="_blank" rel="noopener">路由器</a>借助组播<a href="https://baike.baidu.com/item/%E8%B7%AF%E7%94%B1%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener">路由协议</a>为组播<a href="https://baike.baidu.com/item/%E6%95%B0%E6%8D%AE%E5%8C%85" target="_blank" rel="noopener">数据包</a>建立树型路由，被传递的信息在尽可能远的分叉路口才开始复制和分发。网上视频会议、网上视频点播特别适合采用多播方式。</p><p>1、单播面对 “一对多”</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105420.png" alt="image-20190422104807642"></figure><ul><li><p>在单播通信中每一个数据包都有确切的目的IP地址</p></li><li><p>对于同一份数据，如果存在多个接收者，Server 需发送与接收者数目相同的单播数据包</p></li><li><p>当接收者成百上千时，将极大的加重 Server 的负担</p></li></ul><p>2、广播面对 “一对多”</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105421.png" alt="image-20190422104904270"></figure><ul><li><p>广播数据包被限制在局域网中</p></li><li><p>一旦有设备发送广播数据则广播域内所有设备都收到这个数据包，并且不得不消耗资源去处理，大量的广播数据包将消耗网络的带宽及设备资源</p></li><li><p>在 IPv6 中，广播的报文传输方式被取消</p></li></ul><p>3、组播面对 “一对多”</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105422.png" alt="image-20190422104925185"></figure><ul><li><p>组播非常适合一对多的模型，只有加入到特定组播组的成员，才会接收到组播数据。当存在多个组播组成员时，源无需发送多个数据拷贝，仅需发送一份即可，组播网络设备会根据实际需要转发或拷贝组播数据</p></li><li><p>数据流只发送给加入该组播组的接收者（组成员），而不需要该数据的设备不会收到该组播流量</p></li><li><p>相同的组播报文，在一段链路上仅有一份数据，大大提高了网络资源的利用率</p></li></ul><h2 id="node-%E4%B8%AD%E7%9A%84-dgram-%E6%A8%A1%E5%9D%97" tabindex="-1"><span class="prefix"></span><span class="content">Node 中的 dgram 模块</span><span class="suffix"></span></h2><p>Node 为我们提供了 <a href="https://nodejs.org/dist/latest-v10.x/docs/api/dgram.html" target="_blank" rel="noopener">dgram</a> 模块用于构建 UDP 服务。</p><p>使用该模块创建 UDP 套接字非常简单，UDP 套接字一旦创建，既可以作为客户端发送数据，也可以作为服务器接收数据。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript"><span class="token keyword">const</span> dgram <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dgram'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> socket <span class="token operator">=</span> dgram<span class="token punctuation">.</span><span class="token function">createSocket</span><span class="token punctuation">(</span><span class="token string">'udp4'</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="socket-%E6%96%B9%E6%B3%95" tabindex="-1"><span class="prefix"></span><span class="content">Socket 方法</span><span class="suffix"></span></h3><table><thead><tr><th>API</th><th>说明</th></tr></thead><tbody><tr><td>bind()</td><td>绑定端口和主机</td></tr><tr><td>address()</td><td>返回 Socket 地址对象</td></tr><tr><td>close()</td><td>关闭 Socket 并停止监听</td></tr><tr><td>send()</td><td>发送消息</td></tr><tr><td>addMembership()</td><td>添加组播成员</td></tr><tr><td>dropMembership()</td><td>删除组播成员</td></tr><tr><td>setBroadcast()</td><td>设置是否启动广播</td></tr><tr><td>setTTL()</td><td>设置数据报生存时间</td></tr><tr><td>setMulticastTTL()</td><td>设置组播数据报生存时间</td></tr></tbody></table><h3 id="socket-%E4%BA%8B%E4%BB%B6" tabindex="-1"><span class="prefix"></span><span class="content">Socket 事件</span><span class="suffix"></span></h3><table><thead><tr><th>API</th><th>说明</th></tr></thead><tbody><tr><td>listening</td><td>监听成功时触发，仅触发一次</td></tr><tr><td>message</td><td>收到消息时触发</td></tr><tr><td>error</td><td>发生错误时触发</td></tr><tr><td>close</td><td>关闭 Socket 时触发</td></tr></tbody></table><h2 id="%E4%BD%BF%E7%94%A8-node-%E5%AE%9E%E7%8E%B0-udp-%E5%8D%95%E6%92%AD" tabindex="-1"><span class="prefix"></span><span class="content">使用 Node 实现 UDP 单播</span><span class="suffix"></span></h2><h3 id="%E6%9C%8D%E5%8A%A1%E7%AB%AF" tabindex="-1"><span class="prefix"></span><span class="content">服务端</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> dgram <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dgram'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> dgram<span class="token punctuation">.</span><span class="token function">createSocket</span><span class="token punctuation">(</span><span class="token string">'udp4'</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listening'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> address <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server running </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> remoteInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server got </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">,</span> remoteInfo<span class="token punctuation">.</span>port<span class="token punctuation">,</span> remoteInfo<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">server</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="%E5%AE%A2%E6%88%B7%E7%AB%AF" tabindex="-1"><span class="prefix"></span><span class="content">客户端</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> dgram <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dgram'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> dgram<span class="token punctuation">.</span><span class="token function">createSocket</span><span class="token punctuation">(</span><span class="token string">'udp4'</span><span class="token punctuation">)</span>

<span class="token comment">// client.send('hello', 3000, 'localhost')</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listening'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> address <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">client running </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">,</span> <span class="token string">'localhost'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> remoteInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">client got </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'client error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">client</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="%E4%BD%BF%E7%94%A8-node-%E5%AE%9E%E7%8E%B0-udp-%E5%B9%BF%E6%92%AD" tabindex="-1"><span class="prefix"></span><span class="content">使用 Node 实现 UDP 广播</span><span class="suffix"></span></h2><h3 id="%E6%9C%8D%E5%8A%A1%E7%AB%AF-1" tabindex="-1"><span class="prefix"></span><span class="content">服务端</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> dgram <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dgram'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> dgram<span class="token punctuation">.</span><span class="token function">createSocket</span><span class="token punctuation">(</span><span class="token string">'udp4'</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listening'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> address <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server running </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  server<span class="token punctuation">.</span><span class="token function">setBroadcast</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 开启广播模式</span>

  server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">,</span> <span class="token string">'255.255.255.255'</span><span class="token punctuation">)</span>

  <span class="token comment">// 每隔2秒发送一条广播消息</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 直接地址 192.168.10.255</span>
    <span class="token comment">// 受限地址 255.255.255.255</span>
    server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">,</span> <span class="token string">'192.168.10.255'</span><span class="token punctuation">)</span>
    <span class="token comment">// server.send('hello', 8000, '255.255.255.255')</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> remoteInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server got </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">,</span> remoteInfo<span class="token punctuation">.</span>port<span class="token punctuation">,</span> remoteInfo<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">server</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="%E5%AE%A2%E6%88%B7%E7%AB%AF-1" tabindex="-1"><span class="prefix"></span><span class="content">客户端</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> dgram <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dgram'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> dgram<span class="token punctuation">.</span><span class="token function">createSocket</span><span class="token punctuation">(</span><span class="token string">'udp4'</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> remoteInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">client got </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'client error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">client</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="%E4%BD%BF%E7%94%A8-node-%E5%AE%9E%E7%8E%B0-udp-%E7%BB%84%E6%92%AD" tabindex="-1"><span class="prefix"></span><span class="content">使用 Node 实现 UDP 组播</span><span class="suffix"></span></h2><h3 id="%E6%9C%8D%E5%8A%A1%E7%AB%AF-2" tabindex="-1"><span class="prefix"></span><span class="content">服务端</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> dgram <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dgram'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> dgram<span class="token punctuation">.</span><span class="token function">createSocket</span><span class="token punctuation">(</span><span class="token string">'udp4'</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listening'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> address <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token number">8000</span><span class="token punctuation">,</span> <span class="token string">'224.0.1.100'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> remoteInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">server got </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  server<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'world'</span><span class="token punctuation">,</span> remoteInfo<span class="token punctuation">.</span>port<span class="token punctuation">,</span> remoteInfo<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'server error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">server</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="%E5%AE%A2%E6%88%B7%E7%AB%AF-2" tabindex="-1"><span class="prefix"></span><span class="content">客户端</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> dgram <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'dgram'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> dgram<span class="token punctuation">.</span><span class="token function">createSocket</span><span class="token punctuation">(</span><span class="token string">'udp4'</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'listening'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> address <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">client running </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>address<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

  client<span class="token punctuation">.</span><span class="token function">addMembership</span><span class="token punctuation">(</span><span class="token string">'224.0.1.100'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> remoteInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">client got </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>msg<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>remoteInfo<span class="token punctuation">.</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'client error'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">client</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">8000</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h1 id="%E7%AC%AC4%E7%AB%A0-%E6%9E%84%E5%BB%BA-http-%E6%9C%8D%E5%8A%A1" tabindex="-1"><span class="prefix"></span><span class="content">第4章 构建 HTTP 服务</span><span class="suffix"></span></h1><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105423.png" alt="ç¸å³å¾ç"></figure><p>内容安排：</p><ul><li>Node 中的 http 模块</li><li>使用 Node 构建 http 服务</li><li>实现一个静态文件服务器</li><li>使用模板引擎处理动态网页</li><li>结合数据库渲染动态页面</li><li>实现一个留言本案例</li><li>第三方 HTTP 服务框架</li></ul><h2 id="node-%E4%B8%AD%E7%9A%84-http-%E6%A8%A1%E5%9D%97" tabindex="-1"><span class="prefix"></span><span class="content">Node 中的 http 模块</span><span class="suffix"></span></h2><p>TCP 和 UDP 都属于网络传输层协议，如果要构建高效的网络应用，就应该从传输层进行着手。但是对于经典的浏览器网页和服务端通信场景，如果单纯的使用更底层的传输层协议则会变得麻烦。</p><p>所以对于经典的B（Browser）S（Server）通信，基于传输层之上专门制定了更上一层的通信协议：HTTP，用于浏览器和服务端进行通信。由于 HTTP 协议本身并不考虑数据如何传输及其他细节问题，所以属于应用层协议。</p><p>Node 提供了基本的 http 和 https 模块用于 HTTP 和 HTTPS 的封装。</p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="server-%E5%AE%9E%E4%BE%8B" tabindex="-1"><span class="prefix"></span><span class="content">Server 实例</span><span class="suffix"></span></h3><table><thead><tr><th>API</th><th>说明</th></tr></thead><tbody><tr><td>Event：‘close’</td><td>服务关闭时触发</td></tr><tr><td>Event：‘request’</td><td>收到请求消息时触发</td></tr><tr><td>server.close()</td><td>关闭服务</td></tr><tr><td>server.listening</td><td>获取服务状态</td></tr></tbody></table><h3 id="%E8%AF%B7%E6%B1%82%E5%AF%B9%E8%B1%A1" tabindex="-1"><span class="prefix"></span><span class="content">请求对象</span><span class="suffix"></span></h3><table><thead><tr><th>API</th><th>说明</th></tr></thead><tbody><tr><td>request.method</td><td>请求方法</td></tr><tr><td>request.url</td><td>请求路径</td></tr><tr><td>request.headers</td><td>请求头</td></tr><tr><td>request.httpVersion</td><td>请求HTTP协议版本</td></tr></tbody></table><h3 id="%E5%93%8D%E5%BA%94%E5%AF%B9%E8%B1%A1" tabindex="-1"><span class="prefix"></span><span class="content">响应对象</span><span class="suffix"></span></h3><table><thead><tr><th>API</th><th>说明</th></tr></thead><tbody><tr><td>response.end()</td><td>结束响应</td></tr><tr><td>response.setHeader(name, value)</td><td>设置响应头</td></tr><tr><td>response.removeHeader(name, value)</td><td>删除响应头</td></tr><tr><td>response.statusCode</td><td>设置响应状态码</td></tr><tr><td>response.statusMessage</td><td>设置响应状态短语</td></tr><tr><td>response.write()</td><td>写入响应数据</td></tr><tr><td>response.writeHead()</td><td>写入响应头</td></tr></tbody></table><h2 id="%E4%BD%BF%E7%94%A8-node-%E6%9E%84%E5%BB%BA-http-%E6%9C%8D%E5%8A%A1" tabindex="-1"><span class="prefix"></span><span class="content">使用 Node 构建 http 服务</span><span class="suffix"></span></h2><h3 id="hello-world" tabindex="-1"><span class="prefix"></span><span class="content">Hello World</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain'</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello World\n'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running at http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="%E6%A0%B9%E6%8D%AE%E4%B8%8D%E5%90%8C-url-%E5%A4%84%E7%90%86%E4%B8%8D%E5%90%8C%E8%AF%B7%E6%B1%82" tabindex="-1"><span class="prefix"></span><span class="content">根据不同 url 处理不同请求</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url
  <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello World!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/a'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello a!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/b'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'Hello b!'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">404</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'404 Not Found.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running at http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="%E5%93%8D%E5%BA%94-html-%E5%86%85%E5%AE%B9" tabindex="-1"><span class="prefix"></span><span class="content">响应 HTML 内容</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token keyword">throw</span> err

    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html; charset=utf-8'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//   res.end(`</span>
<span class="token comment">// &lt;h1&gt;Hello World!&lt;/h1&gt;</span>
<span class="token comment">// &lt;p&gt;你好，世界！&lt;/p&gt;</span>
<span class="token comment">//   `)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running at http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="%E5%A4%84%E7%90%86%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9A%84%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90" tabindex="-1"><span class="prefix"></span><span class="content">处理页面中的静态资源</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url
  <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token keyword">throw</span> err

      res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span>
      res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html; charset=utf-8'</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/assets/css/main.css'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./assets/css/main.css'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token keyword">throw</span> err

      res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span>
      res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/css; charset=utf-8'</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/assets/js/main.js'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./assets/js/main.js'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token keyword">throw</span> err

      res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span>
      res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/javascript; charset=utf-8'</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">404</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain; charset=utf-8'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'404 Not Found.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running at http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h3 id="%E7%BB%9F%E4%B8%80%E5%A4%84%E7%90%86%E9%A1%B5%E9%9D%A2%E4%B8%AD%E7%9A%84%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90" tabindex="-1"><span class="prefix"></span><span class="content">统一处理页面中的静态资源</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> mime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mime'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url
  <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token keyword">throw</span> err

      res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span>
      res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html; charset=utf-8'</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>url<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">'/assets/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// /assets/js/main.js</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">404</span>
        res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain; charset=utf-8'</span><span class="token punctuation">)</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'404 Not Found.'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> contentType <span class="token operator">=</span> mime<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span>
      res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> contentType<span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">404</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/plain; charset=utf-8'</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'404 Not Found.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running at http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><h2 id="%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E%E5%A4%84%E7%90%86%E5%8A%A8%E6%80%81%E9%A1%B5%E9%9D%A2" tabindex="-1"><span class="prefix"></span><span class="content">使用模板引擎处理动态页面</span><span class="suffix"></span></h2><p>假如我们有一份数据 <code class="">todos</code> 需要展示到页面中</p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'吃饭'</span><span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'睡觉'</span><span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'打豆豆'</span><span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>如何将一组数据列表展示到一个页面中，最简单的方式就是字符串替换，但是如果有不止一份数据需要展示到页面中的时候就会变得非常麻烦，所以前人将此种方式整合规则之后开发了我们常见的模板引擎。</p><p>例如我们经常在网页源码中看到下面这样一段代码</p><div class="language-ejs ext-ejs code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-ejs line-numbers-mode"><code class="language-ejs"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> todos<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> </span><span class="token delimiter punctuation">%&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> item<span class="token punctuation">.</span>title </span><span class="token delimiter punctuation">%&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token punctuation">}</span><span class="token punctuation">)</span> </span><span class="token delimiter punctuation">%&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>或者是</p><div class="language-ejs ext-ejs code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-ejs line-numbers-mode"><code class="language-ejs"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  {{ each todos }}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>{{ $value.title }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  {{ /each }}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>无论如何，我们看到的这些语法都在模板引擎所指定的一些规则，目的就是让我们可以非常方便的在网页中进行字符串替换以达到动态网页的效果。</p><p>在 Node 中，有很多优秀的模板引擎，它们大抵相同，但都各有特点</p><ul><li><a href="https://github.com/marko-js/marko" target="_blank" rel="noopener">marko</a></li><li><a href="https://github.com/mozilla/nunjucks" target="_blank" rel="noopener">nunjucks</a></li><li><a href="https://github.com/wycats/handlebars.js" target="_blank" rel="noopener">handlebars.js</a></li><li><a href="https://github.com/mde/ejs" target="_blank" rel="noopener">EJS</a></li><li><a href="https://github.com/pugjs/pug" target="_blank" rel="noopener">Pug</a></li><li><a href="https://github.com/aui/art-template" target="_blank" rel="noopener">art-template</a></li></ul><h3 id="%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8" tabindex="-1"><span class="prefix"></span><span class="content">基本使用</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'art-template'</span><span class="token punctuation">)</span>

<span class="token comment">// const ret = template.render('Hello {{ message }}', {</span>
<span class="token comment">//   message: 'World'</span>
<span class="token comment">// })</span>

<span class="token keyword">const</span> ret <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
&lt;meta charset="UTF-8" /&gt;
&lt;title&gt;Document&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;h1&gt;Hello {{ message }}&lt;/h1&gt;
  &lt;ul&gt;
    {{ each todos }}
    &lt;li&gt;{{ $value.title }} &lt;input type="checkbox" {{ $value.completed ? 'checked' : '' }} /&gt;&lt;/li&gt;
    {{ /each }}
  &lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'World'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'吃饭'</span><span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'睡觉'</span><span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'打豆豆'</span><span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="%E7%BB%93%E5%90%88-http-%E6%9C%8D%E5%8A%A1%E6%B8%B2%E6%9F%93%E9%A1%B5%E9%9D%A2" tabindex="-1"><span class="prefix"></span><span class="content">结合 http 服务渲染页面</span><span class="suffix"></span></h3><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'art-template'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> hostname <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span>
<span class="token keyword">const</span> port <span class="token operator">=</span> <span class="token number">3000</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span> req<span class="token punctuation">.</span>url
  <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">===</span> <span class="token string">'/'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">'./index2.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token keyword">throw</span> err

      <span class="token keyword">const</span> htmlStr <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'前端程序员'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">todos</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'吃饭'</span><span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'睡觉'</span><span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'打豆豆'</span><span class="token punctuation">,</span> <span class="token literal-property property">completed</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">200</span>
      res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Content-Type'</span><span class="token punctuation">,</span> <span class="token string">'text/html'</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>htmlStr<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span>port<span class="token punctuation">,</span> hostname<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Server running at http://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>hostname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>port<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h2 id="%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8" tabindex="-1"><span class="prefix"></span><span class="content">实现一个静态文件服务器</span><span class="suffix"></span></h2><h2 id="%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E7%9A%84%E6%95%B0%E6%8D%AE" tabindex="-1"><span class="prefix"></span><span class="content">使用数据库中的数据</span><span class="suffix"></span></h2><h2 id="%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%95%99%E8%A8%80%E6%9C%AC%E6%A1%88%E4%BE%8B" tabindex="-1"><span class="prefix"></span><span class="content">实现一个留言本案例</span><span class="suffix"></span></h2><h2 id="%E7%AC%AC%E4%B8%89%E6%96%B9-http-%E6%9C%8D%E5%8A%A1%E6%A1%86%E6%9E%B6" tabindex="-1"><span class="prefix"></span><span class="content">第三方 HTTP 服务框架</span><span class="suffix"></span></h2><ul><li><a href="http://expressjs.com/" target="_blank" rel="noopener">Express</a></li><li><a href="http://koajs.com/" target="_blank" rel="noopener">Koa</a></li><li><a href="https://github.com/thinkjs/thinkjs" target="_blank" rel="noopener">ThinkJS</a></li><li><a href="https://eggjs.org/" target="_blank" rel="noopener">Egg</a></li><li><a href="http://adonisjs.com/" target="_blank" rel="noopener">AdonisJs</a></li><li>…</li></ul><blockquote><p>更多优秀的第三方资源 <a href="https://github.com/sindresorhus/awesome-nodejs#web-frameworks" target="_blank" rel="noopener">awesome node.js</a></p></blockquote><h1 id="%E7%AC%AC5%E7%AB%A0-%E6%9E%84%E5%BB%BA-https-%E6%9C%8D%E5%8A%A1" tabindex="-1"><span class="prefix"></span><span class="content">第5章 构建 HTTPS 服务</span><span class="suffix"></span></h1><h2 id="%E5%8D%A0%E4%BD%8D" tabindex="-1"><span class="prefix"></span><span class="content">占位</span><span class="suffix"></span></h2><h1 id="%E7%AC%AC6%E7%AB%A0-%E6%9E%84%E5%BB%BA-websocket-%E6%9C%8D%E5%8A%A1" tabindex="-1"><span class="prefix"></span><span class="content">第6章 构建 WebSocket 服务</span><span class="suffix"></span></h1><ul><li>本章内容<ul><li>客户端 WebSocket</li><li>服务端 WebSocket</li><li>Socket.IO</li></ul></li><li>目标<ul><li>了解什么是 WebSocket</li><li>掌握客户端 WebSocket 的基本使用</li><li>掌握服务端 WebSocket 的基本使用</li><li>掌握 SOCKET.IO 的基本使用</li></ul></li></ul><h3 id="websocket-%E4%BB%8B%E7%BB%8D" tabindex="-1"><span class="prefix"></span><span class="content">WebSocket 介绍</span><span class="suffix"></span></h3><p>类似于 HTTP， <a href="http://websocket.org/" target="_blank" rel="noopener">WebSocket</a> 是一种网络通信协议。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105424.png" alt="img"></figure><h4 id="%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81-websocket" tabindex="-1"><span class="prefix"></span><span class="content">为什么需要 WebSocket</span><span class="suffix"></span></h4><p>我们已经有了 HTTP 协议，为什么还需要另一个协议？它能带来什么好处？</p><p>答案很简单，因为 HTTP 协议有一个缺陷：通信只能由客户端发起，没有请求就没有响应。</p><figure><img src="http://assets.processon.com/chart_image/5c6e6c00e4b0c4e2165c1645.png" alt=""></figure><p>举例来说，我们想了解今天的天气，只能是客户端向服务器发出请求，服务器返回查询结果。HTTP 协议做不到服务器主动向客户端推送信息。</p><p>这种单向请求的特点，注定了如果服务器有连续的状态变化，客户端要获知就非常麻烦。我们只能使用<a href="https://www.pubnub.com/blog/2014-12-01-http-long-polling/" target="_blank" rel="noopener">"轮询"</a>：每隔一段时候，就发出一个询问，了解服务器有没有新的信息。最典型的场景就是聊天室。</p><p>轮询的效率低，非常浪费资源（因为必须不停连接，或者 HTTP 连接始终打开）。因此，工程师们一直在思考，有没有更好的方法。WebSocket 就是这样发明的。</p><h4 id="%E4%BB%80%E4%B9%88%E6%98%AF-websocket" tabindex="-1"><span class="prefix"></span><span class="content">什么是 WebSocket</span><span class="suffix"></span></h4><p>WebSocket 协议在2008年诞生，2011年成为国际标准。所有浏览器都已经支持了。</p><p>它的最大特点就是，服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于<a href="https://en.wikipedia.org/wiki/Push_technology" target="_blank" rel="noopener">服务器推送技术</a>的一种。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105425.jpg" alt="img"></figure><p>其他特点包括：</p><ol><li><p>建立在 TCP 协议之上，服务器端的实现比较容易。</p></li><li><p>与 HTTP 协议有着良好的兼容性。默认端口也是80和443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器。</p></li><li><p>数据格式比较轻量，性能开销小，通信高效。</p></li><li><p>可以发送文本，也可以发送二进制数据。</p></li><li><p>没有同源限制，客户端可以与任意服务器通信。</p></li><li><p>协议标识符是<code class="">ws</code>（如果加密，则为<code class="">wss</code>），服务器网址就是 URL。</p></li></ol><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">ws://example.com:80/some/path
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200312105426.jpg" alt="img"></figure><h3 id="%E5%AE%A2%E6%88%B7%E7%AB%AF-websocket" tabindex="-1"><span class="prefix"></span><span class="content">客户端 WebSocket</span><span class="suffix"></span></h3><h4 id="%E5%9F%BA%E6%9C%AC%E7%A4%BA%E4%BE%8B-1" tabindex="-1"><span class="prefix"></span><span class="content">基本示例</span><span class="suffix"></span></h4><p>在浏览器中提供了 <code class="">WebSocket</code> 对象用于创建和管理 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSockets_API" target="_blank" rel="noopener">WebSocket</a> 连接，以及可以通过该连接发送和接收数据的 API。</p><p>下面是一个简单示例</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript"><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">"wss://echo.websocket.org"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Connection open ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello WebSockets!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">"Received Message: "</span> <span class="token operator">+</span> evt<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Connection closed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="%E5%B8%B8%E7%94%A8-api" tabindex="-1"><span class="prefix"></span><span class="content">常用 API</span><span class="suffix"></span></h4><h5 id="websocket-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0" tabindex="-1"><span class="prefix"></span><span class="content">WebSocket 构造函数</span><span class="suffix"></span></h5><p>WebSocket 对象作为一个构造函数，用于新建 WebSocket 实例。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript"><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://localhost:8080'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行上面语句之后，客户端就会与服务器进行连接。</p><h5 id="%E4%BA%8B%E4%BB%B6%EF%BC%9A-onopen" tabindex="-1"><span class="prefix"></span><span class="content">事件： onopen</span><span class="suffix"></span></h5><p>实例对象的<code class="">onopen</code>属性，用于指定连接成功后的回调函数。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  <span class="token comment">// 发送消息一定要在建立连接成功以后</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello Server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果要指定多个回调函数，可以使用<code class="">addEventListener</code>方法。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello Server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="%E4%BA%8B%E4%BB%B6%EF%BC%9A-onclose" tabindex="-1"><span class="prefix"></span><span class="content">事件： onclose</span><span class="suffix"></span></h5><p>实例对象的<code class="">onclose</code>属性，用于指定连接关闭后的回调函数。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> code <span class="token operator">=</span> event<span class="token punctuation">.</span>code<span class="token punctuation">;</span>
  <span class="token keyword">var</span> reason <span class="token operator">=</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">;</span>
  <span class="token keyword">var</span> wasClean <span class="token operator">=</span> event<span class="token punctuation">.</span>wasClean<span class="token punctuation">;</span>
  <span class="token comment">// handle close event</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> code <span class="token operator">=</span> event<span class="token punctuation">.</span>code<span class="token punctuation">;</span>
  <span class="token keyword">var</span> reason <span class="token operator">=</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">;</span>
  <span class="token keyword">var</span> wasClean <span class="token operator">=</span> event<span class="token punctuation">.</span>wasClean<span class="token punctuation">;</span>
  <span class="token comment">// handle close event</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h5 id="%E4%BA%8B%E4%BB%B6%EF%BC%9A-onmessage" tabindex="-1"><span class="prefix"></span><span class="content">事件： onmessage</span><span class="suffix"></span></h5><p>实例对象的<code class="">onmessage</code>属性，用于指定收到服务器数据后的回调函数。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token comment">// 处理数据</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token comment">// 处理数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>注意，服务器数据可能是文本，也可能是二进制数据（<code class="">blob</code>对象或<code class="">Arraybuffer</code>对象）。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> event<span class="token punctuation">.</span>data <span class="token operator">===</span> String<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Received data string"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data <span class="token keyword">instanceof</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> buffer <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Received arraybuffer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>除了动态判断收到的数据类型，也可以使用<code class="">binaryType</code>属性，显式指定收到的二进制数据类型。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript"><span class="token comment">// 收到的是 blob 数据</span>
ws<span class="token punctuation">.</span>binaryType <span class="token operator">=</span> <span class="token string">"blob"</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 收到的是 ArrayBuffer 数据</span>
ws<span class="token punctuation">.</span>binaryType <span class="token operator">=</span> <span class="token string">"arraybuffer"</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">.</span>byteLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h5 id="%E4%BA%8B%E4%BB%B6%EF%BC%9Aonerror" tabindex="-1"><span class="prefix"></span><span class="content">事件：onerror</span><span class="suffix"></span></h5><p>实例对象的<code class="">onerror</code>属性，用于指定报错时的回调函数。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">socket<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle error event</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

socket<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// handle error event</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="%E6%96%B9%E6%B3%95%EF%BC%9Asend()" tabindex="-1"><span class="prefix"></span><span class="content">方法：send()</span><span class="suffix"></span></h5><p>实例对象的<code class="">send()</code>方法用于向服务器发送数据。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'your message'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>发送 Blob 对象的例子。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript"><span class="token keyword">var</span> file <span class="token operator">=</span> document
  <span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'input[type="file"]'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>发送 ArrayBuffer 对象的例子。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript"><span class="token comment">// Sending canvas ImageData as ArrayBuffer</span>
<span class="token keyword">var</span> img <span class="token operator">=</span> canvas_context<span class="token punctuation">.</span><span class="token function">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> binary <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> img<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  binary<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> img<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>binary<span class="token punctuation">.</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="%E6%96%B9%E6%B3%95%EF%BC%9Aclose()" tabindex="-1"><span class="prefix"></span><span class="content">方法：close()</span><span class="suffix"></span></h5><p>实例对象的 <code class="">close()</code> 方法用于关闭连接。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>连接关闭之后会触发实例对象的 <code class="">onclose</code> 事件。</p></blockquote><h5 id="%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7%EF%BC%9Abufferedamount" tabindex="-1"><span class="prefix"></span><span class="content">实例属性：bufferedAmount</span><span class="suffix"></span></h5><p>实例对象的<code class="">bufferedAmount</code>属性，表示还有多少字节的二进制数据没有发送出去。它可以用来判断发送是否结束。</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript"><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBuffer</span><span class="token punctuation">(</span><span class="token number">10000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>socket<span class="token punctuation">.</span>bufferedAmount <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送完毕</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 发送还没结束</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="%E6%9C%8D%E5%8A%A1%E7%AB%AF-websocket-%E5%AE%9E%E7%8E%B0" tabindex="-1"><span class="prefix"></span><span class="content">服务端 WebSocket 实现</span><span class="suffix"></span></h3><p>WebSocket 服务器的实现，可以查看维基百科的<a href="https://en.wikipedia.org/wiki/Comparison_of_WebSocket_implementations" target="_blank" rel="noopener">列表</a>。</p><p>常用的 Node 实现有以下三种。</p><ul><li><a href="https://github.com/uWebSockets/uWebSockets" target="_blank" rel="noopener">µWebSockets</a></li><li><a href="http://socket.io/" target="_blank" rel="noopener">Socket.IO</a><ul><li>服务端实现<ul><li>提供了对所有流行的服务端的支持，例如 Java、PHP、Python、Node.js 等</li></ul></li><li>客户端实现<ul><li>浏览器</li></ul></li></ul></li><li><a href="https://github.com/theturtle32/WebSocket-Node" target="_blank" rel="noopener">WebSocket-Node</a></li></ul><p>具体的用法请查看它们的文档，这里我们以 Socket.IO 为例。</p><h3 id="%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B%EF%BC%9A%E8%81%8A%E5%A4%A9%E5%AE%A4" tabindex="-1"><span class="prefix"></span><span class="content">综合案例：聊天室</span><span class="suffix"></span></h3><h4 id="%E6%A1%88%E4%BE%8B%E6%BC%94%E7%A4%BA" tabindex="-1"><span class="prefix"></span><span class="content">案例演示</span><span class="suffix"></span></h4><p><a href="https://socket.io/demos/chat/" target="_blank" rel="noopener">https://socket.io/demos/chat/</a></p><h4 id="%E5%BC%80%E5%A7%8B" tabindex="-1"><span class="prefix"></span><span class="content">开始</span><span class="suffix"></span></h4><ul><li><p>创建项目目录 <code class="">chat</code></p></li><li><p><code class="">npm init -y</code> 初始化 <code class="">package.json</code> 文件</p></li><li><p><code class="">npm install express</code></p></li><li><p>写入以下代码</p></li></ul><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Server</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'&lt;h1&gt;Hello world&lt;/h1&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listening on *:3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ul><li>启动服务测试</li><li>服务静态网页</li></ul><p>将 <code class="">app.get(/)</code> 代码替换为以下内容</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'./public'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>测试页面访问</li><li>使用 Socket.IO<ul><li>安装 <code class="">npm i socket.io</code></li></ul></li><li>服务端代码修改如下</li></ul><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Server</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span>
<span class="token keyword">const</span> io <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'socket.io'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>http<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">'./public/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token parameter">socket</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a user connected'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

http<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'listening on *:3000'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ul><li>在网页中</li></ul><div class="language-html ext-html code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-html line-numbers-mode"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/socket.io/socket.io.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 默认链接当前网页地址，也就是 ws://localhost:3000</span>
  <span class="token keyword">var</span> socket <span class="token operator">=</span> <span class="token function">io</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>刷新网页测试效果</li><li>每一个 socket 都有一个 <code class="">disconnect</code> 事件</li></ul><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">io<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'connection'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a user connected'</span><span class="token punctuation">)</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'disconnect'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'user disconnected'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>刷新网页测试效果</li><li>客户端发送消息</li></ul><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'chat message'</span><span class="token punctuation">,</span> <span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>服务端接收消息</li></ul><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'chat message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'message: '</span> <span class="token operator">+</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>测试</li><li>给当前连接 socket 发送消息</li></ul><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span> <span class="token string">'消息'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>服务端发送广播消息</li></ul><p>如果你想向除了某个套接字以外的所有人发送消息</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">socket<span class="token punctuation">.</span>broadcast<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>将消息发送给所有人，包括发送消息的客户端</p><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">io<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'chat message'</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>客户端接收消息</li></ul><div class="language-javascript ext-javascript code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-javascript line-numbers-mode"><code class="language-javascript">socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'chat message'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#messages'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;li&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><p>测试</p></li><li><p>其它功能</p></li><li><p>当有人连接或断开连接时，向连接的用户广播消息</p></li><li><p>添加对昵称的支持</p></li><li><p>不要向发送它的用户发送相同的消息。而是在他按下回车后直接附加消息</p></li><li><p>添加“{user}正在输入”功能。 显示谁在线。 添加私人消息。 分享您的改进！</p></li></ul><h4 id="%E7%94%A8%E6%88%B7%E6%B3%A8%E5%86%8C" tabindex="-1"><span class="prefix"></span><span class="content">用户注册</span><span class="suffix"></span></h4><h4 id="%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF" tabindex="-1"><span class="prefix"></span><span class="content">发送消息</span><span class="suffix"></span></h4><h4 id="%E6%80%BB%E7%BB%93-1" tabindex="-1"><span class="prefix"></span><span class="content">总结</span><span class="suffix"></span></h4><h3 id="%E7%9B%B8%E5%85%B3%E9%93%BE%E6%8E%A5" tabindex="-1"><span class="prefix"></span><span class="content">相关链接</span><span class="suffix"></span></h3><ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/WebSocket" target="_blank" rel="noopener">MDN WebSocket</a></li><li><a href="https://socket.io/" target="_blank" rel="noopener">SOCKET.IO 官网</a></li><li><a href="https://github.com/socketio/socket.io" target="_blank" rel="noopener">SOCKET.IO GitHub仓库</a></li><li><a href="http://www.ruanyifeng.com/blog/2017/05/websocket.html" target="_blank" rel="noopener">WebSocket 教程</a></li><li><a href="http://websocket.org/echo.html" target="_blank" rel="noopener">WebSocket Echo Test</a></li></ul></div><div pt-10=""><div class="flex justify-between"><a href="/post/2019/2019-4-16-vue-cli3+to-plugin" class="text-gray-500"><span class="text-gray-500">上一篇: </span><span class="text-gray-500">Vuecli3+发布组件库到npm</span></a></div><div class="flex justify-between"><a href="/post/2019/2019-4-3-sentry-sourcemap" class="text-gray-500"><span class="text-gray-500">下一篇: </span><span class="text-gray-500">记sentry配置sourcemap后的优化</span></a></div></div></div></main><nav text-xl="" mt-6="" text-center="" py-10="" class="footer" style="--3b7ca6b3:rgba(92, 110, 130, 0.05)"><a href="/" class="icon-btn mx-2" title="Home"><div i-iconoir:home-simple-door=""></div></a><button class="icon-btn mx-2 !outline-none" title="Toggle dark mode"><div i="carbon-sun dark:carbon-moon"></div></button><a href="/about" class="icon-btn mx-2" title="About"><div i-carbon-dicom-overlay=""></div></a><a href="/pic" class="icon-btn mx-2" title="图集"><div i-ph:image-fill=""></div></a><a class="icon-btn mx-2" rel="noreferrer" href="https://github.com/artiely" target="_blank" title="GitHub"><div i-carbon-logo-github=""></div></a></nav><!--]--><!--teleport start--><div class="el-overlay" style="z-index:3054;display:none"><!--[--><!--[--><div aria-modal="true" aria-label="评论" aria-describedby="el-id-9945-106" class="el-drawer rtl" style="width:620px" role="dialog"><span class="el-drawer__sr-focus" tabindex="-1"></span><header class="el-drawer__header"><!--[--><span id="el-id-9945-107" role="heading" class="el-drawer__title">评论</span><!--]--><button aria-label="Close this dialog" class="el-drawer__close-btn" type="button"><i class="el-icon el-drawer__close" style=""><!--[--><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"></path></svg><!--]--></i></button></header><!--v-if--><!--v-if--></div><!--]--><!--]--></div><!--teleport end--><div class="i-ant-design:comment-outlined icon" title="评论"></div><!--]--></div><script>window.__INITIAL_STATE__='{"pinia":{"data":{"bookmark":[{"version":3,"lists":[{"title":"博客","cards":[{"title":"Hacker News","url":"https://news.ycombinator.com/","favIconUrl":"https://news.ycombinator.com/favicon.ico","customTitle":"","customDescription":""},{"title":"酷壳 – CoolShell.cn","url":"https://coolshell.cn/","favIconUrl":"https://coolshell.cn/favicon.ico","customTitle":"","customDescription":""},{"title":"OurJS 爱我技术 我们的技术-IT文摘 JavaScript社区 Node.JS社区 前端社区 全端论坛 MongoDB html5 CSS3 开源社区 | OurJS","url":"http://ourjs.com/home","favIconUrl":"http://ourjs.com/ourjs/img/favicon.ico","customTitle":"OurJS","customDescription":"OurJS 爱我技术 我们的技术-IT文摘 JavaScript社区 Node.JS社区 前端社区 全端论坛 MongoDB html5 CSS3 开源社区 | OurJS"},{"title":"开始Web自动化测试 · CukeTest帮助文档","url":"http://cuketest.com/zh-cn/web/web_auto.html","favIconUrl":"http://cuketest.com/zh-cn/assets/images/favicon.ico","customTitle":"","customDescription":""},{"title":"好奇猫学院","url":"http://haoduoshipin.com/","favIconUrl":"","customTitle":"","customDescription":""},{"title":"Josh W Comeau","url":"https://www.joshwcomeau.com/","favIconUrl":"https://www.joshwcomeau.com/assets/favicon.png?v=4","customTitle":"","customDescription":""},{"title":"Smashing Magazine — For Web Designers And Developers","url":"https://www.smashingmagazine.com/","favIconUrl":"https://www.smashingmagazine.com/images/favicon/favicon.svg","customTitle":"","customDescription":""},{"title":"CSS-Tricks - Tips, Tricks, and Techniques on using Cascading Style Sheets.","url":"https://css-tricks.com/","favIconUrl":"https://css-tricks.com/favicon.svg","customTitle":"","customDescription":""},{"title":"Medium","url":"https://medium.com/","favIconUrl":"https://miro.medium.com/1*m-R_BkNf1Qjr1YbyOIJY2w.png","customTitle":"","customDescription":""},{"title":"DEV Community 👩‍💻👨‍💻 - Latest posts","url":"https://dev.to/latest","favIconUrl":"https://res.cloudinary.com/practicaldev/image/fetch/s--E8ak4Hr1--/c_limit,f_auto,fl_progressive,q_auto,w_32/https://dev-to.s3.us-east-2.amazonaws.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Blog - JakeArchibald.com","url":"https://jakearchibald.com/","favIconUrl":"https://jakearchibald.com/c/favicon-67801369.png","customTitle":"","customDescription":""},{"title":"Red Stapler | Coding Tutorials and Development Tips","url":"https://redstapler.co/","favIconUrl":"https://redstapler.co/wp-content/uploads/2016/12/cropped-favicon-32x32.png","customTitle":"","customDescription":""},{"title":"阮一峰的网络日志","url":"https://www.ruanyifeng.com/blog/","favIconUrl":"https://www.ruanyifeng.com/favicon.ico","customTitle":"","customDescription":""}],"labels":[{"title":"blog","color":"blue"}]}]},{"version":3,"lists":[{"title":"灵感","cards":[{"title":"Awwwards - Website Awards - Best Web Design Trends","url":"https://www.awwwards.com/","favIconUrl":"https://assets.awwwards.com/assets/images/favicon.svg","customTitle":"","customDescription":""},{"title":"(166) Pinterest","url":"https://www.pinterest.com/","favIconUrl":"https://s.pinimg.com/webapp/favicon-54a5b2af.png","customTitle":"Pinterest","customDescription":"Pinterest"},{"title":"Godly — The Best Web Design Inspiration","url":"https://godly.website/","favIconUrl":"https://godly.website/favicon.png","customTitle":"","customDescription":""},{"title":"OpenProcessing - Creative Coding for the Curious Mind","url":"https://openprocessing.org/","favIconUrl":"https://openprocessing.org/assets/img/logo/favicons/favicon.ico","customTitle":"","customDescription":""},{"title":"No images for this search have been found — Yandex.Images","url":"https://yandex.com/images/search","favIconUrl":"https://yastatic.net/images-thumbs/_/8cS_MbHl6VBweqVjWeI-eNy0tzE.ico","customTitle":"","customDescription":""},{"title":"Dribbble - Discover the World’s Top Designers & Creative Professionals","url":"https://dribbble.com/","favIconUrl":"https://cdn.dribbble.com/assets/favicon-b38525134603b9513174ec887944bde1a869eb6cd414f4d640ee48ab2a15a26b.ico","customTitle":"","customDescription":""},{"title":"Similarsites.com - Easily Explore alternative websites","url":"https://www.similarsites.com/","favIconUrl":"https://www.similarsites.com/static/favicon.png","customTitle":"","customDescription":""}],"labels":[]}]},{"version":3,"lists":[{"title":"学习","cards":[{"title":"Frontend Masters — Learn JavaScript, React, Vue & Angular from Masters of Front-End Development!","url":"https://frontendmasters.com/","favIconUrl":"https://frontendmasters.com/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Three.js Journey — Learn WebGL with Three.js","url":"https://threejs-journey.com/#","favIconUrl":"https://threejs-journey.com/assets/favicons/favicon.ico","customTitle":"","customDescription":""},{"title":"JavaScript Garden","url":"http://bonsaiden.github.io/JavaScript-Garden/","favIconUrl":"http://bonsaiden.github.io/JavaScript-Garden/favicon.ico?v=2","customTitle":"","customDescription":""},{"title":"The Book of Shaders","url":"https://thebookofshaders.com/?lan=ch","favIconUrl":"https://thebookofshaders.com/favicon.gif","customTitle":"","customDescription":""},{"title":"Creative Coding TW - 互動程式創作台灣站 | 蒐集互動設計案例、教學與業界資源，幫助你一起進入互動程式創作的產業","url":"https://creativecoding.in/?utm_source=youtube&amp%3Butm_medium=weekend-chat&amp%3Butm_campaign=200912","favIconUrl":"https://creativecoding.in/wp-content/uploads/2022/03/cropped-cct-logo-icon-2-32x32.png","customTitle":"","customDescription":""},{"title":"Free JavaScript Resources | Java5cript.com - Learn JavaScript for free","url":"https://www.java5cript.com/","favIconUrl":"https://www.java5cript.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Codrops - 网络专业人士的创意前端资源和灵感","url":"https://tympanus.net/codrops/","favIconUrl":"https://i7x7p5b7.stackpathcdn.com/codrops/wp-content/themes/codropstheme03/favicons/favicon.ico?v=2","customTitle":"","customDescription":""},{"title":"The Modern JavaScript Tutorial","url":"https://javascript.info/","favIconUrl":"https://javascript.info/img/favicon/favicon.png","customTitle":"","customDescription":""},{"title":"lib.d.ts | 深入理解 TypeScript","url":"https://jkchao.github.io/typescript-book-chinese/typings/lib.html#%E4%BF%AE%E6%94%B9%E5%8E%9F%E5%A7%8B%E7%B1%BB%E5%9E%8B","favIconUrl":"https://jkchao.github.io/typescript-book-chinese/logo.png","customTitle":"理解 TypeScript","customDescription":"lib.d.ts | 深入理解 TypeScript"},{"title":"大前端面试宝典 - 图解前端","url":"https://lucifer.ren/fe-interview/#/","favIconUrl":"https://lucifer.ren/favicon.ico","customTitle":"","customDescription":""},{"title":"Learn to Code — For Free — Coding Courses for Busy People","url":"https://www.freecodecamp.org/","favIconUrl":"https://www.freecodecamp.org/favicon-32x32.png?v=6cba562cbd10e31af925a976f3db73f7","customTitle":"","customDescription":""},{"title":"The Complete Flutter Development Bootcamp with Dart | The App Brewery","url":"https://www.appbrewery.co/p/flutter-development-bootcamp-with-dart","favIconUrl":"https://process.fs.teachablecdn.com/ADNupMnWyR7kCWRvm76Laz/resize=width:32,height:32/https://d2vvqscadf4c1f.cloudfront.net/vz7d3KSRSQ6tfzXoQJfE_LABlogoCircularSmall.png","customTitle":"","customDescription":""},{"title":"JavaScript Promise迷你书（中文版）","url":"http://liubin.org/promises-book/","favIconUrl":"http://liubin.org/promises-book/public/img/favicon.ico","customTitle":"","customDescription":""},{"title":"Free JavaScript Resources | Java5cript.com - Learn JavaScript for free","url":"https://www.java5cript.com/","favIconUrl":"https://www.java5cript.com/favicon.ico","customTitle":"","customDescription":""},{"title":"极客时间","url":"https://time.geekbang.org/course/detail/269-193915","favIconUrl":"https://static001.geekbang.org/static/time/icon/favicon-32x32.jpg","customTitle":"","customDescription":""},{"title":"All the tags! | HackerNoon","url":"https://hackernoon.com/tagged","favIconUrl":"https://hackernoon.com/favicon.ico","customTitle":"HackerNoon","customDescription":"All the tags! | HackerNoon"},{"title":"Learn VIM while playing a game - VIM Adventures","url":"https://vim-adventures.com/","favIconUrl":"","customTitle":"","customDescription":""}],"labels":[]}]},{"version":3,"lists":[{"title":"JS工具","cards":[{"title":"regex101: build, test, and debug regex","url":"https://regex101.com/","favIconUrl":"https://regex101.com/static/assets/favicon.ico","customTitle":"regex","customDescription":"创建，测试，调试正则"},{"title":"Three Nebula - A Particle System Engine For ThreeJs","url":"https://three-nebula.org/","favIconUrl":"https://three-nebula.org/favicon/favicon.ico","customTitle":"ThreeJs离子","customDescription":"Three Nebula - A Particle System Engine For ThreeJs"},{"title":"A lightweight Node.js private proxy registry | Verdaccio","url":"https://verdaccio.org/zh-cn/","favIconUrl":"https://verdaccio.org/zh-CN/img/logo/uk/verdaccio-tiny-uk-no-bg.svg","customTitle":"Nodejs Npm私有仓库","customDescription":"A lightweight Node.js private proxy registry | Verdaccio"},{"title":"objkt.com | Tezos 上最大的 NFT 市场","url":"https://objkt.com/","favIconUrl":"https://objkt.com/favicon.ico","customTitle":"Tezos 上最大的 NFT 市场","customDescription":"objkt.com | Tezos 上最大的 NFT 市场"},{"title":"Random User Generator | Home","url":"https://randomuser.me/","favIconUrl":"https://randomuser.me/favicon.ico","customTitle":"Random User Generator","customDescription":"随机用户api"},{"title":"RxMarbles: Interactive diagrams of Rx Observables","url":"https://rxmarbles.com/#every","favIconUrl":"https://rxmarbles.com/favicon.png","customTitle":"Interactive diagrams of Rx Observables","customDescription":"可视化RXjs"},{"title":"RunKit + npm: dayjs | RunKit","url":"https://runkit.com/embed/7q6iei0v6p89","favIconUrl":"https://runkit.com/favicon.ico","customTitle":"RunKit + npm","customDescription":"浏览器中测试你的nodejs包"},{"title":"All – Tiny Helpers","url":"https://tiny-helpers.dev/","favIconUrl":"https://tiny-helpers.dev/favicon-32x32.png","customTitle":"","customDescription":""}],"labels":[]}]},{"version":3,"lists":[{"title":"CSS工具","cards":[{"title":"Gradient Collection: Subtle Backgrounds - Light","url":"https://www.gradientmagic.com/collection/subtlebg_light","favIconUrl":"https://www.gradientmagic.com/favicon/favicon.ico","customTitle":"CSS 背景","customDescription":"Gradient Collection: Subtle Backgrounds - Light"},{"title":"CSSのコピペだけ！おしゃれな見出しのデザイン例まとめ68選","url":"https://saruwakakun.com/html-css/reference/h-design","favIconUrl":"https://saruwakakun.com/wp-content/uploads/2017/03/cropped-favicon-01-32x32.png","customTitle":"CSSのコピペだけ！おしゃれな見出しのデザイン例まとめ68選","customDescription":"CSS标题设计范例"},{"title":"TTF转WOFF2 - 在线转换图像文件","url":"https://www.aconvert.com/cn/image/ttf-to-woff2/","favIconUrl":"https://www.aconvert.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Neumorphism/Soft UI CSS shadow generator","url":"https://neumorphism.io/#e0e0e0","favIconUrl":"https://neumorphism.io/favicon.ico","customTitle":"Neumorphism/Soft UI CSS shadow generator","customDescription":"拟物化UI"},{"title":"outline access time • Google Material Icons • Iconify","url":"https://icon-sets.iconify.design/ic/outline-access-time/","favIconUrl":"https://icon-sets.iconify.design/favicon@32.png","customTitle":"Iconify","customDescription":"icon图标大全"},{"title":"CSS Gradient — Generator, Maker, and Background","url":"https://cssgradient.io/","favIconUrl":"https://cssgradient.io/images/favicon-23859487.png","customTitle":"","customDescription":""},{"title":"SDK、插件-有字库","url":"https://www.webfont.com/sdk/MV95ems/59295bfbf629d81914b80ad4.html","favIconUrl":"https://cdn.res.webfont.com/wwwroot/www/favicon.ico","customTitle":"","customDescription":""},{"title":"Smooth Shadow","url":"https://shadows.brumm.af/","favIconUrl":"https://shadows.brumm.af/favicon.svg","customTitle":"","customDescription":""},{"title":"Fancy Border Radius Generator","url":"https://9elements.github.io/fancy-border-radius/#30.30.43.33--433.433","favIconUrl":"https://9elements.github.io/fancy-border-radius/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Keyframes","url":"https://keyframes.app/","favIconUrl":"https://keyframes.app/img/icons/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Interactive CSS Grid Generator | Layoutit Grid","url":"https://grid.layoutit.com/","favIconUrl":"https://grid.layoutit.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Easing Gradients","url":"https://larsenwork.com/easing-gradients/","favIconUrl":"https://larsenwork.com/favicon.ico","customTitle":"","customDescription":""},{"title":"CSS Arrow Please - By Simon Hoejberg - @shojberg","url":"https://cssarrowplease.com/","favIconUrl":"","customTitle":"","customDescription":""},{"title":"CSS Color Gradient Generator: beautiful gradients for free","url":"https://mybrandnewlogo.com/color-gradient-generator","favIconUrl":"https://static.mybrandnewlogo.com/images/icon.svg","customTitle":"","customDescription":""},{"title":"Animista - CSS Animations on Demand","url":"https://animista.net/","favIconUrl":"","customTitle":"","customDescription":""},{"title":"CSS Duotone Generator","url":"https://cssduotone.com/","favIconUrl":"https://cssduotone.com/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"CSS Cuboid Generator w/ React && Prism 😎","url":"https://codepen.io/jh3y/pen/MWJdqBo","favIconUrl":"https://cpwebassets.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico","customTitle":"","customDescription":""},{"title":"Plaiceholder","url":"https://plaiceholder.co/","favIconUrl":"https://plaiceholder.co/assets/images/favicon/favicon@192px.png","customTitle":"","customDescription":""},{"title":"CSS Grid Generator","url":"https://cssgrid-generator.netlify.app/","favIconUrl":"https://cssgrid-generator.netlify.app/favicon.ico","customTitle":"","customDescription":""},{"title":"<css-doodle />","url":"https://css-doodle.com/","favIconUrl":"https://css-doodle.com/favicon.png","customTitle":"","customDescription":""},{"title":"CSSWAND","url":"https://www.csswand.dev/","favIconUrl":"https://www.csswand.dev/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Clippy — CSS clip-path maker","url":"https://bennettfeely.com/clippy/","favIconUrl":"https://bennettfeely.com/clippy/pics/favicon.png","customTitle":"","customDescription":""},{"title":"Type Scale - A Visual Calculator","url":"https://type-scale.com/","favIconUrl":"https://type-scale.com/favicon.ico","customTitle":"Type Scale","customDescription":"可视化文本布局调试"},{"title":"1-Line Layouts","url":"https://1linelayouts.glitch.me/","favIconUrl":"","customTitle":"1-Line Layouts","customDescription":"CSS经典布局"},{"title":"Omatsuri","url":"https://omatsuri.app/","favIconUrl":"https://omatsuri.app/assets/favicon.ico","customTitle":"Omatsuri","customDescription":"CSS网页工具"},{"title":"Fluid Typography","url":"https://fluid-typography.netlify.app/","favIconUrl":"","customTitle":"","customDescription":""}],"labels":[]}]},{"version":3,"lists":[{"title":"工具","cards":[{"title":"TinyPNG – Compress WebP, PNG and JPEG images intelligently","url":"https://tinypng.com/","favIconUrl":"https://tinypng.com/images/favicon.ico","customTitle":"TinyPNG","customDescription":"图片压缩webp,png,jpg"},{"title":"Excalidraw","url":"https://excalidraw.com/","favIconUrl":"https://excalidraw.com/favicon.ico","customTitle":"Excalidraw","customDescription":"手绘风流程图"},{"title":"让微信排版变Nice","url":"https://md.guozh.net/","favIconUrl":"https://md.guozh.net/favicon.svg","customTitle":"让微信排版变Nice","customDescription":"让微信排版变Nice 私有仓库"},{"title":"Lorem Picsum","url":"https://picsum.photos/","favIconUrl":"https://picsum.photos/assets/images/favicon/favicon-32x32.png","customTitle":"Lorem Picsum","customDescription":"随机图片"},{"title":"Create a Palette - Coolors","url":"https://coolors.co/ad343e-191308-454b66-677db7-9ca3db","favIconUrl":"https://coolors.co/assets/img/favicon.png","customTitle":"Coolors","customDescription":"调色板"},{"title":"🎁 Emoji cheat sheet for GitHub, Basecamp, Slack & more","url":"https://www.webfx.com/tools/emoji-cheat-sheet/","favIconUrl":"https://www.webfx.com/wp-content/uploads/2021/10/favicon.png","customTitle":"🎁 Emoji cheat sheet for GitHub, Basecamp, Slack & more","customDescription":"🎁 表情符号备忘单"},{"title":"Live2d Cubism 2","url":"https://imuncle.github.io/live2d/","favIconUrl":"https://imuncle.github.io/live2d/avatar.png","customTitle":"","customDescription":""},{"title":"HelloGitHub 第 74 期","url":"https://hellogithub.com/periodical/volume/74/","favIconUrl":"https://img.hellogithub.com/favicon/favicon.ico","customTitle":"HelloGitHub","customDescription":"HelloGitHub 推荐项目集合"},{"title":"过期域名查询 - 国际域名 - 站长工具","url":"http://del.chinaz.com/?kw=&p=0&bl=&el=&ds%5B%5D=1&ds%5B%5D=2&ds%5B%5D=3&pl=&sort=1&suffix%5B%5D=com&dt=1&date=1&pagesize=30&st=1&qq-pf-to=pcqq.c2c","favIconUrl":"http://csstools.chinaz.com/favicon.ico","customTitle":"过期域名查询 ","customDescription":"过期域名查询 - 国际域名 - 站长工具"},{"title":"Github Rank (China)","url":"https://githubrank.com/","favIconUrl":"https://githubrank.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Easing Functions Cheat Sheet","url":"https://easings.net/","favIconUrl":"https://easings.net/96.8aa68ac4.png","customTitle":"Easing Functions Cheat Sheet","customDescription":"缓动函数查询"},{"title":"Shields.io：开源项目的质量元数据徽章","url":"https://shields.io/","favIconUrl":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAABE0lEQVR4AWJkAIKkpCQ7TU3NySIiIlosQMCABejbMWAFf//8YXj77vWn27duZWVGz1nKGBYWZiQkJHSIkZGRmwEPCMxiwAt+/fz3/86VL8EAbuiiAKEoiMLwGcHdCQMBiUAlurDErmJ75tmKP8A3oiJyuF6vAxglws+0C5pv81GJaJdzhlWMMJssaaXM3C0CpmSDLAQtgH3BiCIVB2NRMKWEIoXQMBiLgjHGP9nQ+6ZPLgqGgs9xriDovX8A6Jjgw8ZyIigzn5xz+yZ+6O/tsz7Hy8tb/PLlywPAHMOFT/G3LwRc95fxPyerQCojuKwLDLQAGjoJWIzpAw1mw6bB0guHSYyMDBysnO/5hUTTGvM3rQEAI8qCnLiY3O4AAAAASUVORK5CYII=","customTitle":"Shields.io","customDescription":"开源项目的质量元数据徽章"},{"title":"diagrams.net","url":"https://app.diagrams.net/?tdsourcetag=s_pctim_aiomsg#G1fMS2g_n3fuV8FyS5o3faiOwtPGs-uL24","favIconUrl":"https://app.diagrams.net/favicon.ico","customTitle":"diagrams.net","customDescription":"流程图"},{"title":"Carbon | Create and share beautiful images of your source code","url":"https://carbon.now.sh/?bg=rgba(171%2C%20184%2C%20195%2C%201)&t=seti&wt=none&l=auto&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=true&pv=56px&ph=56px&ln=false&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false","favIconUrl":"https://carbon.now.sh/favicon.ico","customTitle":"Carbon","customDescription":"Carbon | Create and share beautiful images of your source code"},{"title":"Free Icons in SVG / PNG + Animated in GIF / APNG · Loading.io","url":"https://loading.io/icon/","favIconUrl":"https://loading.io/favicon.ico","customTitle":"Free Icons in SVG / PNG + Animated in GIF / APNG · Loading.io","customDescription":"带动画SVG"},{"title":"Text to ASCII Art Generator (TAAG)","url":"http://patorjk.com/software/taag/#p=testall&h=2&v=2&f=Bulbhead&t=tanjie","favIconUrl":"","customTitle":"Text to ASCII Art Generator (TAAG)","customDescription":"文字转ASCII"},{"title":"cubic-bezier(.17,.67,.83,.67) ✿ cubic-bezier.com","url":"https://cubic-bezier.com/#.17,.67,.83,.67","favIconUrl":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAtRJREFUWEftll1IU2Ecxp8zt6mtdHObbs2vTNT5QQ7SBHEZYpJG1E3khRdBXhR21U1SsF1U3oQQ3RVCMYT0IgpMVruI3IXL1CWmbmXqtOnMj/mx3ObaFudo4MfOYHK2ddH/7nBe3uf3Ps///SDQoVOBgBpRKb+KQKfOHxXtbdH/ABFzoDolCbr55X1pRwRAnsDDUHUZnkz8wE2jGTubLuwARYmHoa1QUCuXdekj6wBpu6a0ELExLNT0GNG3vBo5AHVBFm7nZeK7w4nWrxa0Tc4G3O2MR0Dm/ag4F0oxH8+mZtE58xOjaw7YXJvhBRBwOWjOy8StnAzYXG5cNgxTltekCNE1t0h71gV1IP1QHC7JkvFmbhHjjo2Ak3BYBOrTJHheWgCX14f7Y5N4YJpCFi8eTdmp0FhsGLCvHQxAKRagMUuGF9M2CmJvnRYL0H6qELL4WLRP29DYPwqn10cNOy8VoTJZgNfWBegXVw4GcITNRp1UiJfWBWz6tib+W+TWqkpJgtG+joa+EZjXf+36z2WxkMhhY8XjgcdHf90EjYDcw6St33bYXykWoK0kH9K4WFwfHEPHzDw15qAVFIC0UWtbwm//1grq0yXQlBagd2kV1/pHYV4P3BehwAQFqJWK0L2d/b3C49S+Vo1M4KHZAveeSEIR3TmWFoBNECgX8fFhwY678mNolmeiVv+Z+mayaAHyE3hU81w4KkZLUTaufhqhOp3pogW4kiaBJI6L1uIc3BkeR4tpimltaj5agIYMKR4rcqlTrOHjl11XKJMktABDZ8soB+TaXixvepjU3DVXQIA6qQivyk/gxqAJTyesYROnjcBQVYIYgoDy/QCcXm/kAewXK9E0aApL1+9dzb4IzkmE6K5QILVLD6vTHdbV74uAANBz5iT4HDaK3hnCLk7bA+Q7YHrDFT2AiChvizD+JgwV/h8A6HirBsFShUrOyHg/1H8AtegvrVPeS60AAAAASUVORK5CYII=","customTitle":"✿ cubic-bezier.com","customDescription":"生成贝塞尔曲线"},{"title":"Epic Spinners","url":"https://epic-spinners.epicmax.co/","favIconUrl":"https://epic-spinners.epicmax.co/favicon.ico","customTitle":"","customDescription":""}],"labels":[]}]},{"version":3,"lists":[{"title":"游戏","cards":[{"title":"Spine: Demos","url":"http://zh.esotericsoftware.com/spine-demos","favIconUrl":"http://zh.esotericsoftware.com/img/favicon/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Shadertoy BETA","url":"https://www.shadertoy.com/","favIconUrl":"https://www.shadertoy.com/img/favicon.ico","customTitle":"","customDescription":""},{"title":"Metaverse Full-Body Online 3D Avatar Creator | Ready Player Me","url":"https://readyplayer.me/","favIconUrl":"https://readyplayer.me/images/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Mixamo","url":"https://www.mixamo.com/#/","favIconUrl":"https://www.mixamo.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Explore 3D Models - Sketchfab","url":"https://sketchfab.com/3d-models?features=downloadable&sort_by=-likeCount","favIconUrl":"https://static.sketchfab.com/static/builds/web/dist/static/assets/images/favicon/2f53b6d625305dad5f61e53c5b3d8125-v2.png","customTitle":"","customDescription":""},{"title":"PlayCanvas WebGL Game Engine","url":"https://playcanvas.com/","favIconUrl":"https://playcanvas.com/static-assets/images/icons/favicon.png","customTitle":"","customDescription":""},{"title":"Medieval Town (base) 3D assets | OpenGameArt.org","url":"https://opengameart.org/content/medieval-town-base-3d-assets","favIconUrl":"https://opengameart.org/sites/all/themes/oga/opengameart2_favicon.ico","customTitle":"","customDescription":""},{"title":"Blend Swap | Home","url":"https://blendswap.com/","favIconUrl":"https://blendswap.com/static/img/favicon.ico","customTitle":"","customDescription":""},{"title":"Kaboom","url":"https://kaboomjs.com/","favIconUrl":"https://kaboomjs.com/site/img/k.png","customTitle":"","customDescription":""},{"title":"Unity Asset Collection | All Unity Assets That You Need","url":"https://unityassetcollection.com/","favIconUrl":"","customTitle":"","customDescription":""}],"labels":[]}]}],"books":[{"cover":"/bookmark/2022-06-08-14-43-51.png","name":"《边城》"},{"cover":"/bookmark/2022-05-22-18-58-23.png","name":"《在细雨中呼喊》"},{"cover":"/bookmark/2022-05-22-18-59-43.png","name":"《活着》"},{"cover":"/bookmark/2022-06-08-14-37-35.png","name":"《蛙》"},{"cover":"/bookmark/2022-06-08-14-40-51.png","name":"《丰乳肥臀》"},{"cover":"/bookmark/2022-06-08-14-41-41.png","name":"《天堂蒜薹之歌》"},{"cover":"/bookmark/2022-06-08-14-45-12.png","name":"《人间失格》"}],"skills":[{"name":"JavaScript","cover":"/bookmark/2022-05-23-08-24-51.png"},{"name":"HTML","cover":"/bookmark/2022-05-23-08-26-29.png"},{"name":"CSS","cover":"/bookmark/2022-05-23-08-27-06.png"},{"name":"Vue","cover":"/bookmark/2022-05-23-08-27-44.png"},{"name":"React","cover":"/bookmark/2022-05-23-08-28-52.png"},{"name":"Node","cover":"/bookmark/2022-05-23-08-30-12.png"},{"name":"TypeScript","cover":"/bookmark/2022-05-23-08-31-32.png"}],"tools":[{"name":"VS code","cover":"/bookmark/2022-05-23-17-23-45.png"},{"name":"Unity","cover":"/bookmark/2022-05-23-17-27-18.png"},{"name":"Termius","cover":"/bookmark/2022-05-23-17-28-46.png"},{"name":"Rider","cover":"/bookmark/2022-05-23-17-34-54.png"},{"name":"SourceTree","cover":"/bookmark/2022-05-23-17-36-38.png"},{"name":"Docker","cover":"/bookmark/2022-05-23-17-37-38.png"}]}}}'</script><link rel="stylesheet" href="/assets/README.e12ad7ac.css"><link rel="stylesheet" href="/assets/app.646ecbe7.css"></body></html>