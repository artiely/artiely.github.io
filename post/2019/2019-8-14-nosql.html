<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/192.png"><link rel="mask-icon" href="/192.png" color="#00aba9"><meta name="msapplication-TileColor" content="#00aba9"><meta name="theme-color" content="#ffffff"><script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("vueuse-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script><script type="module" async="" crossorigin="" src="/assets/app.8f9f5019.js"></script><style>@charset "UTF-8";.nav{padding:0 20px;height:80px;width:100vw;background:var(--primary-bg);backdrop-filter:saturate(180%) blur(20px);position:fixed;top:0;left:0;transform:translateZ(0);z-index:9;display:flex;align-items:center;justify-content:center;color:var(--c-text);transition:transform .3s;box-shadow:0 0 10px #0000001a}.nav nav{display:flex;align-items:center;justify-content:space-between;max-width:1200px;flex:1}.nav .logo{padding:20px;font-family:Josefin Sans,serif}.nav .menu{display:flex;align-items:center;justify-content:center}.nav .menu li{padding:20px;cursor:pointer}pre[class*=language-]::-webkit-scrollbar-thumb{background:var(--3b7ca6b3)}.icon{font-size:2em;color:#00aba9;cursor:pointer;position:fixed;bottom:2em;right:2em}.el-drawer{background-color:var(--c-bg)}@media screen and (max-width:768px){.el-drawer{width:100%!important}}.el-drawer__header{box-shadow:0 0 10px #0000001a;padding-bottom:32px;margin-bottom:0}:root{--main-bg-color:#fff;--main-text-color:#888888;--index-bg:radial-gradient(#eaf0ec, #c7d5cc);--clock-shadow:0 -15px 15px rgba(255, 255, 255, .05),inset 0 -15px 15px rgba(255, 255, 255, .05),0 15px 15px rgba(0, 0, 0, .1),inset 0 15px 15px rgba(0, 0, 0, .1);--card-bg:hsla(0, 0%, 100%, .5)}:root{--faded-yellow:#fdf9d3;--faded-green:#e4ffee;--faded-purple:#d2d6e9;--faded-red:#f8e8e5;--faded-blue:#eff7fa}*,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:currentColor}html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji"}body{margin:0;line-height:inherit}h1,h2,h3,h4,h5{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}strong{font-weight:bolder}code,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-size:1em}button{font-family:inherit;font-size:100%;line-height:inherit;color:inherit;margin:0;padding:0}button{text-transform:none}[type=button],button{-webkit-appearance:button;background-color:transparent;background-image:none}blockquote,figure,h1,h2,h3,h4,h5,p,pre{margin:0}ol,ul{list-style:none;margin:0;padding:0}button{cursor:pointer}img,svg{display:block;vertical-align:middle}img{max-width:100%;height:auto}:root{--el-color-white:#ffffff;--el-color-black:#000000;--el-color-primary-rgb:64,158,255;--el-color-success-rgb:103,194,58;--el-color-warning-rgb:230,162,60;--el-color-danger-rgb:245,108,108;--el-color-error-rgb:245,108,108;--el-color-info-rgb:144,147,153;--el-font-size-extra-large:20px;--el-font-size-large:18px;--el-font-size-medium:16px;--el-font-size-base:14px;--el-font-size-small:13px;--el-font-size-extra-small:12px;--el-font-family:"Helvetica Neue",Helvetica,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","\5fae\8f6f\96c5\9ed1",Arial,sans-serif;--el-font-weight-primary:500;--el-font-line-height-primary:24px;--el-index-normal:1;--el-index-top:1000;--el-index-popper:2000;--el-border-radius-base:4px;--el-border-radius-small:2px;--el-border-radius-round:20px;--el-border-radius-circle:100%;--el-transition-duration:.3s;--el-transition-duration-fast:.2s;--el-transition-function-ease-in-out-bezier:cubic-bezier(.645, .045, .355, 1);--el-transition-function-fast-bezier:cubic-bezier(.23, 1, .32, 1);--el-transition-all:all var(--el-transition-duration) var(--el-transition-function-ease-in-out-bezier);--el-transition-fade:opacity var(--el-transition-duration) var(--el-transition-function-fast-bezier);--el-transition-md-fade:transform var(--el-transition-duration) var(--el-transition-function-fast-bezier),opacity var(--el-transition-duration) var(--el-transition-function-fast-bezier);--el-transition-fade-linear:opacity var(--el-transition-duration-fast) linear;--el-transition-border:border-color var(--el-transition-duration-fast) var(--el-transition-function-ease-in-out-bezier);--el-transition-box-shadow:box-shadow var(--el-transition-duration-fast) var(--el-transition-function-ease-in-out-bezier);--el-transition-color:color var(--el-transition-duration-fast) var(--el-transition-function-ease-in-out-bezier);--el-component-size-large:40px;--el-component-size:32px;--el-component-size-small:24px}:root{color-scheme:light;--el-color-white:#ffffff;--el-color-black:#000000;--el-color-primary:#409eff;--el-color-primary-light-3:#79bbff;--el-color-primary-light-5:#a0cfff;--el-color-primary-light-7:#c6e2ff;--el-color-primary-light-8:#d9ecff;--el-color-primary-light-9:#ecf5ff;--el-color-primary-dark-2:#337ecc;--el-color-success:#67c23a;--el-color-success-light-3:#95d475;--el-color-success-light-5:#b3e19d;--el-color-success-light-7:#d1edc4;--el-color-success-light-8:#e1f3d8;--el-color-success-light-9:#f0f9eb;--el-color-success-dark-2:#529b2e;--el-color-warning:#e6a23c;--el-color-warning-light-3:#eebe77;--el-color-warning-light-5:#f3d19e;--el-color-warning-light-7:#f8e3c5;--el-color-warning-light-8:#faecd8;--el-color-warning-light-9:#fdf6ec;--el-color-warning-dark-2:#b88230;--el-color-danger:#f56c6c;--el-color-danger-light-3:#f89898;--el-color-danger-light-5:#fab6b6;--el-color-danger-light-7:#fcd3d3;--el-color-danger-light-8:#fde2e2;--el-color-danger-light-9:#fef0f0;--el-color-danger-dark-2:#c45656;--el-color-error:#f56c6c;--el-color-error-light-3:#f89898;--el-color-error-light-5:#fab6b6;--el-color-error-light-7:#fcd3d3;--el-color-error-light-8:#fde2e2;--el-color-error-light-9:#fef0f0;--el-color-error-dark-2:#c45656;--el-color-info:#909399;--el-color-info-light-3:#b1b3b8;--el-color-info-light-5:#c8c9cc;--el-color-info-light-7:#dedfe0;--el-color-info-light-8:#e9e9eb;--el-color-info-light-9:#f4f4f5;--el-color-info-dark-2:#73767a;--el-bg-color:#ffffff;--el-bg-color-page:#f2f3f5;--el-bg-color-overlay:#ffffff;--el-text-color-primary:#303133;--el-text-color-regular:#606266;--el-text-color-secondary:#909399;--el-text-color-placeholder:#a8abb2;--el-text-color-disabled:#c0c4cc;--el-border-color:#dcdfe6;--el-border-color-light:#e4e7ed;--el-border-color-lighter:#ebeef5;--el-border-color-extra-light:#f2f6fc;--el-border-color-dark:#d4d7de;--el-border-color-darker:#cdd0d6;--el-fill-color:#f0f2f5;--el-fill-color-light:#f5f7fa;--el-fill-color-lighter:#fafafa;--el-fill-color-extra-light:#fafcff;--el-fill-color-dark:#ebedf0;--el-fill-color-darker:#e6e8eb;--el-fill-color-blank:#ffffff;--el-box-shadow:0px 12px 32px 4px rgba(0, 0, 0, .04),0px 8px 20px rgba(0, 0, 0, .08);--el-box-shadow-light:0px 0px 12px rgba(0, 0, 0, .12);--el-box-shadow-lighter:0px 0px 6px rgba(0, 0, 0, .12);--el-box-shadow-dark:0px 16px 48px 16px rgba(0, 0, 0, .08),0px 12px 32px rgba(0, 0, 0, .12),0px 8px 16px -8px rgba(0, 0, 0, .16);--el-disabled-bg-color:var(--el-fill-color-light);--el-disabled-text-color:var(--el-text-color-placeholder);--el-disabled-border-color:var(--el-border-color-light);--el-overlay-color:rgba(0, 0, 0, .8);--el-overlay-color-light:rgba(0, 0, 0, .7);--el-overlay-color-lighter:rgba(0, 0, 0, .5);--el-mask-color:rgba(255, 255, 255, .9);--el-mask-color-extra-light:rgba(255, 255, 255, .3);--el-border-width:1px;--el-border-style:solid;--el-border-color-hover:var(--el-text-color-disabled);--el-border:var(--el-border-width) var(--el-border-style) var(--el-border-color);--el-svg-monochrome-grey:var(--el-border-color)}@-webkit-keyframes rotating{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.el-icon{--color:inherit;height:1em;width:1em;line-height:1em;display:inline-flex;justify-content:center;align-items:center;position:relative;fill:currentColor;color:var(--color);font-size:inherit}.el-icon svg{height:1em;width:1em}:root{--el-popup-modal-bg-color:var(--el-color-black);--el-popup-modal-opacity:.5}@-webkit-keyframes v-modal-in{0%{opacity:0}}@-webkit-keyframes v-modal-out{to{opacity:0}}@-webkit-keyframes dialog-fade-in{0%{transform:translate3d(0,-20px,0);opacity:0}to{transform:translateZ(0);opacity:1}}@-webkit-keyframes dialog-fade-out{0%{transform:translateZ(0);opacity:1}to{transform:translate3d(0,-20px,0);opacity:0}}@-webkit-keyframes modal-fade-in{0%{opacity:0}to{opacity:1}}@-webkit-keyframes modal-fade-out{0%{opacity:1}to{opacity:0}}.el-drawer{--el-drawer-bg-color:var(--el-dialog-bg-color, var(--el-bg-color));--el-drawer-padding-primary:var(--el-dialog-padding-primary, 20px)}.el-drawer{position:absolute;box-sizing:border-box;background-color:var(--el-drawer-bg-color);display:flex;flex-direction:column;box-shadow:var(--el-box-shadow-dark);overflow:hidden;transition:all var(--el-transition-duration)}.el-drawer__sr-focus:focus{outline:0!important}.el-drawer__header{align-items:center;color:#72767b;display:flex;margin-bottom:32px;padding:var(--el-drawer-padding-primary);padding-bottom:0}.el-drawer__header>:first-child{flex:1}.el-drawer__title{margin:0;flex:1;line-height:inherit;font-size:1rem}.el-drawer__close-btn{border:none;cursor:pointer;font-size:var(--el-font-size-extra-large);color:inherit;background-color:transparent;outline:0}.el-drawer__close-btn:focus i,.el-drawer__close-btn:hover i{color:var(--el-color-primary)}.el-drawer__close-btn .el-icon{font-size:inherit;vertical-align:text-bottom}.el-drawer.rtl{height:100%;top:0;bottom:0}.el-drawer.rtl{right:0}@-webkit-keyframes viewer-fade-in{0%{transform:translate3d(0,-20px,0);opacity:0}to{transform:translateZ(0);opacity:1}}@-webkit-keyframes viewer-fade-out{0%{transform:translateZ(0);opacity:1}to{transform:translate3d(0,-20px,0);opacity:0}}:root{--el-loading-spinner-size:42px;--el-loading-fullscreen-spinner-size:50px}@-webkit-keyframes loading-rotate{to{transform:rotate(360deg)}}@-webkit-keyframes loading-dash{0%{stroke-dasharray:1,200;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-40px}to{stroke-dasharray:90,150;stroke-dashoffset:-120px}}:root{--el-menu-active-color:var(--el-color-primary);--el-menu-text-color:var(--el-text-color-primary);--el-menu-hover-text-color:var(--el-color-primary);--el-menu-bg-color:var(--el-fill-color-blank);--el-menu-hover-bg-color:var(--el-color-primary-light-9);--el-menu-item-height:56px;--el-menu-sub-item-height:calc(var(--el-menu-item-height) - 6px);--el-menu-horizontal-sub-item-height:36px;--el-menu-item-font-size:var(--el-font-size-base);--el-menu-item-hover-fill:var(--el-color-primary-light-9);--el-menu-border-color:var(--el-border-color);--el-menu-base-level-padding:20px;--el-menu-level-padding:20px;--el-menu-icon-width:24px;--el-menu-icon-transform-closed:none;--el-menu-icon-transform-open:rotateZ(180deg)}@-webkit-keyframes msgbox-fade-in{0%{transform:translate3d(0,-20px,0);opacity:0}to{transform:translateZ(0);opacity:1}}@-webkit-keyframes msgbox-fade-out{0%{transform:translateZ(0);opacity:1}to{transform:translate3d(0,-20px,0);opacity:0}}.el-overlay{position:fixed;top:0;right:0;bottom:0;left:0;z-index:2000;height:100%;background-color:var(--el-overlay-color-lighter);overflow:auto}@-webkit-keyframes progress{0%{background-position:0 0}to{background-position:32px 0}}@-webkit-keyframes indeterminate{0%{left:-100%}to{left:100%}}@-webkit-keyframes el-skeleton-loading{0%{background-position:100% 50%}to{background-position:0 50%}}@-webkit-keyframes rotate{to{transform:rotate(360deg)}}@-webkit-keyframes dash{0%{stroke-dasharray:1,150;stroke-dashoffset:0}50%{stroke-dasharray:90,150;stroke-dashoffset:-35}to{stroke-dasharray:90,150;stroke-dashoffset:-124}}@-webkit-keyframes slideInRight-enter{0%{opacity:0;transform-origin:0 0;transform:translate(100%)}to{opacity:1;transform-origin:0 0;transform:translate(0)}}@-webkit-keyframes slideInRight-leave{0%{transform-origin:0 0;transform:translate(0);opacity:1}to{transform-origin:0 0;transform:translate(100%);opacity:0}}@-webkit-keyframes slideInLeft-enter{0%{opacity:0;transform-origin:0 0;transform:translate(-100%)}to{opacity:1;transform-origin:0 0;transform:translate(0)}}@-webkit-keyframes slideInLeft-leave{0%{transform-origin:0 0;transform:translate(0);opacity:1}to{transform-origin:0 0;transform:translate(-100%);opacity:0}}:root{--c-bg:#fafafa;--primary-bg:#fafafabf;--light-shadow:4px 2px 40px rgb(0 0 0 / 10%);--primary-color:#1c6b48;--c-brand:var(--primary-color);--el-color-white:var(--primary-color);--c-brand:#3fb9b8;--c-brand-light:#50e5e5;--c-text:#2c3e50;--c-text-light:#3a5169;--c-text-lighter:#4e6e8e;--c-text-lightest:#6a8bad;--c-text-quote:#999999;--c-bg:#ffffff;--c-bg-light:#f3f4f5;--c-bg-lighter:#eeeeee;--c-bg-navbar:var(--c-bg);--c-bg-sidebar:var(--c-bg);--c-bg-arrow:#cccccc;--c-border:#eaecef;--c-border-dark:#dfe2e5}@font-face{font-family:Josefin Sans;font-style:normal;font-weight:300;src:local("Josefin Sans Light"),local("JosefinSans-Light"),url(/fonts/Josefin-light.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:fallback}@font-face{font-family:Josefin Sans;font-style:normal;font-weight:400;src:local("Josefin Sans Regular"),local("JosefinSans-Regular"),url(/fonts/Josefin.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:fallback}@font-face{font-family:Consolas;font-style:normal;font-weight:400;src:url(/fonts/consola.ttf);font-display:fallback}@font-face{font-family:League Mono;src:url(/fonts/LeagueMono-Regular.woff2);font-display:fallback}.sino{font-size:16px;font-weight:400;line-height:1.5;overflow-wrap:break-word;word-wrap:break-word;hyphens:auto}.sino:after,.sino:before{content:"";display:table}.sino:after{clear:both}.sino>:first-child{margin-block-start:0!important}.sino>:last-child{margin-block-end:0!important}.sino figure{display:block;text-align:center}.sino figure>img{display:block;margin-inline-start:auto;margin-inline-end:auto}.sino h1,.sino h2,.sino h3,.sino h4,.sino h5{position:relative;margin:0;margin-block-start:24px;margin-block-end:12px;font-weight:600}.sino h1{margin-block-end:24px;font-size:1.6em;line-height:48px}.sino h2{font-size:1.3em;line-height:36px}.sino h3{font-size:1.2em;line-height:36px}.sino h4,.sino h5{font-size:1em;line-height:24px}.sino h1,.sino h2,.sino h3{letter-spacing:.05em}.sino h1+h2,.sino h2+h3,.sino h3+h4,.sino h4+h5{margin-block-start:12px}.sino a{text-decoration:none}.sino a:hover{padding-block-end:1px;border-block-end:1px solid currentColor;text-decoration:none}.sino strong{font-weight:600}.sino strong{font-weight:600}.sino{font-family:Helvetica Neue,helvetica,arial,Hei,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol}:root{--prism-scheme:light;--prism-foreground:#6e6e6e;--prism-background:#f4f4f4;--prism-comment:#a8a8a8;--prism-string:#555555;--prism-literal:#333333;--prism-keyword:#000000;--prism-function:#4f4f4f;--prism-deleted:#333333;--prism-class:#333333;--prism-builtin:#757575;--prism-property:#333333;--prism-namespace:#4f4f4f;--prism-punctuation:#ababab;--prism-decorator:var(--prism-class);--prism-operator:var(--prism-punctuation);--prism-number:var(--prism-literal);--prism-boolean:var(--prism-literal);--prism-variable:var(--prism-literal);--prism-constant:var(--prism-literal);--prism-symbol:var(--prism-literal);--prism-interpolation:var(--prism-literal);--prism-selector:var(--prism-keyword);--prism-keyword-control:var(--prism-keyword);--prism-regex:var(--prism-string);--prism-json-property:var(--prism-property);--prism-inline-background:var(--prism-background);--prism-comment-style:italic;--prism-url-decoration:underline;--prism-line-number:#a5a5a5;--prism-line-number-gutter:#333333;--prism-line-highlight-background:#eeeeee;--prism-selection-background:#aaaaaa;--prism-marker-color:var(--prism-foreground);--prism-marker-opacity:.4;--prism-marker-font-size:.8em;--prism-font-size:1em;--prism-line-height:1.4em;--prism-font-family:monospace;--prism-inline-font-size:var(--prism-font-size);--prism-block-font-size:var(--prism-font-size);--prism-tab-size:2;--prism-block-padding-x:1em;--prism-block-padding-y:1em;--prism-block-margin-x:0;--prism-block-margin-y:.5em;--prism-block-radius:.3em;--prism-inline-padding-x:.3em;--prism-inline-padding-y:.1em;--prism-inline-radius:.3em}code[class*=language-],div[class*=language-],pre[class*=language-]{font-size:var(--prism-font-size);font-family:var(--prism-font-family);direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:var(--prism-line-height);-moz-tab-size:var(--prism-tab-size);-o-tab-size:var(--prism-tab-size);tab-size:var(--prism-tab-size);-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;color:var(--prism-foreground)!important}div[class*=language-],pre[class*=language-]{font-size:var(--prism-block-font-size);padding:var(--prism-block-padding-y) var(--prism-block-padding-x);margin:var(--prism-block-margin-y) var(--prism-block-margin-x);border-radius:var(--prism-block-radius);overflow:auto;background:var(--prism-background)}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{background:var(--prism-selection-background)}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:var(--prism-selection-background)}.token.comment{color:var(--prism-comment);font-style:var(--prism-comment-style)}.token.interpolation{color:var(--prism-interpolation)}.token.string{color:var(--prism-string)}.token.punctuation{color:var(--prism-punctuation)}.token.operator{color:var(--prism-operator)}.token.constant{color:var(--prism-constant)}.language-json .token.boolean,.token.boolean{color:var(--prism-boolean)}.token.number{color:var(--prism-number)}.token.variable{color:var(--prism-variable)}.token.keyword{color:var(--prism-keyword)}.token.function{color:var(--prism-function)}.token.important{font-weight:700}.token.class-name{color:var(--prism-class)}.token.builtin{color:var(--prism-builtin)}.token.entity,.token.property{color:var(--prism-property)}.language-json .token.property{color:var(--prism-json-property)}:root{--c-tip:#42b983;--c-info:hsl(245deg 100% 60%);--c-info-bg:hsl(210deg 55% 92%);--c-tip-bg:hsl(160deg 100% 40% / 10%);--c-tip-title:var(--c-text);--c-tip-text:var(--c-text);--c-tip-text-accent:var(--c-text-accent);--c-warning:hsl(37deg 100% 50%);--c-warning-bg:hsl(52deg 100% 50% / 25%);--c-warning-text-accent:var(--c-text);--c-danger:#cc0000;--c-danger-bg:#ffe0e0;--c-danger-title:#990000;--c-danger-text:#660000;--c-danger-text-accent:var(--c-text);--c-details-bg:#eeeeee}html:not(.dark){--prism-foreground:#393a34;--prism-background:#fbfbfb;--prism-comment:#a0ada0;--prism-string:#b56959;--prism-literal:#2f8a89;--prism-number:#296aa3;--prism-keyword:#1c6b48;--prism-function:#6c7834;--prism-boolean:#1c6b48;--prism-constant:#a65e2b;--prism-deleted:#a14f55;--prism-class:#2993a3;--prism-builtin:#ab5959;--prism-property:#b58451;--prism-namespace:#b05a78;--prism-punctuation:#8e8f8b;--prism-decorator:#bd8f8f;--prism-regex:#ab5e3f;--prism-json-property:#698c96;--prism-font-family:ui-monospace,SFMono-Regular,SF Mono,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace,"League Mono",Consolas,-apple-system;--rainbow-gradient:linear-gradient(-90deg, #557e6d 0, #1b6787 30%, #81524c 50%, #36673b 70%, #575a31 90%, #345346 100%);--c-text-heading:#0f0f0d}.markdown-body{padding:100px 40px;max-width:52em;font-size:16px;margin:auto;box-sizing:border-box;color:var(--c-text);font-family:var(--font-family)}.markdown-body p{margin:1em 0;line-height:1.75;text-align:justify}.markdown-body li{line-height:1.75;text-align:justify}.markdown-body h1 .content{position:relative;color:var(--md-text);z-index:2;background-image:var(--rainbow-gradient,#fff);background-size:100%;background-repeat:repeat;-webkit-background-clip:text;-webkit-text-fill-color:transparent;-moz-background-clip:text;-moz-text-fill-color:transparent;filter:drop-shadow(0 0 2rem #000);text-shadow:none!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5{color:var(--c-text-heading)}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5{font-weight:600}.markdown-body a:not(.header-anchor){color:var(--c-brand);padding-block-end:1px;border-block-end:1px solid currentColor}.markdown-body code{color:var(--c-text-lighter)!important;padding:.15rem .5rem;margin:0 .25rem;background-color:var(--c-bg-light);border-radius:3px;overflow-wrap:break-word;transition:background-color var(--t-color);font-size:14px}div[class*=language-].ext-js:before{content:"js  ";position:absolute;top:.6rem;right:4rem;opacity:.5;text-transform:uppercase;font-size:14px}div[class*=language-].ext-json:before{content:"json  ";position:absolute;top:.6rem;right:4rem;opacity:.5;text-transform:uppercase;font-size:14px}div[class*=language-].ext-shell:before{content:"shell  ";position:absolute;top:.6rem;right:4rem;opacity:.5;text-transform:uppercase;font-size:14px}div[class*=language-].code-wrapper{padding:2.5em 0 1em;background-color:var(--prism-background);position:relative;border-radius:12px;overflow:hidden;margin-bottom:1em}div[class*=language-].code-wrapper .code-inner{position:relative;padding-left:2.5em;padding-right:.5em}pre[class*=language-]{position:relative;padding:0 0 0 .5em;margin:0;background:0 0;font-size:14px}pre[class*=language-] code{background-color:transparent;padding:0;margin:0}.line-numbers-wrapper{position:absolute;top:2.5rem;left:0;line-height:1.4;margin:0;text-align:right;padding-right:.5em;border-right:1px solid rgba(95,95,95,.06);width:2.5em;font-size:14px}.line-numbers-wrapper .line-number{display:inline-block;line-height:1.4;opacity:.5}.cbt-traffic_light{position:absolute;top:12px;left:13px;display:flex;align-items:center}.cbt-traffic_light span{margin-right:8px;width:12px;height:12px;border-radius:50%}.cbt-traffic_light span:nth-child(1){background-color:#ff5f56}.cbt-traffic_light span:nth-child(2){background-color:#ffbd2e}.cbt-traffic_light span:nth-child(3){background-color:#27c93f}[class*=language-]>span.copy{position:absolute;top:8px;right:8px;z-index:2;display:block;justify-content:center;align-items:center;border-radius:4px;height:40px;background-color:var(--vp-code-block-bg);cursor:pointer;background-image:var(--vp-icon-copy);background-position:50%;background-size:20px;background-repeat:no-repeat;transition:opacity .25s}[class*=language-]>span.copy:before{content:"\590d\5236\4ee3\7801";padding:2px 8px;border-radius:4px;font-size:10px;background:var(--c-bg-light);color:var(--c-text)}[class*=language-]>span.copy:hover:before{background:var(--c-bg-lighter)}[class*=language-]:hover>span.copy{opacity:1}body,html{--font-family:"League Mono",-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif;padding:0;margin:0;background-color:var(--c-bg);transition:background-color var(--t-color);font-family:var(--font-family);display:flex;flex-direction:column;min-height:100vh;width:100%;overflow-x:hidden;color:var(--c-text)}body{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:16px;color:var(--c-text)}#app{display:flex;flex-direction:column;min-height:100vh;width:100%;overflow-x:hidden}#app main.px-4{flex:1}a{font-weight:500;color:var(--c-text-accent);text-decoration:none;overflow-wrap:break-word}img{position:relative}img:after{position:absolute;width:100%;height:100%;content:"";display:block;top:0;left:0;background-color:var(--c-bg);background-size:100%}.i-ant-design\:comment-outlined{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 1024 1024' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M573 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40zm-280 0c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z'/%3E%3Cpath fill='currentColor' d='M894 345c-48.1-66-115.3-110.1-189-130v.1c-17.1-19-36.4-36.5-58-52.1c-163.7-119-393.5-82.7-513 81c-96.3 133-92.2 311.9 6 439l.8 132.6c0 3.2.5 6.4 1.5 9.4c5.3 16.9 23.3 26.2 40.1 20.9L309 806c33.5 11.9 68.1 18.7 102.5 20.6l-.5.4c89.1 64.9 205.9 84.4 313 49l127.1 41.4c3.2 1 6.5 1.6 9.9 1.6c17.7 0 32-14.3 32-32V753c88.1-119.6 90.4-284.9 1-408zM323 735l-12-5l-99 31l-1-104l-8-9c-84.6-103.2-90.2-251.9-11-361c96.4-132.2 281.2-161.4 413-66c132.2 96.1 161.5 280.6 66 412c-80.1 109.9-223.5 150.5-348 102zm505-17l-8 10l1 104l-98-33l-12 5c-56 20.8-115.7 22.5-171 7l-.2-.1C613.7 788.2 680.7 742.2 729 676c76.4-105.3 88.8-237.6 44.4-350.4l.6.4c23 16.5 44.1 37.1 62 62c72.6 99.6 68.5 235.2-8 330z'/%3E%3Cpath fill='currentColor' d='M433 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-carbon-dicom-overlay=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 32 32' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath d='M28 6v20H4V6h24m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z' fill='currentColor'/%3E%3Cpath d='M6 8h10v2H6z' fill='currentColor'/%3E%3Cpath d='M6 12h10v2H6z' fill='currentColor'/%3E%3Cpath d='M6 16h6v2H6z' fill='currentColor'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-carbon-logo-github=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 32 32' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' fill-rule='evenodd' d='M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2Z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-iconoir\:home-simple-door=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 24 24' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='none' stroke='currentColor' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M9 21H7a4 4 0 0 1-4-4v-6.292a4 4 0 0 1 1.927-3.421l5-3.03a4 4 0 0 1 4.146 0l5 3.03A4 4 0 0 1 21 10.707V17a4 4 0 0 1-4 4h-2m-6 0v-4a3 3 0 0 1 3-3v0a3 3 0 0 1 3 3v4m-6 0h6'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i-ph\:image-fill=""]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 256 256' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M168 100a12 12 0 0 1-12 12a12.3 12.3 0 0 1-8.5-3.5a11.9 11.9 0 0 1-3.5-8.5a12 12 0 0 1 24 0Zm64-44v144a16 16 0 0 1-16 16H40a16 16 0 0 1-16-16V56a16 16 0 0 1 16-16h176a16 16 0 0 1 16 16Zm-16 108.7V56H40v92.7L76.7 112a16.1 16.1 0 0 1 22.6 0l44.7 44.7l20.7-20.7a16.1 16.1 0 0 1 22.6 0Z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}[i~=carbon-sun]{--un-icon:url("data:image/svg+xml;utf8,%3Csvg preserveAspectRatio='xMidYMid meet' viewBox='0 0 32 32' width='1.2em' height='1.2em' xmlns='http://www.w3.org/2000/svg' %3E%3Cpath fill='currentColor' d='M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6ZM5.394 6.813L6.81 5.399l3.505 3.506L8.9 10.319zM2 15.005h5v2H2zm3.394 10.193L8.9 21.692l1.414 1.414l-3.505 3.506zM15 25.005h2v5h-2zm6.687-1.9l1.414-1.414l3.506 3.506l-1.414 1.414zm3.313-8.1h5v2h-5zm-3.313-6.101l3.506-3.506l1.414 1.414l-3.506 3.506zM15 2.005h2v5h-2z'/%3E%3C/svg%3E");mask:var(--un-icon) no-repeat;mask-size:100% 100%;-webkit-mask:var(--un-icon) no-repeat;-webkit-mask-size:100% 100%;background-color:currentColor;width:1.2em;height:1.2em}.icon-btn{display:inline-block;cursor:pointer;user-select:none;opacity:.75;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:150ms;transition-duration:.2s}.icon-btn:hover{--un-text-opacity:1;color:rgba(13,148,136,var(--un-text-opacity));opacity:1}.mx-2{margin-left:.5rem;margin-right:.5rem}[mt-6=""]{margin-top:1.5rem}.flex{display:flex}.justify-between{justify-content:space-between}.px-4{padding-left:1rem;padding-right:1rem}.py-10,[py-10=""]{padding-top:2.5rem;padding-bottom:2.5rem}[pt-10=""]{padding-top:2.5rem}.text-center,[text-center=""]{text-align:center}.text-left{text-align:left}.font-sans{font-family:"DM Sans",ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji"}[text-xl=""]{font-size:1.25rem;line-height:1.75rem}.text-gray-500{--un-text-opacity:1;color:rgba(107,114,128,var(--un-text-opacity))}.text-gray-700{--un-text-opacity:1;color:rgba(55,65,81,var(--un-text-opacity))}[color~="\#00aba9"]{--un-text-opacity:1;color:rgba(0,171,169,var(--un-text-opacity))}.\!outline-none{outline:2px solid transparent!important;outline-offset:2px!important}[content~="\#00aba9"]{content:"#00aba9"}[content~="\#ffffff"]{content:"#ffffff"}[content~="initial-scale\=1\.0"]{content:"initial-scale=1.0"}[content~="width\=device-width\2c "]{content:"width=device-width,"}:root{--md-text-color:#111827;--md-code-background:rgba(27,31,35,.05);--code-font:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}</style><link rel="preload" href="/assets/app.016e68df.css" as="style"><link rel="manifest" href="/manifest.webmanifest"><link rel="modulepreload" crossorigin="" href="/assets/2019-8-14-nosql.5f3055ab.js"><link rel="preload" href="/assets/2019-8-14-nosql.0c9c6b89.css" as="style"><title>NoSQL数据库</title><meta name="description" content="artiely blog"><meta property="og:title" content="NoSQL数据库"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="head:count" content="3"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/Josefin-light.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/Josefin.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/num.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/ipix.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/Nunito.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/consola.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/Artiely.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/MicrosoftYaqiHeiLight.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="/fonts/LeagueMono-Regular.woff2"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmmono/v10/aFTU7PB1QTsUX8KYhh0.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmsans/v11/rP2Hp2ywxg089UriOZQ.ttf"><link rel="preload" as="font" crossorigin="anonymous" href="https://fonts.gstatic.com/s/dmserifdisplay/v10/-nFnOHM81r4j6k0gjAW3mujVU2B2K_c.ttf"></head><body class="font-sans"><div id="app" data-server-rendered="true"><!--[--><!--[--><nav class="nav show" style="--3b7ca6b3:rgba(92, 110, 130, 0.05)"><nav><div style="display:flex;align-items:center"><a class="logo" href="/">Artiely's Blog </a><button class="icon-btn mx-2 !outline-none" title="Toggle dark mode"><div i="carbon-sun dark:carbon-moon"></div></button></div><div><ul class="menu"><!--[--><li><a href="/" class="">首页</a></li><li><a href="/posts" class="">编码</a></li><li><a href="/bookmark" class="">书签</a></li><li><a href="/about" class="">关于</a></li><li><a href="https://github.com/artiely" target="_blank">Github</a></li><!--]--></ul></div></nav></nav><main class="px-4 py-10 text-center text-gray-700 dark:text-gray-200" style="--3b7ca6b3:rgba(92, 110, 130, 0.05)"><div class="is-blog markdown-body sino text-left"><div><h1 id="nosql%E6%95%B0%E6%8D%AE%E5%BA%93" tabindex="-1"><span class="prefix"></span><span class="content">NoSQL数据库</span><span class="suffix"></span></h1><h2 id="%E4%BB%8B%E7%BB%8D" tabindex="-1"><span class="prefix"></span><span class="content">介绍</span><span class="suffix"></span></h2><h3 id="%E4%B8%BB%E8%A6%81%E5%86%85%E5%AE%B9" tabindex="-1"><span class="prefix"></span><span class="content">主要内容</span><span class="suffix"></span></h3><ul><li><strong>Redis开发与实战</strong>(内存型)</li><li><strong>Memcached入门</strong>(内存型)</li><li>MongoDb入门(存储型)</li></ul><p>redis和memcached是同一类型，内存型。MongoDb是存储型。</p><p><strong>着重讲解redis</strong>,存储性数据库还是mysql的天下。</p><h3 id="%E5%AD%A6%E4%B9%A0%E7%9B%AE%E6%A0%87" tabindex="-1"><span class="prefix"></span><span class="content">学习目标</span><span class="suffix"></span></h3><ul><li>掌握非关系性数据库的特点以及使用</li><li>掌握NoSQL 技术在实际开发中的应用</li></ul><h3 id="nosql%E4%B8%BB%E8%A6%81%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" tabindex="-1"><span class="prefix"></span><span class="content">NoSQL主要应用场景</span><span class="suffix"></span></h3><p>专门应对高并发，需要高速读写的场景，而就Redis技术而言，它的性能十分优越，可以支持每秒十几万次的读/写操作，<strong>其性能远超数据库</strong>，并且还支持集群、分布式、主从同步等配置。</p><ul><li>天猫双11</li><li>抢红包，抢手机，抢火车票， 抢门票</li><li>ssr 服务端渲染</li></ul><h2 id="%E7%AC%AC%E4%B8%80%E7%AB%A0-redis" tabindex="-1"><span class="prefix"></span><span class="content">第一章 Redis</span><span class="suffix"></span></h2><ul><li>特点</li><li>api</li><li>结合nodejs应用</li></ul><h3 id="%E5%8E%86%E5%8F%B2%E4%B8%8E%E5%8F%91%E5%B1%95" tabindex="-1"><span class="prefix"></span><span class="content">历史与发展</span><span class="suffix"></span></h3><blockquote><p>2008年，意大利的一家创业公司Merzia[ <a href="http://merzia.com/" target="_blank" rel="noopener">http://merzia.com</a>]推出了一款基于MySQL的网站实时统计系统LLOOGG[ <a href="http://lloogg.com/" target="_blank" rel="noopener">http://lloogg.com</a>]，然而没过多久该公司的创始人Salvatore Sanfilippo便开始对MySQL的性能感到失望，于是他决定亲自为LLOOGG量身定做一个数据库，并于2009年开发完成，这个数据库就是Redis。不过Salvatore Sanfilippo并不满足只将Redis用于LLOOGG这一款产品，而是希望让更多的人使用它，于是在同一年Salvatore Sanfilippo将Redis开源发布，并开始和Redis的另一名主要的代码贡献者Pieter Noordhuis一起继续着Redis的开发，直到今天。</p></blockquote><h3 id="%E7%89%B9%E7%82%B9" tabindex="-1"><span class="prefix"></span><span class="content">特点</span><span class="suffix"></span></h3><p><strong>redis究竟有什么魅力，吸引了如此多的用户?</strong></p><ul><li>存储结构特别-字典</li><li>内存存储与持久化- 缓存</li><li>功能丰富</li><li>简单稳定- 简单可依赖</li></ul><h4 id="%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84" tabindex="-1"><span class="prefix"></span><span class="content">存储结构</span><span class="suffix"></span></h4><p>Redis是 REmote DIctionary Server (远程字典服务器)的缩写，它以<strong>字典</strong>结构存储数据。</p><blockquote><p>字典就是js中的object</p><p>在js中key只能是字符串</p></blockquote><p>同大多数语言中的字典一样，Redis字典的键值除了可以是字符串，也可以是其他数据类型。</p><ul><li>字符串</li><li>散列</li><li>列表</li><li>集合</li><li>有序集合</li></ul><blockquote><p>字典： 类似 js中的object就是一种典型的字典结构。</p></blockquote><h5 id="ex%EF%BC%9A" tabindex="-1"><span class="prefix"></span><span class="content">ex：</span><span class="suffix"></span></h5><p>我们在post变量中存储了一篇文章的数据 (标题， 正文， 阅读量)</p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js">post<span class="token punctuation">.</span>titile <span class="token operator">=</span> <span class="token string">'hello'</span>
post<span class="token punctuation">.</span>content <span class="token operator">=</span> <span class="token string">'balabala'</span>
post<span class="token punctuation">.</span>views <span class="token operator">=</span> <span class="token number">0</span>
post<span class="token punctuation">.</span>tags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'php'</span><span class="token punctuation">,</span> <span class="token string">'java'</span><span class="token punctuation">,</span> <span class="token string">'nodejs'</span><span class="token punctuation">]</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>假如需要通过tag检索出文章，关系型数据库mysql需要建3张表，而且查询非常复杂。</p><p>但是使用Redis可以对tags进行 交集，并集这样的集合运算操作。可以很轻易的实现对tags的各种查询要求。</p><h4 id="%E5%86%85%E5%AD%98%E5%AD%98%E5%82%A8%E4%B8%8E%E6%8C%81%E4%B9%85%E5%8C%96" tabindex="-1"><span class="prefix"></span><span class="content">内存存储与持久化</span><span class="suffix"></span></h4><p>Redis数据库中所有的数据都存在内存中。一台普通的笔记本电脑，redis一秒可读写超过10万个键值对。</p><p>但是，数据存在内存中程序退出后会导致数据丢失。不过redis也提供了对数据持久化的支持。</p><blockquote><p>在浏览器里面数据持久化可以理解为： localStorage, cookie</p></blockquote><h4 id="%E5%8A%9F%E8%83%BD%E4%B8%B0%E5%AF%8C" tabindex="-1"><span class="prefix"></span><span class="content">功能丰富</span><span class="suffix"></span></h4><p>应用场景丰富，redis名副其实的多面手。</p><ul><li>缓存</li><li>队列系统</li></ul><ol><li>redis可以为每个key设置生存时间，到期会自动删除，这一功能配合出色的性能能让它作为缓存系统来使用。由于redis支持持久化和丰富的数据类型，也使其成为了Memcached的竞争者。</li></ol><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155659.png" alt="image-20190620181548456"></figure><ol start="2"><li>作为缓存系统，redis还可以限定数据占的最大空间，超过后自动删除不需要的key。</li><li>redis的列表类型键还可以用来实现队列，并且支持阻塞式读取，可以很容易实现一个高性能的优先级队列。</li><li>redis还支持"发布/订阅"，可以基于此构建聊天室等系统。</li></ol><h4 id="%E7%AE%80%E5%8D%95%E7%A8%B3%E5%AE%9A" tabindex="-1"><span class="prefix"></span><span class="content">简单稳定</span><span class="suffix"></span></h4><p>即使功能再丰富，如果使用起来太复杂也很难吸引人。</p><ol><li>Redis直观的存储结构使得通过程序与Redis交互十分简单，在Redis中使用命令来读写数据，命令语句之于Redis就相当于SQL语言之于关系数据库。</li></ol><h5 id="ex%3A" tabindex="-1"><span class="prefix"></span><span class="content">ex:</span><span class="suffix"></span></h5><p>在关系数据库中要获取posts表内id为1的记录的title字段的值可以使用如下SQL语句实现：</p><div class="language-sql ext-sql code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-sql line-numbers-mode"><code class="language-sql"><span class="token keyword">SELECT</span> title <span class="token keyword">FROM</span> posts <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>redis这么读</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">HGET post:1 title
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>其中HGET就是一个命令。Redis提供了一百多个命令（如图1-2所示），听起来很多，但是常用的却只有十几个，并且每个命令都很容易记忆，其实比SQL语句要简单很多。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155700.png" alt="image-20190609121349841"></figure><ol start="2"><li>Redis使用C语言开发，代码量只有3万多行。这降低了用户通过修改Redis源代码来使之更适合自己项目需要的门槛。对于希望“榨干”数据库性能的开发者而言，这无疑是一个很大的吸引力。</li></ol><h3 id="redis%E5%AE%89%E8%A3%85" tabindex="-1"><span class="prefix"></span><span class="content">Redis安装</span><span class="suffix"></span></h3><blockquote><p>“纸上得来终觉浅，绝知此事要躬行。” ——陆游《冬夜读书示子聿》</p></blockquote><ul><li>Mac OS</li></ul><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">brew <span class="token function">install</span> redis
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>Brew 就是 homebrew</p></blockquote><h4 id="%E5%90%AF%E5%8A%A8" tabindex="-1"><span class="prefix"></span><span class="content">启动</span><span class="suffix"></span></h4><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis-server
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>默认端口6379,修改端口</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis-server --port <span class="token number">6389</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="%E5%88%9D%E5%A7%8B%E5%8C%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" tabindex="-1"><span class="prefix"></span><span class="content">初始化配置文件</span><span class="suffix"></span></h4><p>每次redis服务启动的时候都会读取 <code class="">redis.conf</code></p><p>mac os的路径在<code class="">/usr/local/etc/redis.conf</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token comment"># Redis默认不是以守护进程的方式运行，可以通过该配置项修改，使用yes启用守护进程</span>
<span class="token comment"># 启用守护进程后，Redis会把pid写到一个pidfile中，在/var/run/redis.pid</span>
daemonize no

<span class="token comment"># 当Redis以守护进程方式运行时，Redis默认会把pid写入/var/run/redis.pid文件，可以通过pidfile指定</span>
pidfile /var/run/redis.pid

<span class="token comment"># 指定Redis监听端口，默认端口为6379</span>
<span class="token comment"># 如果指定0端口，表示Redis不监听TCP连接</span>
port <span class="token number">6379</span>

<span class="token comment"># 绑定的主机地址</span>
<span class="token comment"># 你可以绑定单一接口，如果没有绑定，所有接口都会监听到来的连接</span>
<span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1
<span class="token comment"># 也就是本机</span>

<span class="token comment"># 当客户端闲置多长时间后关闭连接，如果指定为0，表示关闭该功能</span>
<span class="token function">timeout</span> <span class="token number">0</span>

<span class="token comment"># 指定日志记录级别，Redis总共支持四个级别：debug、verbose、notice、warning，默认为verbose</span>
<span class="token comment"># debug (很多信息, 对开发／测试比较有用)</span>
<span class="token comment"># verbose (many rarely useful info, but not a mess like the debug level)</span>
<span class="token comment"># notice (moderately verbose, what you want in production probably)</span>
<span class="token comment"># warning (only very important / critical messages are logged)</span>
loglevel verbose

<span class="token comment"># 日志记录方式，默认为标准输出，如果配置为redis为守护进程方式运行，而这里又配置为标准输出，则日志将会发送给/dev/null</span>
logfile stdout

<span class="token comment"># 设置数据库的数量，默认数据库为0，可以使用select &lt;dbid&gt;命令在连接上指定数据库id</span>
<span class="token comment"># dbid是从0到‘databases’-1的数目</span>
databases <span class="token number">16</span>

<span class="token comment">################################ SNAPSHOTTING  #################################</span>
<span class="token comment"># 指定在多长时间内，有多少次更新操作，就将数据同步到数据文件，可以多个条件配合</span>
<span class="token comment"># Save the DB on disk:</span>
<span class="token comment">#</span>
<span class="token comment">#   save &lt;seconds&gt; &lt;changes&gt;</span>
<span class="token comment">#</span>
<span class="token comment">#   Will save the DB if both the given number of seconds and the given</span>
<span class="token comment">#   number of write operations against the DB occurred.</span>
<span class="token comment">#</span>
<span class="token comment">#   满足以下条件将会同步数据:</span>
<span class="token comment">#   900秒（15分钟）内有1个更改</span>
<span class="token comment">#   300秒（5分钟）内有10个更改</span>
<span class="token comment">#   60秒内有10000个更改</span>
<span class="token comment">#   Note: 可以把所有“save”行注释掉，这样就取消同步操作了</span>

save <span class="token number">900</span> <span class="token number">1</span>
save <span class="token number">300</span> <span class="token number">10</span>
save <span class="token number">60</span> <span class="token number">10000</span>

<span class="token comment"># 指定存储至本地数据库时是否压缩数据，默认为yes，Redis采用LZF压缩，如果为了节省CPU时间，可以关闭该选项，但会导致数据库文件变的巨大</span>
rdbcompression <span class="token function">yes</span>

<span class="token comment"># 指定本地数据库文件名，默认值为dump.rdb</span>
dbfilename dump.rdb

<span class="token comment"># 工作目录.</span>
<span class="token comment"># 指定本地数据库存放目录，文件名由上一个dbfilename配置项指定</span>
<span class="token comment"># </span>
<span class="token comment"># Also the Append Only File will be created inside this directory.</span>
<span class="token comment"># </span>
<span class="token comment"># 注意，这里只能指定一个目录，不能指定文件名</span>
<span class="token function">dir</span> ./


</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><h4 id="redis-cli%E7%AE%80%E6%98%93%E4%BD%BF%E7%94%A8" tabindex="-1"><span class="prefix"></span><span class="content">redis-cli简易使用</span><span class="suffix"></span></h4><p>类似node命令，交互式命令行客户端。</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis-cli
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>关闭连接</strong></p><p>考虑到Redis有可能正在将内存中的数据同步到硬盘中，强行终止Redis进程可能会导致数据丢失。正确停止Redis的方式应该是向Redis发送SHUTDOWN命令，方法为：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">SHUTDOWN
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="redis%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AE%A2%E6%88%B7%E7%AB%AF" tabindex="-1"><span class="prefix"></span><span class="content">redis命令行客户端</span><span class="suffix"></span></h3><p>redis-cli执行时会自动按照默认配置（服务器地址为127.0.0.1，端口号为6379）连接Redis，通过-h和-p参数可以自定义地址和端口号：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis-cli -h <span class="token number">127.0</span>.0.1 -p <span class="token number">6379</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="ex%3A-1" tabindex="-1"><span class="prefix"></span><span class="content">ex:</span><span class="suffix"></span></h4><ul><li><p>ping</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">PING
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li><li><p>Echo hi</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">ECHO hi
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul><h4 id="%E5%91%BD%E4%BB%A4%E8%BF%94%E5%9B%9E%E5%80%BC" tabindex="-1"><span class="prefix"></span><span class="content">命令返回值</span><span class="suffix"></span></h4><h5 id="%E7%8A%B6%E6%80%81%E5%9B%9E%E5%A4%8D" tabindex="-1"><span class="prefix"></span><span class="content">状态回复</span><span class="suffix"></span></h5><p>PING</p><blockquote><p>PONG</p></blockquote><h5 id="%E9%94%99%E8%AF%AF%E5%9B%9E%E5%A4%8D" tabindex="-1"><span class="prefix"></span><span class="content">错误回复</span><span class="suffix"></span></h5><p>随便输入一个不存在的命令</p><blockquote><p>(error) ERR unknown command <code class="">asdasd</code>, with args beginning with:</p></blockquote><h5 id="%E6%95%B4%E6%95%B0%E5%9B%9E%E5%A4%8D" tabindex="-1"><span class="prefix"></span><span class="content">整数回复</span><span class="suffix"></span></h5><p><strong>Redis Incr 命令将 key 中储存的数字值增一。</strong></p><p>如果 key 不存在，那么 key 的值会先被初始化为 0 ，然后再执行 INCR 操作。</p><p>如果值包含错误的类型，或字符串类型的值不能表示为数字，那么返回一个错误。</p><p>本操作的值限制在 64 位(bit)有符号数字表示之内。</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">incr abc
<span class="token builtin class-name">set</span> abc <span class="token number">20</span>
incr abc
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9B%9E%E5%A4%8D" tabindex="-1"><span class="prefix"></span><span class="content">字符串回复</span><span class="suffix"></span></h5><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get foo
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="%E5%A4%9A%E8%A1%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9B%9E%E5%A4%8D" tabindex="-1"><span class="prefix"></span><span class="content">多行字符串回复</span><span class="suffix"></span></h5><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> keys *
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="%E9%85%8D%E7%BD%AE" tabindex="-1"><span class="prefix"></span><span class="content">配置</span><span class="suffix"></span></h4><p>也可以通过cli的方式去修改<code class="">/usr/local/etc/redis.conf</code>中的配置</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">config <span class="token builtin class-name">set</span> loglevel warning
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="%E5%A4%9A%E6%95%B0%E6%8D%AE%E5%BA%93" tabindex="-1"><span class="prefix"></span><span class="content">多数据库</span><span class="suffix"></span></h4><p>而实际上一个Redis实例提供了多个用来存储数据的字典，客户端可以指定将数据存储在哪个字典中。这与我们熟知的在一个关系数据库实例中可以创建多个数据库类似，所以可以将其中的每个字典都理解成一个独立的数据库。 每个数据库对外都是以一个从0开始的递增数字命名，Redis默认支持16个数据库，可以通过配置参数databases来修改这一数字。客户端与Redis建立连接后会自动选择0号数据库，不过可以随时使用SELECT命令更换数据库，如要选择1号数据库：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span>SELECT <span class="token number">1</span>
OK
redis <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>GET foo
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然而这些以数字命名的数据库又与我们理解的数据库有所区别。首先Redis不支持自定义数据库的名字，每个数据库都以编号命名，开发者必须自己记录哪些数据库存储了哪些数据。另外Redis也不支持为每个数据库己记录哪些数据库存储了哪些数据。**另外Redis也不支持为每个数据库设置不同的访问密码，所以一个客户端要么可以访问全部数据库，要么连一个数据库也没有权限访问。**最重要的一点是多个数据库之间并不是完全隔离的，比如FLUSHALL命令可以清空一个Redis实例中所有数据库中的数据。综上所述，这些数据库更像是一种命名空间，而不适宜存储不同应用程序的数据。<strong>比如可以使用0号数据库存储某个应用生产环境中的数据，使用1号数据库存储测试环境中的数据，但不适宜使用0号数据库存储A应用的数据而使用1号数据库存储B应用的数据，不同的应用应该使用不同的Redis实例存储数据</strong>。由于redis非常轻量级，一个空Redis实例占用的内存只有1MB左右，所以不用担心多个Redis实例会额外占用很多内存。</p><h3 id="redis%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B" tabindex="-1"><span class="prefix"></span><span class="content">Redis数据类型</span><span class="suffix"></span></h3><p>了解过redis基础知识后，进入真正的redis世界。</p><ol><li>获得符合规则的键名列表</li></ol><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">KEYS pattern
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155701.png" alt="image-20190609121416367"></figure><blockquote><p>keys会遍历redis中所有的键，当数量过多时会影响性能，不建议使用。</p><p>redis命令不区分大小写。</p></blockquote><ol start="2"><li>判断一个键是否存在</li></ol><p><code class="">EXISTS key</code></p><p>如果键存在则返回整数类型1，否则返回0。</p><ol start="3"><li>删除键</li></ol><p><code class="">DEL key [key …]</code></p><p>可以删除一个或多个键，返回值是删除的键的个数。</p><p><strong>如何删除多个key？</strong></p><p>利用linux的管道 xargs。</p><ol start="4"><li>获得键值的数据类型</li></ol><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis＞SET foo <span class="token number">1</span>
OK

redis＞TYPE foo
string

redis＞LPUSH bar <span class="token number">1</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>

redis＞TYPE bar
list

</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><blockquote><p>LPUSH命令的作用是向指定的列表类型键中增加一个元素，如果键不存在则创建它，后面会详细介绍。</p></blockquote><h4 id="%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%B1%BB%E5%9E%8B" tabindex="-1"><span class="prefix"></span><span class="content">字符串类型</span><span class="suffix"></span></h4><h5 id="%E4%BB%8B%E7%BB%8D-1" tabindex="-1"><span class="prefix"></span><span class="content">介绍</span><span class="suffix"></span></h5><blockquote><p>字符串类型是Redis中最基本的数据类型，它能存储任何形式的字符串，包括二进制数据。你可以用其存储用户的邮箱、JSON化的对象甚至是一张图片。一个字符串类型键允许存储的数据的最大容量是512MB。</p><p>JSON化的对象： JSON.stringfy()</p></blockquote><h5 id="%E5%91%BD%E4%BB%A4" tabindex="-1"><span class="prefix"></span><span class="content">命令</span><span class="suffix"></span></h5><ol><li>赋值与取值</li></ol><p><code class="">SET key value</code></p><ol start="2"><li>递增数字</li></ol><p><code class="">INCR num</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">SET foo bar
INCR foo
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>有人可能会想到可以借助GET和SET两个命令自己实现incr函数，伪代码如下：</p><ol><li>会通过 key取值</li><li>判断是否有值</li><li>如果没有就归 0， 有呢就进行+1操作</li></ol><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">function</span> <span class="token function">incr</span><span class="token punctuation">(</span><span class="token parameter">$key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> $value <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>$key<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>$value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $value <span class="token operator">=</span> <span class="token number">0</span>
 	<span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    $value <span class="token operator">=</span> $value <span class="token operator">+</span> <span class="token number">1</span> <span class="token comment">// $value = 5</span>
    <span class="token keyword">return</span> $value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>如果 Redis 同时只连接了一个客户端，那么上面的代码没有任何问题（其实还没有加入错误处理，不过这并不是此处讨论的重点）。可当同一时间有多个客户端连接到Redis时则有可能出现竞态条件（race condition）[3] 。例如有两个客户端A 和B 都要执行我们自己实现的 incr 函数并准备将同一个键的键值递增，当它们恰好同时执行到代码第二行时二者读取到的键值是一样的，如“5”，而后它们各自将该值递增到“6”并使用 SET 命令将其赋给原键，结果虽然对键执行了两次递增操作，最终的键值却是“6”而不是预想中的“7”。这一部分跟 “事务”，举个例子： 付款与扣款，能讲整个流程的状态初始化。</p></blockquote><h5 id="ex%3A-%E6%96%87%E7%AB%A0%E8%AE%BF%E9%97%AE%E9%87%8F%E7%BB%9F%E8%AE%A1(%E6%A0%87%E9%A2%98%EF%BC%8C-%E6%AD%A3%E6%96%87%EF%BC%8C%E8%AE%BF%E9%97%AE%E9%87%8F)" tabindex="-1"><span class="prefix"></span><span class="content">ex: 文章访问量统计(标题， 正文，访问量)</span><span class="suffix"></span></h5><p>博客的一个常见的功能是统计文章的访问量，我们可以为每篇文章使用一个名为post:文章ID:page.view的键来记录文章的访问量，每次访问文章的时候使用INCR命令使相应的键值递增。</p><ul><li>以 post:文章id:page 存储文章信息</li><li>以post:文章id:page.view 存储访问量</li></ul><blockquote><p>Redis 对于键的命名并没有强制的要求，但比较好的实践是用“对象类型:对象ID:对象属性”来命名一个键，如使用键user:1:friends来存储ID为1的用户的好友列表。</p></blockquote><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token comment">// 字符串</span>
<span class="token comment">// 存储过程</span>
<span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">redis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token comment">// 一些配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> $post_id <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">'post:count'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> $airticle <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'world'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">views</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 赋值</span>
client<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">post:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$post_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:data </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$airticle<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token comment">// 读取过程</span>
<span class="token keyword">const</span> airticle <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'post:1:data'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>airticle<span class="token punctuation">)</span>

<span class="token comment">// 每次访问文章 都会调用</span>
<span class="token keyword">var</span> $post_id <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">'post:count'</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h5 id="%E5%91%BD%E4%BB%A4%E6%89%A9%E5%B1%95" tabindex="-1"><span class="prefix"></span><span class="content">命令扩展</span><span class="suffix"></span></h5><ol><li>增加指定的整数</li></ol><p><code class="">INCRBY key increment</code></p><ol start="2"><li>减少指定的整数</li></ol><p><code class="">DECR key</code></p><p><code class="">DECRBY key decrememt</code></p><ol start="3"><li>增加指定浮点数</li></ol><p><code class="">INCRBYFLOAT key increment</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> INCRBYFLOAT bar <span class="token number">2.7</span> <span class="token string">"6.7"</span> 
redis<span class="token operator">&gt;</span> INCRBYFLOAT bar 5E+4 <span class="token string">"50006.69999999999999929"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="4"><li>向尾部追加值</li></ol><p><code class="">APPEND key value</code></p><p>APPEND作用是向键值的末尾追加value。如果键不存在则将该键的值设置为value，即相当于 SET key value。返回值是追加后字符串的总长度。</p><ol start="5"><li>获取字符串长度</li></ol><p><code class="">STRLEN key</code></p><blockquote><p>前面提到了字符串类型可以存储二进制数据，所以它可以存储任何编码的字符串。例子中Redis接收到的是使用UTF-8编码的中文，由于“你”和“好”两个字的UTF-8编码的长度都是3，所以此例中会返回6。</p></blockquote><ol start="6"><li>获取/设置多个键值</li></ol><p><code class="">MGET</code> <code class="">MSET</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">MSET key1 v1 key2 v2
MGET key1 key2
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="7"><li>位操作</li></ol><p><code class="">GETBIT key offset</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">SET foo bar
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>b,a,r 对应的ASCII码分别为98，97，114。转换成二进制分别为 1100010， 1100001， 1110010。</p><blockquote><p>所有的文字： 英文 ，汉子，汉语，日语，符号。。。其实都是通过数字。</p></blockquote><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155702.png" alt="image-20190609121432754"></figure><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">GETBIT foo <span class="token number">0</span>
GETBIT foo <span class="token number">6</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>利用位操作可以非常紧凑的存储布尔值。比如如果需要存储 “男，女”。如果用数字0，1存储则需要 100万字节 约等于 1M， 但是如果用二进制存储只需要 100K左右, 只占用计算机的一个位。</p><p>再举个例子：</p><p>假如我们的id是从 1000000开始递增，我们则可以先减去1000000再进行递增存储，这样可以节约空间。</p></blockquote><h3 id="%E6%95%A3%E5%88%97%E7%B1%BB%E5%9E%8B" tabindex="-1"><span class="prefix"></span><span class="content">散列类型</span><span class="suffix"></span></h3><p>假设我只想读取文章的标题，但是会需要把所有文章相关的信息都拿过来反序列化(标题，正文，阅读量。。。)，会造成资源的浪费。</p><p>不仅读取有这个问题，修改也有这个问题。</p><p><strong>所以，散列解决了这个问题。</strong></p><h4 id="%E4%BB%8B%E7%BB%8D-2" tabindex="-1"><span class="prefix"></span><span class="content">介绍</span><span class="suffix"></span></h4><p>散列适合存储对象：使用对象类别和ID构成键名，使用字段表示对象的属性，而字段值则存储属性值。</p><h5 id="ex%3A-%E6%B1%BD%E8%BD%A6%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B" tabindex="-1"><span class="prefix"></span><span class="content">ex: 汽车数据模型</span><span class="suffix"></span></h5><p>这是一种二维的数据结构。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155703.png" alt="image-20190609121443762"></figure><p>回想 mysql数据库结构。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155704.png" alt="image-20190609121454590"></figure><p>假设某些数据需要新增一个字段：</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155705.png" alt="image-20190609121504859"></figure><p>对于2，3这两天数据来说data是多余的，这样会变得越来越难维护。为了解决这个问题，必须新建额外的表进行关联。</p><blockquote><p>而redis的散列类型不存在这个问题，我们可以为任何键新增或删除字段而不影响其它。</p></blockquote><h4 id="%E5%91%BD%E4%BB%A4-1" tabindex="-1"><span class="prefix"></span><span class="content">命令</span><span class="suffix"></span></h4><ol><li>赋值与取值</li></ol><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> HSET car price <span class="token number">500</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> HSET car name BMW 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> HGET car name <span class="token string">"BMW"</span>


</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>HSET 命令的方便之处在于不区分插入和更新操作，这意味着修改数据时不用事先判断字段是否存在来决定要执行的是插入操作（update）还是更新操作（insert）。当执行的是插入操作时（即之前字段不存在）HSET命令会返回1，当执行的是更新操作时（即之前字段已经存在）HSET命令会返回0。更进一步，当键本身不存在时，HSET命令还会自动建立它。</p></blockquote><p>2.获取键中所有的字段和值</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> HGETALL car 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"price"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"500"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"name"</span> 
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"BMW"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>不要担心结构不好用，在nodejs中会把返回值封装成js的object</p></blockquote><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js">redis<span class="token punctuation">.</span><span class="token function">hgetall</span><span class="token punctuation">(</span><span class="token string">"car"</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> car</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
	<span class="token comment">//hgetall 方法的返回的值被封装成了 JavaScript的对象 </span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>car<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>3.判断字段是否存在</p><p><code class="">HEXISTS key field</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> HEXISTS car model 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span> 
redis<span class="token operator">&gt;</span> HSET car model C200 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> HEXISTS car model 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="4"><li>增加数字</li></ol><p><code class="">HINCRBY key field increment</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> HINCRBY person score <span class="token number">60</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">60</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>5.删除字段</p><p><code class="">HDEL key field [field …]</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> HDEL car price 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> HDEL car price 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="%E5%AE%9E%E8%B7%B5" tabindex="-1"><span class="prefix"></span><span class="content">实践</span><span class="suffix"></span></h4><p>刚才存储文章的例子，需要序列化和反序列化之后在进行读写。会造成2个问题：</p><ol><li>会产生竞态， 2个客户端同时操作会冲突，最终只有一个属性被修改。没有原子化操作</li><li>每次修改或者读取都需要反序列化，消耗性能。</li></ol><p>新增一个需求，一般文章都会有缩略名。比如文章的标题叫做"This is a great post"，它的缩略名可以为"this-is-a-greate-post"。缩略名可以用于生成文章的地址栏或者其它用处。</p><h5 id="%E4%BD%BF%E7%94%A8%E6%95%A3%E5%88%97%E6%94%B9%E9%80%A0" tabindex="-1"><span class="prefix"></span><span class="content">使用散列改造</span><span class="suffix"></span></h5><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155706.png" alt="image-20190609121516741"></figure><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token comment">// 散列其实就是hash  hget hset</span>
<span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">redis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token comment">// 一些配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// # 1. 文章的赋值</span>
<span class="token comment">// # 自增的id</span>
<span class="token keyword">const</span> $post_id <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">'posts:count'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> $slug <span class="token operator">=</span> <span class="token string">'hello-world'</span>
<span class="token keyword">const</span> $title <span class="token operator">=</span> <span class="token string">'hello world'</span>
<span class="token keyword">const</span> $content <span class="token operator">=</span> <span class="token string">'xxxxxxxxxxxxx'</span>
<span class="token keyword">const</span> views <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">// # 文章的缩略名和id互相有一个引用来维持关系  slug.to.id</span>
<span class="token comment">// # HSETNX 也是赋值  如果这个值已经存在 则返回0，并且赋值失败  反之返回1， 赋值成功</span>
<span class="token keyword">const</span> isSlug <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">hsetnx</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">slug.to.id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$slug<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$post_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token comment">// # 1.通过散列去存储文章</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>isSlug <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
  client<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">else</span>
  client<span class="token punctuation">.</span><span class="token function">hmset</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">post:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$post_id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> title </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$title<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> content </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$content<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> views </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$views<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token comment">// # 2. 读取文章</span>
<span class="token keyword">const</span> postID <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">'slug.to.id $slug'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>postID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">'文章不存在'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> post <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">hgetall</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">post:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>postID<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// # 3.修改缩略名</span>
<span class="token comment">// # 加入你要给id=42的文章  修改缩略名</span>
<span class="token keyword">const</span> newSlug <span class="token operator">=</span> <span class="token string">'xxx'</span>
<span class="token keyword">const</span> isSlugExit <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">hsetnx</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">slug.to.id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newSlug<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 42</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>isSlugExit <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">'缩略名已存在，请换其它'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> oldSlug <span class="token operator">=</span> client <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">hget</span><span class="token punctuation">(</span><span class="token string">'post:42 slug'</span><span class="token punctuation">)</span>
  client<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">post:42 slug </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newSlug<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  client<span class="token punctuation">.</span><span class="token function">hdel</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">slug.to.id </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$oldSlug<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><h4 id="%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%85" tabindex="-1"><span class="prefix"></span><span class="content">命令补充</span><span class="suffix"></span></h4><ol><li>只获取字段名或字段值</li></ol><p><code class="">HKEYS key</code></p><p><code class="">HVALS key</code></p><ol start="2"><li>获得字段数量</li></ol><p><code class="">HLEN key</code></p><h3 id="%E5%88%97%E8%A1%A8%E7%B1%BB%E5%9E%8B" tabindex="-1"><span class="prefix"></span><span class="content">列表类型</span><span class="suffix"></span></h3><h4 id="%E4%BB%8B%E7%BB%8D-3" tabindex="-1"><span class="prefix"></span><span class="content">介绍</span><span class="suffix"></span></h4><p>列表类型可以存储一个有序的字符串列表，常用的操作是向列表两端添加元素，或者获得列表的某一个片段。</p><blockquote><p>列表类型内部是使用双向链表（double linked list）实现的，所以向列表两端添加元素的时间复杂度为O(1)，获取越接近两端的元素速度就越快。这意味着即使是一个有几千万个元素的列表，获取头部或尾部的10条记录也是极快的（和从只有20个元素的列表中获取头部或尾部的10条记录的速度是一样的）。不过使用链表的代价是通过索引访问元素比较慢。</p></blockquote><p>和js的数组有什么区别？</p><ul><li>在js里面数组其实也是对象，字典</li><li>redis的列表却是链表</li></ul><h4 id="%E5%91%BD%E4%BB%A4-2" tabindex="-1"><span class="prefix"></span><span class="content">命令</span><span class="suffix"></span></h4><ol><li>向列表两端增加元素</li></ol><p><code class="">LPUSH key value [value …]</code></p><p><code class="">RPUSH key value [value …]</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> LPUSH numbers <span class="token number">1</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>从列表两端弹出元素</li></ol><p><code class="">LPOP key</code></p><p><code class="">RPOP key</code></p><ol start="3"><li>获取列表中元素的个数</li></ol><p><code class="">LLEN key</code></p><ol start="4"><li>获取列表片段</li></ol><p><code class="">LRANGE key start stop</code></p><blockquote><p>LRANGE 0 -1 可以获取列表中所有的元素</p></blockquote><ol start="5"><li>删除列表中指定的值</li></ol><p><code class="">LREM key count value</code></p><p>LREM命令会删除列表中前count个值为value的元素，返回值是实际删除的元素个数。根据count值的不同，LREM命令的执行方式会略有差异。</p><p>（1）当 count &gt; 0时 LREM 命令会从列表左边开始删除前 count 个值为 value的元素。</p><p>（2）当 count &lt; 0时 LREM 命令会从列表右边开始删除前|count|个值为 value 的元素。</p><p>（3）当 count = 0是 LREM命令会删除所有值为 value的元素。例如：</p><h4 id="ex%EF%BC%9A%E5%82%A8%E5%AD%98%E6%96%87%E7%AB%A0id%E5%88%97%E8%A1%A8" tabindex="-1"><span class="prefix"></span><span class="content">ex：储存文章id列表</span><span class="suffix"></span></h4><p>新增需求： 我们存储的文章需要展示许多条，如何做分页功能。</p><blockquote><p>为了解决这个问题，我们使用列表类型键posts:list记录文章ID列表。当发布新文章时使用LPUSH命令把新文章的ID加入这个列表中，另外删除文章时也要记得把列表中的文章ID 删除，就像这样：LREM posts:list 1 要删除的文章 ID</p></blockquote><p>有了文章 ID列表，就可以使用 LRANGE命令来实现文章的分页显示了。伪代码如下：</p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">redis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> currentPage <span class="token operator">=</span> <span class="token number">1</span>

<span class="token keyword">const</span> listLength <span class="token operator">=</span> <span class="token number">10</span>
<span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token punctuation">(</span>currentPage <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> listLength
<span class="token keyword">const</span> end <span class="token operator">=</span> currentPage <span class="token operator">*</span> listLength <span class="token operator">-</span> <span class="token number">1</span>
<span class="token keyword">const</span> postIdArr <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">lrange</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">post:list </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>start<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>end<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

postIdArr<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">hgetall</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">post:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>美中不足的一点是散列类型没有类似字符串类型的 MGET命令那样可以通过一条命令同时获得多个键的键值的版本，所以对于每个文章ID都需要请求一次数据库，也就都会产生一次往返时延（round-trip delay time）[11] ，之后我们会介绍使用管道和脚本来优化这个问题。</p><p>另外使用列表类型键存储文章ID列表有以下两个问题。</p><p>（1）文章的发布时间不易修改：修改文章的发布时间不仅要修改post:文章ID中的time字段，还需要按照实际的发布时间重新排列posts:list中的元素顺序，而这一操作相对比较繁琐。</p><p>（2）当文章数量较多时访问中间的页面性能较差：前面已经介绍过，列表类型是通过链表实现的，所以当列表元素非常多时访问中间的元素效率并不高。</p></blockquote><h4 id="ex%3A-%E5%AD%98%E5%82%A8%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8" tabindex="-1"><span class="prefix"></span><span class="content">ex: 存储评论列表</span><span class="suffix"></span></h4><p>在博客中还可以使用列表类型键存储文章的评论。由于博客不允许访客修改自己发表的评论，而且考虑到读取评论时需要获得评论的全部数据（评论者姓名，联系方式，评论时间和评论内容），不像文章一样有时只需要文章标题而不需要文章正文。所以适合将一条评论的各个元素序列化成字符串后作为列表类型键中的元素来存储。</p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> commentsStr <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">author</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token string">'post:id:comment'</span><span class="token punctuation">,</span> commentsStr<span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%85-1" tabindex="-1"><span class="prefix"></span><span class="content">命令补充</span><span class="suffix"></span></h4><ol><li><p>获得/设置指定索引的元素值</p><p><code class="">LINDEX key index</code></p><p><code class="">LSET key index value</code></p></li><li><p>只保留列表指定片段</p><p><code class="">LTRIM</code> 命令可以删除指定索引范围之外的所有元素，其指定列表范围的方法和LRANGE命令相同。就像这样：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> LRANGE numbers <span class="token number">0</span> -1 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"1"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"2"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"7"</span> 
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"3"</span> 
redis<span class="token operator">&gt;</span> LTRIM numbers <span class="token number">1</span> <span class="token number">2</span> 
OK 
redis<span class="token operator">&gt;</span> LRANGE numbers <span class="token number">0</span> <span class="token number">1</span> 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"2"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"7"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>LTRIM命令常和LPUSH命令一起使用来限制列表中元素的数量，比如记录日志时我们希望只保留最近的100条日志，则每次加入新元素时调用一次LTRIM命令即可：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">LPUSH logs <span class="token variable">$newLog</span> 
LTRIM logs <span class="token number">0</span> <span class="token number">99</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>向列表中插入元素</p><p><code class="">LINSERT key BEFORE|AFTER pivot value</code></p><p>LINSERT 命令首先会在列表中从左到右查找值为 pivot 的元素，然后根据第二个参数是BEFORE还是AFTER来决定将value插入到该元素的前面还是后面。</p><p>LINSERT命令的返回值是插入后列表的元素个数。示例如下：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> LRANGE numbers <span class="token number">0</span> -1 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"2"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"7"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"0"</span> 
redis<span class="token operator">&gt;</span> LINSERT numbers AFTER <span class="token number">7</span> <span class="token number">3</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span> 
redis<span class="token operator">&gt;</span> LRANGE numbers <span class="token number">0</span> -1 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"2"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"7"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"3"</span> 
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"0"</span> 
redis<span class="token operator">&gt;</span> LINSERT numbers BEFORE <span class="token number">2</span> <span class="token number">1</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span> 
redis<span class="token operator">&gt;</span> LRANGE numbers <span class="token number">0</span> -1 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"1"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"2"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"7"</span> 
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"3"</span> 
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"0"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></li><li><p>将元素从一个列表转到另一个列表</p><p><code class="">RPOPLPUSH source destination</code></p><p>RPOPLPUSH是个很有意思的命令，从名字就可以看出它的功能：先执行RPOP命令再执行LPUSH命令。RPOPLPUSH命令会先从source列表类型键的右边弹出一个元素，然后将其加入到destination列表类型键的左边，并返回这个元素的值，整个过程是原子的。</p><blockquote><p>当把列表类型作为队列使用时，RPOPLPUSH 命令可以很直观地在多个队列中传递数据。当source和destination相同时，RPOPLPUSH命令会不断地将队尾的元素移到队首，借助这个特性我们可以实现一个网站监控系统：使用一个队列存储需要监控的网址，然后监控程序不断地使用 RPOPLPUSH 命令循环取出一个网址来测试可用性。这里使用RPOPLPUSH命令的好处在于在程序执行过程中仍然可以不断地向网址列表中加入新网址，而且整个系统容易扩展，允许多个客户端同时处理队列。</p></blockquote></li></ol><h3 id="%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B" tabindex="-1"><span class="prefix"></span><span class="content">集合类型</span><span class="suffix"></span></h3><p>Redis 有一种数据类型很适合存储文章的标签，它就是集合类型。</p><h4 id="%E4%BB%8B%E7%BB%8D-4" tabindex="-1"><span class="prefix"></span><span class="content">介绍</span><span class="suffix"></span></h4><p>集合的概念高中的数学课就学习过。在集合中的每个元素都是不同的，且没有顺序。一个集合类型（set）键可以存储至多2的32次方 −1个（相信这个数字对大家来说已经很熟悉了）字符串。 集合类型和列表类型有相似之处，但很容易将它们区分开来，</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155707.png" alt="image-20190611135515274"></figure><p>集合类型的常用操作是向集合中加入或删除元素、判断某个元素是否存在等，由于集合类型在Redis内部是使用值为空的散列表（hash table）实现的，所以这些操作的时间复杂度都是O(1)。最方便的是多个集合类型键之间还可以进行并集、交集和差集运算，稍后就会看到灵活运用这一特性带来的便利。</p><h4 id="%E5%91%BD%E4%BB%A4-3" tabindex="-1"><span class="prefix"></span><span class="content">命令</span><span class="suffix"></span></h4><ol><li><p>增加/删除元素</p><p><code class="">SADD key member [member …]</code></p><p><code class="">SREM key member [member …]</code></p><p>SADD 命令用来向集合中增加一个或多个元素，如果键不存在则会自动创建。因为在一个集合中不能有相同的元素，所以如果要加入的元素已经存在于集合中就会忽略这个元素。本命令的返回值是成功加入的元素数量（忽略的元素不计算在内）。例如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"> redis<span class="token operator">&gt;</span> SADD letters a 
 <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
 redis<span class="token operator">&gt;</span> SADD letters a b c 
 <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span> 
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>第二条SADD命令的返回值为2是因为元素“a”已经存在，所以实际上只加入了两个元素。</p><p>SREM命令用来从集合中删除一个或多个元素，并返回删除成功的个数，例如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"> redis<span class="token operator">&gt;</span> SREM letters c d 
 <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>由于元素“d”在集合中不存在，所以只删除了一个元素，返回值为1。</p></li></ol><p>2．获得集合中的所有元素</p><p><code class="">SMEMBERS key</code></p><p>SMEMBERS命令会返回集合中的所有元素，例如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SMEMBERS letters 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"b"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"a"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li><p>判断元素是否在集合中</p><p><code class="">SISMEMBER key member</code></p><p>判断一个元素是否在集合中是一个时间复杂度为O(1)的操作，无论集合中有多少个元素，SISMEMBER命令始终可以极快地返回结果。当值存在时判断一个元素是否在集合中是一个时间复杂度为O(1)的操作，无论集合中有多少个元素，SISMEMBER命令始终可以极快地返回结果。当值存在时 SISMEMBER命令返回1，当值不存在或键不存在时返回0，例如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SISMEMBER letters a 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> SISMEMBER letters d 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ol><p>4．集合间运算</p><p><code class="">SDIFF key [key „]</code></p><p><code class="">SINTER key [key „]</code></p><p><code class="">SUNION key [key „]</code></p><p>接下来要介绍的3个命令都是用来进行多个集合间运算的。</p><p>1）SDIFF命令用来对多个集合执行差集运算。集合A与集合B的差集表示为A−B，代表所有属于A且不属于B的元素构成的集合（如图3-13所示），即A−B ={x | x∈A且x∈B}。例如：</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155708.png" alt="image-20190611140833117"></figure><p>{1, 2, 3} - {2, 3, 4} = {1} {2, 3, 4} - {1, 2, 3} = {4} SDIFF命令的使用方法如下：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SADD setA <span class="token number">1</span> <span class="token number">2</span> <span class="token number">3</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span> 
redis<span class="token operator">&gt;</span> SADD setB <span class="token number">2</span> <span class="token number">3</span> <span class="token number">4</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span> 
redis<span class="token operator">&gt;</span> SDIFF setA setB 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"1"</span> 
redis<span class="token operator">&gt;</span> SDIFF setB setA 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"4"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>SDIFF命令支持同时传入多个键，例如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SADD setC <span class="token number">2</span> <span class="token number">3</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span> 
redis<span class="token operator">&gt;</span> SDIFF setA setB setC 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"1"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>（2）SINTER命令用来对多个集合执行交集运算。集合A与集合B的交集表示为A ∩ B，代表所有属于A 且属于B的元素构成的集合（如图3-14所示），即A ∩ B ={x | x ∈ A 且x ∈B}。</p><p>例如： {1, 2, 3} ∩ {2, 3, 4} = {2, 3} SINTER命令的使用方法如下：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SINTER setA setB 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"2"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"3"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>SINTER命令同样支持同时传入多个键，如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SINTER setA setB setC 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"2"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"3"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（3）SUNION命令用来对多个集合执行并集运算。集合A与集合B的并集表示为A∪B，代表所有属于A 或属于B的元素构成的集合（如图3-15所示）即A∪B ={x | x∈A或x ∈B}。</p><p>例如： {1, 2, 3} ∪{2, 3, 4} = {1, 2, 3, 4}</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155709.png" alt="image-20190611141307449"></figure><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SUNION setA setB 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"1"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"2"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"3"</span> 
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"4"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>SUNION命令同样支持同时传入多个键，例如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SUNION setA setB setC 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"1"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"2"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"3"</span> 
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"4"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="ex%3A-%E5%AD%98%E5%82%A8%E6%96%87%E7%AB%A0%E6%A0%87%E7%AD%BE" tabindex="-1"><span class="prefix"></span><span class="content">ex: 存储文章标签</span><span class="suffix"></span></h4><p>考虑到一个文章的所有标签都是互不相同的，而且展示时对这些标签的排列顺序并没有要求，我们可以使用集合类型键存储文章标签。</p><p>对每篇文章使用键名为post:文章ID:tags的键存储该篇文章的标签。具体操作如伪代码：</p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">redis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">'post:42:tags 杂文 技术文章 java'</span><span class="token punctuation">)</span>

client<span class="token punctuation">.</span><span class="token function">srem</span><span class="token punctuation">(</span><span class="token string">'post:42:tags 杂文'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> tags <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">smembers</span><span class="token punctuation">(</span><span class="token string">'post:42:tags'</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>使用集合类型键存储标签适合需要单独增加或删除标签的场合。如在 WordPress博客程序中无论是添加还是删除标签都是针对单个标签的（如图 3-16 所示），可以直观地使用SADD和SREM命令完成操作。</p><p>另一方面，有些地方需要用户直接设置所有标签后一起上传修改，图3-17所示是某网站的个人资料编辑页面，用户编辑自己的爱好后提交，程序直接覆盖原来的标签数据，整个过程没有针对单个标签的操作，并未利用到集合类型的优势，所以此时也可以直接使用字符串类型键存储标签数据。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155710.png" alt="image-20190611144733359"></figure><blockquote><p>之所以特意提到这个在实践中的差别是想说明对于 Redis 存储方式的选择并没有绝对的规则，比如之前介绍过使用列表类型存储访客评论，但是在一些特定的场合下散列类型甚至字符串类型可能更适合。</p></blockquote><h4 id="ex%3A-%E9%80%9A%E8%BF%87%E6%A0%87%E7%AD%BE%E6%90%9C%E7%B4%A2%E6%96%87%E7%AB%A0" tabindex="-1"><span class="prefix"></span><span class="content">ex: 通过标签搜索文章</span><span class="suffix"></span></h4><p>有时我们还需要列出某个标签下的所有文章，甚至需要获得同时属于某几个标签的文章列表，这种需求在传统关系数据库中实现起来比较复杂，下面举一个例子。</p><p>现有3张表，即posts、tags和posts_tags，分别存储文章数据、标签、文章与标签的对应关系。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155711.png" alt="image-20190611144910454"></figure><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155712.png" alt="image-20190611144920479"></figure><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155713.png" alt="image-20190611144927774"></figure><p>为了找到同时属于“Java”、“MySQL”和“Redis”这3个标签的文章，需要使用如下的SQL语句：</p><div class="language-sql ext-sql code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-sql line-numbers-mode"><code class="language-sql"><span class="token keyword">SELECT</span> p<span class="token punctuation">.</span>post_title <span class="token keyword">FROM</span> posts_tags pt<span class="token punctuation">,</span> posts p<span class="token punctuation">,</span> tags t <span class="token keyword">WHERE</span> pt<span class="token punctuation">.</span>tag_id <span class="token operator">=</span> t<span class="token punctuation">.</span>tag_id <span class="token operator">AND</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>tag_name <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'Java'</span><span class="token punctuation">,</span> <span class="token string">'MySQL'</span><span class="token punctuation">,</span> <span class="token string">'Redis'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">AND</span> p<span class="token punctuation">.</span>post_id <span class="token operator">=</span> pt<span class="token punctuation">.</span>post_id <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> p<span class="token punctuation">.</span>post_id <span class="token keyword">HAVING</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>post_id<span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>很明显看到这样的 SQL 语句不仅效率相对较低，而且不易阅读和维护。而使用Redis可以很简单直接地实现这一需求。</p></blockquote><p>为每一个标签使用一个名为具体做法是为每个标签使用一个名为tag:标签名称:posts的集合类型键存储标有该标签的文章ID列表。假设现在有3篇文章，ID分别为1、2、3，其中ID为1的文章标签是“Java”，ID 为 2 的文章标签是“Java”、“MySQL”，ID 为 3 的文章标签是“Java”、“MySQL”和“Redis”。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155714.png" alt="image-20190611145903697"></figure><p>最简单的，当需要获取标记“MySQL”标签的文章时只需要使用命令 <code class="">SMEMBER Stag:MySQL:posts</code>即可。如果要实现找到同时属于Java、MySQL和Redis 3 个标签的文章，只需要将tag:Java:posts、tag:MySQL:posts和tag:Redis:posts这3个键取交集，借助SINTER命令即可轻松完成。</p><h4 id="%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%85-2" tabindex="-1"><span class="prefix"></span><span class="content">命令补充</span><span class="suffix"></span></h4><ol><li>获取集合中的元素个数</li></ol><p><code class="">SCARD key</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SMEMBERS letters 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"b"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"a"</span> 
redis<span class="token operator">&gt;</span> SCARD letters 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li><p>进行集合运算并将结果存储</p><p><code class="">SDIFFSTORE destination key [key …]</code></p><p><code class="">SINTERSTORE destination key [key …]</code></p><p><code class="">SUNIONSTORE destination key [key …]</code></p></li></ol><p>SDIFFSTORE命令和SDIFF命令功能一样，唯一的区别就是前者不会直接返回运算结果，而是将结果存储在destination键中。 SDIFFSTORE命令常用于需要进行多步集合运算的场景中，如需要先计算差集再将结果和其他键计算交集。 SINTERSTORE和SUNIONSTORE命令与之类似，不再赘述。</p><ol start="3"><li><p>随机获得集合中的元素</p><p><code class="">SRANDMEMBER key [count]</code></p></li></ol><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SRANDMEMBER letters 
<span class="token string">"a"</span> 
redis<span class="token operator">&gt;</span> SRANDMEMBER letters 
<span class="token string">"b"</span> 
redis<span class="token operator">&gt;</span> SRANDMEMBER letters 
<span class="token string">"a"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>还可以传递count参数来一次随机获得多个元素，根据count的正负不同，具体表现也不同。</p><p>（1）当count为正数时，SRANDMEMBER会随机从集合里获得count个不重复的元素。如果count的值大于集合中的元素个数，则SRANDMEMBER会返回集合中的全部元素。</p><p>（2）当count为负数时，SRANDMEMBER会随机从集合里获得|count|个的元素，这些元素有可能同。</p><p>4．从集合中弹出一个元素</p><p><code class="">SPOP key</code></p><p>我们学习过LPOP命令，作用是从列表左边弹出一个元素（即返回元素的值并删除它）。SPOP命令的作用与之类似，但由于集合类型的元素是无序的，<strong>所以 SPOP命令会从集合中随机选择一个元素弹出</strong>。</p><h3 id="%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B" tabindex="-1"><span class="prefix"></span><span class="content">有序集合类型</span><span class="suffix"></span></h3><h4 id="%E4%BB%8B%E7%BB%8D-5" tabindex="-1"><span class="prefix"></span><span class="content">介绍</span><span class="suffix"></span></h4><p>有序集合类型（sorted set）的特点从它的名字中就可以猜到，它与上一节介绍的集合类型的区别就是“有序”二字。</p><p>在集合类型的基础上有序集合类型为集合中的每个元素都关联了一个分数，这使得我们不仅可以完成插入、删除和判断元素是否存在等集合类型支持的操作，还能够获得分数最高（或最低）的前N个元素、获得指定分数范围内的元素等与分数有关的操作。虽然集合中每个元素都是不同的，但是它们的分数却可以相同。 有序集合类型在某些方面和列表类型有些相似。</p><p>（1）二者都是有序的。</p><p>（2）二者都可以获得某一范围的元素。</p><p>但是二者有着很大的区别，这使得它们的应用场景也是不同的。</p><p>（1）列表类型是通过链表实现的，获取靠近两端的数据速度极快，而当元素增多后，访问中间数据的速度会较慢，所以它更加适合实现如“新鲜事”或“日志”这样很少访问中间元素的应用。</p><p>（2）有序集合类型是使用散列表和跳跃表（Skip list）实现的，所以即使读取位于中间部分的数据速度也很快（时间复杂度是O(log(N))）。</p><p>（3）列表中不能简单地调整某个元素的位置，但是有序集合可以（通过更改这个元素的分数）。</p><p>（4）有序集合要比列表类型更耗费内存。</p><h4 id="%E5%91%BD%E4%BB%A4-4" tabindex="-1"><span class="prefix"></span><span class="content">命令</span><span class="suffix"></span></h4><ol><li>增加元素</li></ol><p><code class="">ZADD key score member [score member...]</code></p><p>ZADD 命令用来向有序集合中加入一个元素和该元素的分数，如果该元素已经存在则会用新的分数替换原有的分数。ZADD命令的返回值是新加入到集合中的元素个数（不包含之前已经存在的元素）。</p><p>假设我们用有序集合模拟计分板，现在要记录Tom、Peter和David三名运动员的分数（分别是89分、67分和100分）：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZADD scoreboard <span class="token number">89</span> Tom <span class="token number">67</span> Peter <span class="token number">100</span> David 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这时我们发现Peter的分数录入有误，实际的分数应该是76分，可以用ZADD命令修改Peter的分数：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZADD scoreboard <span class="token number">76</span> Peter 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>分数不仅可以是整数，还支持双精度浮点数：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZADD testboard 17E+307 a 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> ZADD testboard <span class="token number">1.5</span> b 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> ZADD testboard +inf c 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> ZADD testboard -inf d 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>

</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>获得元素的分数</li></ol><p><code class="">ZSCORE key member</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZSCORE scoreboard Tom 
<span class="token string">"89"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>获得排名在某个范围的元素列表</li></ol><p><code class="">ZRANGE key start stop [WITHSCORES]</code></p><p><code class="">ZREVRANGE key start stop [WITHSCORES]</code></p><p>ZRANGE命令会按照元素分数从小到大的顺序返回索引从 start到stop之间的所有元素（包含两端的元素）。ZRANGE命令与LRANGE命令十分相似，如索引都是从0开始，负数代表从后向前查找（−1表示最后一个元素）。就像这样：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZRANGE scoreboard <span class="token number">0</span> <span class="token number">2</span> 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"Peter"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"Tom"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"David"</span> 
redis<span class="token operator">&gt;</span> ZRANGE scoreboard <span class="token number">1</span> -1 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"Tom"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"David"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>如果需要同时获得元素的分数</strong>的话可以在 ZRANGE 命令的尾部加上 WITHSCORES 参数，这时返回的数据格式就从“元素1, 元素2, „, 元素n”变为了“元素1, 分数1, 元素2, 分数2, „, 元素n, 分数n”。</p><p>ZRANGE命令的时间复杂度为O(log n+m)（其中n为有序集合的基数，m为返回的元素个数）。</p><p>如果两个元素的分数相同，Redis会按照字典顺序（即"0"&lt;“9”&lt;“A”&lt;“Z”&lt;“a”&lt;"z"这样的顺序）来进行排列。再进一步，如果元素的值是中文怎么处理呢？答案是取决于中文的编码方式，如使用UTF-8编码：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZADD chineseName <span class="token number">0</span> 马华 <span class="token number">0</span> 刘墉 <span class="token number">0</span> 司马光 <span class="token number">0</span> 赵哲 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span> 
redis<span class="token operator">&gt;</span> ZRANGE chineseName <span class="token number">0</span> -1
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"<span class="token entity" title="\xe5">\xe5</span><span class="token entity" title="\x88">\x88</span><span class="token entity" title="\x98">\x98</span><span class="token entity" title="\xe5">\xe5</span><span class="token entity" title="\xa2">\xa2</span><span class="token entity" title="\x89">\x89</span>"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"<span class="token entity" title="\xe5">\xe5</span><span class="token entity" title="\x8f">\x8f</span><span class="token entity" title="\xb8">\xb8</span><span class="token entity" title="\xe9">\xe9</span><span class="token entity" title="\xa9">\xa9</span><span class="token entity" title="\xac">\xac</span><span class="token entity" title="\xe5">\xe5</span><span class="token entity" title="\x85">\x85</span><span class="token entity" title="\x89">\x89</span>"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"<span class="token entity" title="\xe8">\xe8</span><span class="token entity" title="\xb5">\xb5</span><span class="token entity" title="\xb5">\xb5</span><span class="token entity" title="\xe5">\xe5</span><span class="token entity" title="\x93">\x93</span><span class="token entity" title="\xb2">\xb2</span>"</span> 
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"<span class="token entity" title="\xe9">\xe9</span><span class="token entity" title="\xa9">\xa9</span><span class="token entity" title="\xac">\xac</span><span class="token entity" title="\xe5">\xe5</span><span class="token entity" title="\x8d">\x8d</span><span class="token entity" title="\x8e">\x8e</span>"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>可见此时Redis依然按照字典顺序排列这些元素。 <strong>ZREVRANGE命令和ZRANGE的唯一不同在于ZREVRANGE命令是按照元素分数从大到小的顺序给出结果的。</strong></p><ol start="4"><li>获得指定分数范围的元素</li></ol><p><code class="">ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]</code></p><p>ZRANGEBYSCORE 命令参数虽然多，但是都很好理解。该命令按照元素分数从小到大的顺序返回分数在min和max之间（包含min和max）的元素：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZRANGEBYSCORE scoreboard <span class="token number">80</span> <span class="token number">100</span>
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"Tom"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"David"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果希望分数范围不包含端点值，可以在分数前加上“(”符号。例如，希望返回”80分到100分的数据，可以含80分，但不包含100分，则稍微修改一下上面的命令即可：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZRANGEBYSCORE scoreboard <span class="token number">80</span> <span class="token punctuation">(</span><span class="token number">100</span> 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"Tom"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>min和max还支持无穷大，同ZADD命令一样，-inf和+inf分别表示负无穷和正无穷。比如你希望得到所有分数高于80分（不包含80分）的人的名单，但你却不知道最高分是多少（虽然有些背离现实，但是为了叙述方便，这里假设可以获得的分数是无上限的），这时就可以用上+inf了：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZRANGEBYSCORE scoreboard <span class="token punctuation">(</span><span class="token number">80</span> +inf 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"Tom"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"David"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>WITHSCORES参数的用法与ZRANGE命令一样，不再赘述。</p><p>了解 SQL 语句的读者对 LIMIT offset count 应该很熟悉，在本命令中 LIMIT offset count 与 SQL 中的用法基本相同，即在获得的元素列表的基础上向后偏移offset个元素，并且只获取前count个元素。为了便于演示，我们先向scoreboard键中再增加些元素：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZADD scoreboard <span class="token number">56</span> Jerry <span class="token number">92</span> Wendy <span class="token number">67</span> Yvonne 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZRANGE scoreboard <span class="token number">0</span> -1 WITHSCORES 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"Jerry"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"56"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"Yvonne"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"67"</span> 
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"Peter"</span> 
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"76"</span> 
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">"Tom"</span> 
<span class="token number">8</span><span class="token punctuation">)</span> <span class="token string">"89"</span> 
<span class="token number">9</span><span class="token punctuation">)</span> <span class="token string">"Wendy"</span> 
<span class="token number">10</span><span class="token punctuation">)</span> <span class="token string">"92"</span> 
<span class="token number">11</span><span class="token punctuation">)</span> <span class="token string">"David"</span> 
<span class="token number">12</span><span class="token punctuation">)</span> <span class="token string">"100"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>想获得分数高于60分的从第二个人开始的3个人：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZRANGEBYSCORE scoreboard <span class="token number">60</span> +inf LIMIT <span class="token number">1</span> <span class="token number">3</span> 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"Peter"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"Tom"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"Wendy"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>那么，如果想获取分数低于或等于 100 分的前 3 个人怎么办呢？这时可以借助ZREVRANGEBYSCORE命令实现。对照前文提到的ZRANGE命令和ZREVRANGE命令之间的关系，相信很容易能明白ZREVRANGEBYSCORE 命令的功能。需要注意的是ZREVRANGEBYSCORE 命令不仅是按照元素分数从大往小的顺序给出结果的，而且它的 min和max参数的顺序和ZRANGEBYSCORE命令是相反的。就像这样：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZREVRANGEBYSCORE scoreboard <span class="token number">100</span> <span class="token number">0</span> LIMIT <span class="token number">0</span> <span class="token number">3</span> 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"David"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"Wendy"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"Tom"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="5"><li>增加某个元素的分数</li></ol><p><code class="">ZINCRBY key increment member</code></p><p>ZINCRBY 命令可以增加一个元素的分数，返回值是更改后的分数。例如，想给 Jerry加4分：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZINCRBY scoreboard <span class="token number">4</span> Jerry
<span class="token string">"60"</span> 
redis<span class="token operator">&gt;</span> ZINCRBY scoreboard -4 
Jerry 
<span class="token string">"56"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="ex%3A-%E5%AE%9E%E7%8E%B0%E6%8C%89%E7%82%B9%E5%87%BB%E9%87%8F%E6%8E%92%E5%90%8D" tabindex="-1"><span class="prefix"></span><span class="content">ex: 实现按点击量排名</span><span class="suffix"></span></h4><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">redis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> currentPage <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// 当前页面为1</span>
<span class="token keyword">const</span> listLength <span class="token operator">=</span> <span class="token number">10</span>

<span class="token keyword">const</span> start <span class="token operator">=</span> <span class="token punctuation">(</span>currentPage <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> listLength
<span class="token keyword">const</span> end <span class="token operator">=</span> currentPage <span class="token operator">*</span> listLength <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">// 0-9</span>

<span class="token keyword">const</span> postID <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">zrevrange</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">post:page.view </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>start<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>end<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 递减</span>

postID<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">hgetall</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">post:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><p>如果需要按时间排序，只需修改文章存储时的分数为对应文章发布的Unix时间即可。</p></blockquote><h4 id="%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%85-3" tabindex="-1"><span class="prefix"></span><span class="content">命令补充</span><span class="suffix"></span></h4><ol><li>获取集合中元素的数量</li></ol><p><code class="">ZCARD key</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZCARD scoreboard
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>获得指定分数范围内的元素个数</li></ol><p><code class="">ZCOUNT key min max</code></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZCOUNT scoreboard <span class="token number">90</span> <span class="token number">100</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
redis<span class="token operator">&gt;</span> ZCOUNT scoreboard <span class="token punctuation">(</span><span class="token number">89</span> +inf 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">2</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>3．删除一个或多个元素</p><p><code class="">ZREM key member [member …]</code></p><p>ZREM命令的返回值是成功删除的元素数量（不包含本来就不存在的元素）。</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZREM scoreboard Wendy 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> ZCARD scoreboard 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>4．按照排名范围删除元素</p><p><code class="">ZREMRANGEBYRANK key start stop</code></p><p>ZREMRANGEBYRANK 命令按照元素分数从小到大的顺序（即索引 0表示最小的值）删除处在指定排名范围内的所有元素，并返回删除的元素数量。如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZADD testRem <span class="token number">1</span> a <span class="token number">2</span> b <span class="token number">3</span> c <span class="token number">4</span> d <span class="token number">5</span> e <span class="token number">6</span> f 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span> 
redis<span class="token operator">&gt;</span> ZREMRANGEBYRANK testRem <span class="token number">0</span> <span class="token number">2</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span> 
redis<span class="token operator">&gt;</span> ZRANGE testRem <span class="token number">0</span> -1 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"d"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"e"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"f"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>5．按照分数范围删除元素</p><p><code class="">ZREMRANGEBYSCORE key min max</code></p><p>ZREMRANGEBYSCORE命令会删除指定分数范围内的所有元素，参数min和max的特性和ZRANGEBYSCORE命令中的一样。返回值是删除的元素数量。如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZREMRANGEBYSCORE testRem <span class="token punctuation">(</span><span class="token number">4</span> <span class="token number">5</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> ZRANGE testRem <span class="token number">0</span> -1 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"d"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"f"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>6．获得元素的排名</p><p><code class="">ZRANK key member</code></p><p><code class="">ZREVRANK key member</code></p><p>ZRANK命令会按照元素分数从小到大的顺序获得指定的元素的排名（从0开始，即分数最小的元素排名为0）。如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZRANK scoreboard Peter 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ZREVRANK命令则相反（分数最大的元素排名为0）：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZREVRANK scoreboard Peter 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>7．计算有序集合的交集</p><p><code class="">ZINTERSTORE destination numkeys key [key …] [WEIGHTS weight [weight …]] [AGGREGATE</code>SUM|MIN|MAX] ZINTERSTORE命令用来计算多个有序集合的交集并将结果存储在destination键中（同样以有序集合类型存储），返回值为destination键中的元素个数。 destination键中元素的分数是由AGGREGATE参数决定的。</p><h2 id="%E7%AC%AC%E4%BA%8C%E7%AB%A0-redis%E8%BF%9B%E9%98%B6%E4%B8%8E%E5%AE%9E%E6%88%98" tabindex="-1"><span class="prefix"></span><span class="content">第二章 redis进阶与实战</span><span class="suffix"></span></h2><h3 id="%E8%BF%9B%E9%98%B6" tabindex="-1"><span class="prefix"></span><span class="content">进阶</span><span class="suffix"></span></h3><h4 id="%E4%BA%8B%E5%8A%A1" tabindex="-1"><span class="prefix"></span><span class="content">事务</span><span class="suffix"></span></h4><p>举个例子： 在微博中，用户之间是“关注”和“被关注”的关系。如果要使用Redis存储这样的关系可以使用集合类型。思路是对每个用户使用两个集合类型键，<strong>分别名为“user:用户ID:followers”和“user:用户ID:following”</strong>，用来存储关注该用户的用户集合和该用户关注的用户集合。</p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">redis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">follow</span><span class="token punctuation">(</span><span class="token parameter">currentUser<span class="token punctuation">,</span> targetUser</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">post:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currentUser<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:following </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>targetUser<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  client<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">post:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>targetUser<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:followers </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>currentUser<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="%E5%91%BD%E4%BB%A4-5" tabindex="-1"><span class="prefix"></span><span class="content">命令</span><span class="suffix"></span></h5><p><code class="">MULTI</code></p><p>Redis中的事务（transaction）是一组命令的集合。事务同命令一样都是Redis中的事务（transaction）是一组命令的集合。事务同命令一样都是 Redis 的最小执行单位，<strong>一个事务中的命令要么都执行，要么都不执行。</strong></p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> MULTI OK 
redis<span class="token operator">&gt;</span> SADD <span class="token string">"user:1:following"</span> <span class="token number">2</span> 
QUEUED 
redis<span class="token operator">&gt;</span> SADD <span class="token string">"user:2:followers"</span> <span class="token number">1</span> 
QUEUED redis<span class="token operator">&gt;</span> EXEC 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86" tabindex="-1"><span class="prefix"></span><span class="content">错误处理</span><span class="suffix"></span></h5><ul><li><p>语法错误： 可以发现并且中断后面的执行</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> MULTI
OK
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">set</span> shiwu hello
QUEUED
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> asdasdasd
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR unknown <span class="token builtin class-name">command</span> <span class="token variable"><span class="token variable">`</span>asdasdasd<span class="token variable">`</span></span>, with args beginning with:
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">exec</span>
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT Transaction discarded because of previous errors.
<span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> get shiwu
<span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li><li><p>运行错误： redis无法发现</p></li></ul><blockquote><p>Redis的事务没有关系数据库事务提供的回滚（rollback）[1] 功能。为此开发者必须在事务执行出错后自己收拾剩下的摊子（将数据库复原回事务执行前的状态等）。 不过由于 Redis 不支持回滚功能，也使得 Redis 在事务上可以保持简洁和快速。另外回顾刚才提到的会导致事务执行失败的两种错误，其中语法错误完全可以在开发时找出并解决，另外如果能够很好地规划数据库（保证键名规范等）的使用，是不会出现如命令与数据类型不匹配这样的运行错误的。</p></blockquote><h5 id="watch%E5%91%BD%E4%BB%A4%E4%BB%8B%E7%BB%8D" tabindex="-1"><span class="prefix"></span><span class="content">WATCH命令介绍</span><span class="suffix"></span></h5><p>我们已经知道在一个事务中只有当所有命令都依次执行完后才能得到每个结果的返回值，可是有些情况下需要先获得一条命令的返回值，然后再根据这个值执行下一条命令。</p><p><code class="">WATCH</code>命令可以监控一个或多个键，一旦其中有一个键被修改（或删除），之后的事务就不会执行。</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SET key <span class="token number">1</span> OK 
redis<span class="token operator">&gt;</span> WATCH key OK 
redis<span class="token operator">&gt;</span> SET key <span class="token number">2</span> OK 
redis<span class="token operator">&gt;</span> MULTI OK 
redis<span class="token operator">&gt;</span> SET key <span class="token number">3</span> QUEUED 
redis<span class="token operator">&gt;</span> EXEC <span class="token punctuation">(</span>nil<span class="token punctuation">)</span> 
redis<span class="token operator">&gt;</span> GET key <span class="token string">"2"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>我们可以利用WATCH来重构之前实现的incr函数来避免竞态</p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">redis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">incr</span><span class="token punctuation">(</span><span class="token parameter">$key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">watch</span><span class="token punctuation">(</span>$key<span class="token punctuation">)</span>
  <span class="token keyword">let</span> value <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>$key<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value <span class="token operator">=</span> <span class="token number">0</span>
    value <span class="token operator">=</span> value <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> value</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="%E8%BF%87%E6%9C%9F%E6%97%B6%E9%97%B4" tabindex="-1"><span class="prefix"></span><span class="content">过期时间</span><span class="suffix"></span></h4><p>在实际的开发中经常会遇到一些有时效的数据，比如限时优惠活动、缓存或验证码等，过了一定的时间就需要删除这些数据。在关系数据库中一般需要额外的一个字段记录到期时间，然后定期检测删除过期数据。而在Redis中可以使用 EXPIRE命令设置一个键的过期时间，到时间后Redis会自动删除它。</p><p>EXPIRE 命令的使用方法为 <code class="">EXPIRE key seconds</code>，其中 seconds 参数表示键的过期时间，单位是秒。如要想让session:29e3d键在15分钟后被删除：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SET session:29e3d uid1314 
OK 
redis<span class="token operator">&gt;</span> EXPIRE session:29e3d <span class="token number">900</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>**EXPIRE命令返回1表示设置成功，返回0则表示键不存在或设置失败。**例如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> DEL session:29e3d 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> EXPIRE session:29e3d <span class="token number">900</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">0</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>**如果想知道一个键还有多久的时间会被删除，可以使用TTL命令。**返回值是键的剩余时间（单位是秒）：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SET foo bar 
OK 
redis<span class="token operator">&gt;</span> EXPIRE foo <span class="token number">20</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> TTL foo 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">15</span> 
redis<span class="token operator">&gt;</span> TTL foo 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span> 
redis<span class="token operator">&gt;</span> TTL foo 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> –2

</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>可见随着时间的不同，foo键的过期时间逐渐减少，20秒后foo键会被删除。<strong>当键不存在时TTL命令会返回−2。</strong> 那么没有为键设置过期时间（即永久存在，这是建立一个键后的默认情况）的情况下会返回什么呢？<strong>答案是返回−1：</strong></p><p><strong>如果想取消键的过期时间设置（即将键恢复成永久的）</strong>，则可以使用<code class="">PERSIST</code>命令。如果过期时间被成功清除则返回1；否则返回0（因为键不存在或键本来就是永久的）：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SET foo bar 
OK 
redis<span class="token operator">&gt;</span> EXPIRE foo <span class="token number">20</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> PERSIST foo 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> TTL foo 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> –1
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>除了PERSIST命令之外</strong>，使用SET或GETSET命令为键赋值也会<strong>同时清除键的过期时间</strong>，例如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> EXPIRE foo <span class="token number">20</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> SET foo bar OK 
redis<span class="token operator">&gt;</span> TTL foo 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> –1
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>其他只对键值进行操作的命令（如INCR、LPUSH、HSET、ZREM）均不会影响键的过期时间。</strong></p><p>EXPIRE命令的seconds参数必须是整数，所以最小单位是1秒。**如果想要更精确的控制键的过期时间应该使用 PEXPIRE命令，**PEXPIRE命令与 EXPIRE的唯一区别是前者的时间单位是毫秒，即 PEXPIRE key 1000 与 EXPIRE key 1 等价。对应地可以用 PTTL命令以毫秒为单位返回键的剩余时间。</p><blockquote><p>提示 如果使用 WATCH命令监测了一个拥有过期时间的键，该键时间到期自动删除并不会被WATCH命令认为该键被改变。</p></blockquote><p><strong>另外还有两个相对不太常用的命令</strong>：<code class="">EXPIREAT</code> <code class="">和 PEXPIREAT</code>。</p><p>EXPIREAT命令与EXPIRE命令的差别在于前者使用Unix时间作为第二个参数表示键的过期时刻。PEXPIREAT命令与EXPIREAT命令的区别是前者的时间单位是毫秒。如：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SET foo bar OK 
redis<span class="token operator">&gt;</span> EXPIREAT foo <span class="token number">1351858600</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> 
redis<span class="token operator">&gt;</span> TTL foo 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">142</span> 
redis<span class="token operator">&gt;</span> PEXPIREAT foo <span class="token number">1351858700000</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h5 id="ex%3A-%E5%AE%9E%E7%8E%B0%E8%AE%BF%E9%97%AE%E9%A2%91%E7%8E%87%E9%99%90%E5%88%B6" tabindex="-1"><span class="prefix"></span><span class="content">ex: 实现访问频率限制</span><span class="suffix"></span></h5><p>需求：为了减轻服务器的压力，需要限制每个用户（以IP计）一段时间的最大访问量。</p><p>实现： 通过<code class="">EXPIRE</code>。</p><p>分析思路：</p><ol><li>根据用户ID新建一个字段 <code class="">rate.limite:$IP</code>, 存储的结果是访问量</li><li>用户每次访问的时候使用incr进行+1，并且EXPIRE设置一个过期时间</li><li>如果没过期则+1， 过期了则新建字段初始化访问次数0</li></ol><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">redis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> isKeyExists <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">'rate:limite:$ip'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>isKeyExists<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">'rate:limite:$ip'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">'你已经不能访问了，请休息下'</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token string">'rate:limite:$ip'</span><span class="token punctuation">)</span>
  client<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">'rate:limite:$ip 60'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>这段代码存在一个不太明显的问题：假如程序执行完倒数第二行后突然因为某种原因退出了，没能够为该键设置过期时间，那么该键会永久存在，导致使用对应的IP的用户在管理员手动删除该键前最多只能访问100次博客，这是一个很严重的问题。</p></blockquote><p>修改思路：使用事务包裹else</p><blockquote><p>如果一个用户在一分钟的第一秒访问了一次博客，在同一分钟的最后一秒访问了9次，又在下一分钟的第一秒访问了10次，这样的访问是可以通过现在的访问频率限制的，但实际上该用户在2秒内访问了19次博客，这与每个用户每分钟只能访问10次的限制差距较大。尽管这种情况比较极端，但是在一些场合中还是需要粒度更小的控制方案。</p></blockquote><p>修改思路：将散列结构改造为列表</p><ol><li>新建一个 <code class="">rate:limit:$ip</code>的列表字段</li><li>每次访问向列表中存入当前时间戳</li><li>如果 列表长度小于10则存入</li><li>如果等于10，则讲列表的第一个时间戳和现在的时间对比。<ol><li>如果小于60秒则拒绝访问</li><li>反之存入，并删除第一条时间</li></ol></li></ol><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">redis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> listLength <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">llen</span><span class="token punctuation">(</span><span class="token string">'rate:limit:$ip'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>listLength <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  client<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rate:limit:$ip </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> time <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">lindex</span><span class="token punctuation">(</span><span class="token string">'rate:limit:$ip -1'</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> time <span class="token operator">&lt;</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">'访问超过限制'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">.</span><span class="token function">lpush</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rate:limit:$ip </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span><span class="token function">ltrim</span><span class="token punctuation">(</span><span class="token string">'rate:limit:$ip 0 9'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h5 id="ex%EF%BC%9A%E5%AE%9E%E7%8E%B0%E7%BC%93%E5%AD%98" tabindex="-1"><span class="prefix"></span><span class="content">ex：实现缓存</span><span class="suffix"></span></h5><p>假设学生成绩总在不断地变化，需要每隔两个小时就重新计算一次排名，这可以通过给键设置过期时间的方式实现。每次用户访问首页时程序先查询缓存键是否存在，如果存在则直接使用缓存的值；否则重新计算排名并将计算结果赋值给该键并同时设置该键的过期时间为两个小时。伪代码如下：</p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'redis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">redis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 配置</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> rank <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'cache:rank'</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rank<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> $rank <span class="token operator">=</span> <span class="token function">jisuan</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  client<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  client<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">cache:rank </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>$rank<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  client<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span><span class="token string">'cache:rank 7200'</span><span class="token punctuation">)</span>
  client<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><blockquote><p>然而在一些场合中这种方法并不能满足需要。当服务器内存有限时，如果大量地使用缓存键且过期时间设置得过长就会导致 Redis 占满内存；另一方面如果为了防止 Redis 占用内存过大而将缓存键的过期时间设得太短，就可能导致缓存命中率过低并且大量内存白白地闲置。实际开发中会发现很难为缓存键设置合理的过期时间，为此可以限制 Redis 能够使用的最大内存，并让Redis按照一定的规则淘汰不需要的缓存键，这种方式在只将Redis用作缓存系统时非常实用。</p></blockquote><h4 id="%E6%8E%92%E5%BA%8F" tabindex="-1"><span class="prefix"></span><span class="content">排序</span><span class="suffix"></span></h4><p>我们学过哪些可以排序的操作?</p><ul><li>有序集合: 根据存储的分数进行排序</li><li>列表： 根据插入的顺序排序</li></ul><p>介绍一种新的排序方法 <code class="">SORT</code></p><ol><li>sort可以对列表类型进行排序</li></ol><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> LPUSH mylist <span class="token number">4</span> <span class="token number">2</span> <span class="token number">6</span> <span class="token number">1</span> <span class="token number">3</span> <span class="token number">7</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">6</span> 
redis<span class="token operator">&gt;</span> SORT mylist
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="2"><li>sort可以对有序集合进行排序</li></ol><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> ZADD myzset <span class="token number">50</span> <span class="token number">2</span> <span class="token number">40</span> <span class="token number">3</span> <span class="token number">20</span> <span class="token number">1</span> <span class="token number">60</span> <span class="token number">5</span> 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span> 
redis<span class="token operator">&gt;</span> SORT myzset 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"1"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"2"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"3"</span> 
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"5"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>在对有序集合类型排序时会忽略元素的分数，只针对元素自身的值进行排序。</p></blockquote><ol start="3"><li>还可以对非数字类型进行排序</li></ol><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> LPUSH mylistalpha a c e d B C A 
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">7</span> 
redis<span class="token operator">&gt;</span> SORT mylistalpha 
<span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR One or <span class="token function">more</span> scores can't be converted into double 
redis<span class="token operator">&gt;</span> SORT mylistalpha ALPHA 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"A"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"B"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"C"</span> 
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"a"</span> 
<span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"c"</span> 
<span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"d"</span> 
<span class="token number">7</span><span class="token punctuation">)</span> <span class="token string">"e"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="4"><li>DESC参数可以从大到小排序，还可以加入limit参数</li><li>通过<code class="">BY</code>来根据时间排序</li></ol><p>BY参数的语法为BY参考键。其中参考键可以是字符串类型键或者是散列类型键的某个字段（表示为键名-&gt;字段名）。如果提供了 BY 参数，SORT 命令将不再依据元素自身的值进行排序，而是对每个元素使用元素的值替换参考键中的第一个“*”并获取其值，然后依据该值对元素排序。就像这样：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">redis<span class="token operator">&gt;</span> SORT tag:ruby:posts BY post:*-<span class="token operator">&gt;</span>time DESC 
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"12"</span> 
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"26"</span> 
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"6"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"2"</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>在上例中SORT命令会读取post:2、post:6、post:12、post:26几个散列键中的time字段的值并以此决定tag:ruby:posts键中各个文章ID的顺序。</p></blockquote><p>还可以跟进GET参数获取你想要的字段的值，而不是排序的依据字段</p><p><code class="">SORT tag:ruby:posts BY post:*-&gt;time DESC GET post:*-&gt;title</code></p><p><code class="">SORT tag:ruby:posts BY post:*-&gt;time DESC GET post:*-&gt;title GET post:*-&gt;time</code></p><p>如果还想返回文章的ID怎么办</p><p><code class="">redis&gt; SORT tag:ruby:posts BY post:*-&gt;time DESC GET post:*-&gt;title GET post:*-&gt;time GET #</code></p><h4 id="%E6%80%A7%E8%83%BD" tabindex="-1"><span class="prefix"></span><span class="content">性能</span><span class="suffix"></span></h4><p>比如<code class="">SORT</code>是redis最复杂的命令之一，如果使用的不好容易造成性能瓶颈。</p><p>SORT命令的复杂度为 0(n + mlog(m))， n代表要排序的列表长度，m代表需要返回的元素个数。</p><ol><li>尽可能减少待排序键中元素的属性(使n尽可能小)</li><li>利用LIMIT参数使m尽可能的小</li><li>如果要排序的数量比较大，尽量将结果缓存</li></ol><h4 id="%E7%AE%A1%E9%81%93" tabindex="-1"><span class="prefix"></span><span class="content">管道</span><span class="suffix"></span></h4><p>客户端和Redis使用TCP协议连接。不论是客户端向Redis发送命令还是Redis向客户端返回命令的执行结果，都需要经过网络传输，这两个部分的总耗时称为往返时延。</p><p>Redis 的底层通信协议对管道（pipelining）提供了支持。通过管道可以一次性发送多条命令并在执行完后一次性将结果返回，当一组命令中每条命令都不依赖于之前命令的执行结果时就可以将这组命令一起通过管道发出。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155715.png" alt="image-20190616122914879"></figure><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155716.png" alt="image-20190616122933539"></figure><h4 id="%E8%8A%82%E7%9C%81%E7%A9%BA%E9%97%B4" tabindex="-1"><span class="prefix"></span><span class="content">节省空间</span><span class="suffix"></span></h4><h5 id="%E7%B2%BE%E7%AE%80%E9%94%AE%E5%80%BC%E5%92%8C%E9%94%AE%E5%90%8D" tabindex="-1"><span class="prefix"></span><span class="content">精简键值和键名</span><span class="suffix"></span></h5><p>精简键名和键值是最直观的减少内存占用的方式，如将键名very.important.person:20改成VIP:20。当然精简键名一定要把握好尺度，不能单纯为了节约空间而使用不易理解的键名（比如将VIP:20修改为V:20，这样既不易维护，还容易造成命名冲突）。又比如一个存储用户性别的字符串类型键的取值是male和female，我们可以将其修改成m和f来为每条记录节约几个字节的空间，甚至通过二进制的0和1来表示。</p><h3 id="nodejs%E6%93%8D%E4%BD%9Credis%E6%95%B0%E6%8D%AE%E5%BA%93" tabindex="-1"><span class="prefix"></span><span class="content">nodejs操作redis数据库</span><span class="suffix"></span></h3><h4 id="%E6%A1%86%E6%9E%B6%E9%80%89%E6%8B%A9" tabindex="-1"><span class="prefix"></span><span class="content">框架选择</span><span class="suffix"></span></h4><ul><li>node_redis</li><li>ioredis</li></ul><p>node_redis星星更多但是我们选择ioredis，因为ioredis更新，属于node_redis改良版。</p><blockquote><p>不过ioredis与node_redis的作者正在讨论将两者合为一个库。</p></blockquote><ul><li>ioredis安装<ul><li><code class="">npm install ioredis</code></li></ul></li></ul><h4 id="%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85" tabindex="-1"><span class="prefix"></span><span class="content">可视化工具安装</span><span class="suffix"></span></h4><ul><li>收费</li><li>免费：<strong>AnotherRedisDesktopManager</strong></li></ul><h4 id="%E5%AE%89%E8%A3%85" tabindex="-1"><span class="prefix"></span><span class="content">安装</span><span class="suffix"></span></h4><p><a href="https://github.com/mood6666/AnotherRedisDesktopManager" target="_blank" rel="noopener">https://github.com/mood6666/AnotherRedisDesktopManager</a></p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155717.png" alt="image-20190619215755808"></figure><h4 id="%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95" tabindex="-1"><span class="prefix"></span><span class="content">基本语法</span><span class="suffix"></span></h4><ul><li>一些简单的操作</li></ul><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> Redis <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ioredis'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> redis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

redis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span>
redis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
redis<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>

<span class="token comment">// Or using a promise if the last argument isn't a function</span>
redis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// Arguments to commands are flattened, so the following are the same:</span>
redis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">'set'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
redis<span class="token punctuation">.</span><span class="token function">sadd</span><span class="token punctuation">(</span><span class="token string">'set'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// All arguments are passed directly to the redis server:</span>
redis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'EX'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><ul><li>连接redis</li></ul><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">new</span> <span class="token class-name">Redis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Connect to 127.0.0.1:6379</span>
<span class="token keyword">new</span> <span class="token class-name">Redis</span><span class="token punctuation">(</span><span class="token number">6380</span><span class="token punctuation">)</span> <span class="token comment">// 127.0.0.1:6380</span>
<span class="token keyword">new</span> <span class="token class-name">Redis</span><span class="token punctuation">(</span><span class="token number">6379</span><span class="token punctuation">,</span> <span class="token string">'192.168.1.1'</span><span class="token punctuation">)</span> <span class="token comment">// 192.168.1.1:6379</span>
<span class="token keyword">new</span> <span class="token class-name">Redis</span><span class="token punctuation">(</span><span class="token string">'/tmp/redis.sock'</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Redis</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">6379</span><span class="token punctuation">,</span> <span class="token comment">// Redis port</span>
  <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token comment">// Redis host</span>
  <span class="token literal-property property">family</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token comment">// 4 (IPv4) or 6 (IPv6)</span>
  <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'auth'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">db</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>pipelining</li></ul><p>对redis实现的管道，避免出现前面提到的往返时延问题。</p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> pipeline <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
pipeline<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span>
pipeline<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">'cc'</span><span class="token punctuation">)</span>
pipeline<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> results</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// `err` is always null, and `results` is an array of responses</span>
  <span class="token comment">// corresponding to the sequence of queued commands.</span>
  <span class="token comment">// Each response follows the format `[err, result]`.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// You can even chain the commands:</span>
redis<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token string">'cc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> results</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// `exec` also returns a Promise:</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> redis<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// result === [[null, 'OK'], [null, 'bar']]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>还有另外一种调用方式：</p><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js">redis<span class="token punctuation">.</span><span class="token function">pipeline</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'set'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'get'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>事务</li></ul><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js">redis<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> results</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// results === [[null, 'OK'], [null, 'bar']]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="%E7%AC%AC%E4%B8%89%E7%AB%A0-memcached" tabindex="-1"><span class="prefix"></span><span class="content">第三章 memcached</span><span class="suffix"></span></h2><h3 id="%E4%BB%8B%E7%BB%8D-6" tabindex="-1"><span class="prefix"></span><span class="content">介绍</span><span class="suffix"></span></h3><p>Memcached是一个自由开源的，高性能，分布式内存对象缓存系统。</p><p>Memcached是一种基于内存的key-value存储，用来存储小块的任意数据（字符串、对象）。这些数据可以是数据库调用、API调用或者是页面渲染的结果。</p><p><strong>本质上，它是一个简洁的key-value存储系统。</strong></p><p>redis已经包含了memcached的功能，而且更丰富，所有只需了解即可。</p><h3 id="%E5%AE%89%E8%A3%85-1" tabindex="-1"><span class="prefix"></span><span class="content">安装</span><span class="suffix"></span></h3><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">brew <span class="token function">install</span> memcached
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="api" tabindex="-1"><span class="prefix"></span><span class="content">API</span><span class="suffix"></span></h3><ol><li><strong>set</strong></li></ol><p>Memcached set 命令用于将 <strong>value(数据值)</strong> 存储在指定的 <strong>key(键)</strong> 中。</p><p>如果set的key已经存在，该命令可以更新该key所对应的原来的数据，也就是实现更新的作用。</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token builtin class-name">set</span> key flags exptime bytes <span class="token punctuation">[</span>noreply<span class="token punctuation">]</span> 
value 
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>参数说明如下：</p><ul><li>**key：**键值 key-value 结构中的 key，用于查找缓存值。</li><li><strong>flags</strong>：可以包括键值对的整型参数，客户机使用它存储关于键值对的额外信息 。</li><li><strong>exptime</strong>：在缓存中保存键值对的时间长度（以秒为单位，0 表示永远）</li><li><strong>bytes</strong>：在缓存中存储的字节数</li><li><strong>noreply（可选）</strong>： 该参数告知服务器不需要返回数据</li><li><strong>value</strong>：存储的值（始终位于第二行）（可直接理解为key-value结构中的value）</li></ul><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token builtin class-name">set</span> runoob <span class="token number">0</span> <span class="token number">900</span> <span class="token number">9</span>
memcached
STORED

get runoob
VALUE runoob <span class="token number">0</span> <span class="token number">9</span>
memcached

</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果数据添加成功，则输出：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">STORED
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="2"><li><strong>add</strong></li></ol><p>Memcached add 命令用于将 <strong>value(数据值)</strong> 存储在指定的 <strong>key(键)</strong> 中。</p><p>如果 add 的 key 已经存在，则不会更新数据(过期的 key 会更新)，之前的值将仍然保持相同，并且您将获得响应 <strong>NOT_STORED</strong>。(说明只能存新值，没有修改功能)</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token function">add</span> key flags exptime bytes <span class="token punctuation">[</span>noreply<span class="token punctuation">]</span>
value
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>参数说明如下：</p><ul><li>**key：**键值 key-value 结构中的 key，用于查找缓存值。</li><li><strong>flags</strong>：可以包括键值对的整型参数，客户机使用它存储关于键值对的额外信息 。</li><li><strong>exptime</strong>：在缓存中保存键值对的时间长度（以秒为单位，0 表示永远）</li><li><strong>bytes</strong>：在缓存中存储的字节数</li><li><strong>noreply（可选）</strong>： 该参数告知服务器不需要返回数据</li><li><strong>value</strong>：存储的值（始终位于第二行）（可直接理解为key-value结构中的value）</li></ul><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token function">add</span> new_key <span class="token number">0</span> <span class="token number">900</span> <span class="token number">10</span>
data_value
STORED
get new_key
VALUE new_key <span class="token number">0</span> <span class="token number">10</span>
data_value
END
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果数据添加成功，则输出：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">STORED
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="3"><li>replace</li></ol><p>Memcached replace 命令用于替换已存在的 <strong>key(键)</strong> 的 <strong>value(数据值)</strong>。</p><p>如果 key 不存在，则替换失败，并且您将获得响应 <strong>NOT_STORED</strong>。</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">replace key flags exptime bytes <span class="token punctuation">[</span>noreply<span class="token punctuation">]</span>
value
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>参数说明如下：</p><ul><li>**key：**键值 key-value 结构中的 key，用于查找缓存值。</li><li><strong>flags</strong>：可以包括键值对的整型参数，客户机使用它存储关于键值对的额外信息 。</li><li><strong>exptime</strong>：在缓存中保存键值对的时间长度（以秒为单位，0 表示永远）</li><li><strong>bytes</strong>：在缓存中存储的字节数</li><li><strong>noreply（可选）</strong>： 该参数告知服务器不需要返回数据</li><li><strong>value</strong>：存储的值（始终位于第二行）（可直接理解为key-value结构中的value）</li></ul><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token function">add</span> mykey <span class="token number">0</span> <span class="token number">900</span> <span class="token number">10</span>
data_value
STORED
get mykey
VALUE mykey <span class="token number">0</span> <span class="token number">10</span>
data_value
END
replace mykey <span class="token number">0</span> <span class="token number">900</span> <span class="token number">16</span>
some_other_value
get mykey
VALUE mykey <span class="token number">0</span> <span class="token number">16</span>
some_other_value
END
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>如果数据添加成功，则输出：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">STORED
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="4"><li>append</li></ol><p>Memcached append 命令用于向已存在 <strong>key(键)</strong> 的 <strong>value(数据值)</strong> 后面追加数据 。</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">append key flags exptime bytes <span class="token punctuation">[</span>noreply<span class="token punctuation">]</span>
value
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>参数说明如下：</p><ul><li>**key：**键值 key-value 结构中的 key，用于查找缓存值。</li><li><strong>flags</strong>：可以包括键值对的整型参数，客户机使用它存储关于键值对的额外信息 。</li><li><strong>exptime</strong>：在缓存中保存键值对的时间长度（以秒为单位，0 表示永远）</li><li><strong>bytes</strong>：在缓存中存储的字节数</li><li><strong>noreply（可选）</strong>： 该参数告知服务器不需要返回数据</li><li><strong>value</strong>：存储的值（始终位于第二行）（可直接理解为key-value结构中的value）</li></ul><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token builtin class-name">set</span> runoob <span class="token number">0</span> <span class="token number">900</span> <span class="token number">9</span>
memcached
STORED
get runoob
VALUE runoob <span class="token number">0</span> <span class="token number">9</span>
memcached
END
append runoob <span class="token number">0</span> <span class="token number">900</span> <span class="token number">5</span>
redis
STORED
get runoob
VALUE runoob <span class="token number">0</span> <span class="token number">14</span>
memcachedredis
END
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>如果数据添加成功，则输出：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">STORED
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ol start="5"><li>prepend</li></ol><p>Memcached prepend 命令用于向已存在 <strong>key(键)</strong> 的 <strong>value(数据值)</strong> 前面追加数据 。</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">prepend key flags exptime bytes <span class="token punctuation">[</span>noreply<span class="token punctuation">]</span>
value
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>参数说明如下：</p><ul><li>**key：**键值 key-value 结构中的 key，用于查找缓存值。</li><li><strong>flags</strong>：可以包括键值对的整型参数，客户机使用它存储关于键值对的额外信息 。</li><li><strong>exptime</strong>：在缓存中保存键值对的时间长度（以秒为单位，0 表示永远）</li><li><strong>bytes</strong>：在缓存中存储的字节数</li><li><strong>noreply（可选）</strong>： 该参数告知服务器不需要返回数据</li><li><strong>value</strong>：存储的值（始终位于第二行）（可直接理解为key-value结构中的value）</li></ul><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token builtin class-name">set</span> runoob <span class="token number">0</span> <span class="token number">900</span> <span class="token number">9</span>
memcached
STORED
get runoob
VALUE runoob <span class="token number">0</span> <span class="token number">9</span>
memcached
END
prepend runoob <span class="token number">0</span> <span class="token number">900</span> <span class="token number">5</span>
redis
STORED
get runoob
VALUE runoob <span class="token number">0</span> <span class="token number">14</span>
redismemcached
END
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>如果数据添加成功，则输出：</p><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell">STORED
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="%E7%AC%AC%E5%9B%9B%E7%AB%A0-mongodb" tabindex="-1"><span class="prefix"></span><span class="content">第四章 mongoDB</span><span class="suffix"></span></h2><h3 id="%E4%BB%8B%E7%BB%8D-7" tabindex="-1"><span class="prefix"></span><span class="content">介绍</span><span class="suffix"></span></h3><p>MongoDB 是一个基于分布式文件存储的数据库。<strong>由 C++ 语言编写</strong>。旨在为 WEB 应用提供可扩展的高性能数据<strong>存储解决方案</strong>。</p><p>MongoDB 是一个介于关系数据库和非关系数据库之间的产品，是<strong>非关系数据库</strong>当中功能最丰富，最像关系数据库的。</p><p><strong>mongoD是关系型数据库的补充。</strong></p><h3 id="%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" tabindex="-1"><span class="prefix"></span><span class="content">应用场景</span><span class="suffix"></span></h3><h4 id="%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF" tabindex="-1"><span class="prefix"></span><span class="content">适用场景</span><span class="suffix"></span></h4><ol><li>用在应用服务器的日志记录，查找起来比文本灵活，导出也很方便。也是给应用练手，从外围系统开始使用MongoDB。</li><li>主要用来存储一些监控数据，No schema 对开发人员来说，真的很方便，增加字段不用改表结构，而且学习成本极低。</li><li>网站数据：适合实时的插入，更新与查询，并具备网站实时数据存储所需的复制及高度伸缩性。</li><li>大尺寸、低价值的数据：使用传统的关系数据库存储一些数据时可能会比较贵，在此之前，很多程序员往往会选择传统的文件进行存储。</li></ol><h4 id="%E4%B8%8D%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF" tabindex="-1"><span class="prefix"></span><span class="content">不适用场景</span><span class="suffix"></span></h4><ol><li>高度事物性的系统：例如银行或会计系统。传统的关系型数据库目前还是更适用于需要大量原子性复杂事务的应用程序。</li></ol><h4 id="%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9" tabindex="-1"><span class="prefix"></span><span class="content">如何选择</span><span class="suffix"></span></h4><p>如果上述有1个 Yes，可以考虑 MongoDB，2个及以上的 Yes，选择MongoDB绝不会后悔。</p><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155718.png" alt="image-20190620001142154"></figure><h3 id="%E5%AE%89%E8%A3%85-2" tabindex="-1"><span class="prefix"></span><span class="content">安装</span><span class="suffix"></span></h3><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token function">sudo</span> brew <span class="token function">install</span> mongodb
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><p>可视化工具安装</p><ul><li><a href="https://studio3t.com/download-thank-you/?OS=osx" target="_blank" rel="noopener">https://studio3t.com/download-thank-you/?OS=osx</a></li></ul></li><li><p>nodejs操作mongoDB库</p><ul><li><a href="https://github.com/mongodb/node-mongodb-native" target="_blank" rel="noopener">https://github.com/mongodb/node-mongodb-native</a></li><li><code class="">npm install mongodb --save</code></li></ul></li></ul><h3 id="%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5" tabindex="-1"><span class="prefix"></span><span class="content">增删改查</span><span class="suffix"></span></h3><p>三个概念</p><ul><li>数据库</li><li>集合： 类似关系型数据库里的表</li><li>文档： 一条一条的数据</li></ul><h4 id="%E5%A2%9E" tabindex="-1"><span class="prefix"></span><span class="content">增</span><span class="suffix"></span></h4><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">insertDocuments</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Get the documents collection</span>
  <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span>
  <span class="token comment">// Insert some documents</span>
  collection<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Inserted 3 documents into the collection'</span><span class="token punctuation">)</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="%E6%9F%A5" tabindex="-1"><span class="prefix"></span><span class="content">查</span><span class="suffix"></span></h4><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">selectData</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> whereStr <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
  collection<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>whereStr<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="%E6%94%B9" tabindex="-1"><span class="prefix"></span><span class="content">改</span><span class="suffix"></span></h4><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">updateData</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> whereStr <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> updataStr <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  collection<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>whereStr<span class="token punctuation">,</span> updataStr<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h4 id="%E5%88%A0" tabindex="-1"><span class="prefix"></span><span class="content">删</span><span class="suffix"></span></h4><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">delData</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">db<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> collection <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">'documents'</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> whereStr <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span>
  collection<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>whereStr<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="%E7%AC%AC%E4%BA%94%E7%AB%A0-egg-%2B-redis-%2B-mongodb%E5%AE%9E%E7%8E%B0%E7%99%BB%E5%BD%95%E6%B5%81%E7%A8%8B(-%E8%A1%A5%E5%85%85-)" tabindex="-1"><span class="prefix"></span><span class="content">第五章 Egg + Redis + MongoDb实现登录流程( 补充 )</span><span class="suffix"></span></h2><h3 id="%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84%E5%9B%BE" tabindex="-1"><span class="prefix"></span><span class="content">项目架构图</span><span class="suffix"></span></h3><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155719.png" alt="image-20190814183452073"></figure><h3 id="%E7%9B%AE%E6%A0%87" tabindex="-1"><span class="prefix"></span><span class="content">目标</span><span class="suffix"></span></h3><ul><li>了解cookie和session的关系</li><li>从前后端角度全面了解登录流程</li><li>了解redis在登录流程中的作用</li><li>因为用户数据和浏览器交互非常频繁，而 redis非常的快，如果使用硬盘型数据库（mongo, mysql）频繁读写可能会遇到一些性能问题。</li></ul><p>理解登录流程对于前端来讲，<strong>非常重要！</strong></p><blockquote><p>登录流程在面试中出现的频率的非常高，因为题目比较抽象，所以你很难背诵，可以考察很多方面的知识。</p><p>比如: 你做的项目中是如何进行登录的？ 如何保持登录态的？</p><ul><li>http的理解</li><li>cookie和session的区别</li><li>对数据库的理解</li><li>web安全性(xss, csrf)</li></ul></blockquote><h3 id="cookie-%E5%92%8C-session%E6%98%AF%E5%A6%82%E4%BD%95%E7%BB%B4%E6%8C%81%E7%99%BB%E5%BD%95%E7%9A%84%EF%BC%9F" tabindex="-1"><span class="prefix"></span><span class="content">cookie 和 session是如何维持登录的？</span><span class="suffix"></span></h3><p>session是基于cookie存在的一种形式。</p><blockquote><p>举个例子： 假如cookie是米，session是粥。</p><ol><li><p>那么他们是同一种东西吗？</p></li><li><p>他们都是米吗？</p></li></ol><p>总结： 没有米就没有粥，他们都是米，但是不是同一种东西。</p></blockquote><p>所以，没有cookie就没有session。</p><h4 id="cookie%E7%9A%84%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B" tabindex="-1"><span class="prefix"></span><span class="content">cookie的交互过程</span><span class="suffix"></span></h4><ol><li>浏览器第一次访问服务端 (此时无cookie)</li><li>服务端收到请求， 通过response携带一个 set-cookie字段给客户端</li><li>客户端收到response之后，根据set-cookie的内容，将cookie存储在浏览器本地</li><li>客户端再次发起请求的时候，就会将cookie带给服务端</li></ol><h4 id="cookie%E7%BB%B4%E6%8C%81%E7%99%BB%E5%BD%95%E7%9A%84%E8%BF%87%E7%A8%8B" tabindex="-1"><span class="prefix"></span><span class="content">cookie维持登录的过程</span><span class="suffix"></span></h4><ol><li>用户输入用户名，密码，通过request发送给服务端</li><li>服务端去数据库查询用户名密码对不对</li><li>如果正确，假如 你的用户名是 “jack”， 服务端将在response中set-cookie为"username=jack"。</li><li>浏览器下次再发起请求的时候，将携带 “username=jack” 这一段内容给服务端</li><li>服务端拿到"username=jack"之后，去数据库一查，发现有这个人，于是认为此人已登录</li></ol><h4 id="session%E7%9A%84%E4%BA%A4%E4%BA%92%E8%BF%87%E7%A8%8B" tabindex="-1"><span class="prefix"></span><span class="content">session的交互过程</span><span class="suffix"></span></h4><p>和cookie一致，没有cookie就没有session。</p><h4 id="session%E7%BB%B4%E6%8C%81%E7%99%BB%E5%BD%95%E7%9A%84%E8%BF%87%E7%A8%8B" tabindex="-1"><span class="prefix"></span><span class="content">session维持登录的过程</span><span class="suffix"></span></h4><p><strong>其实首先我们要搞清楚一点，如果仅仅只是需要维持登录，根本就不需要session，使用上面的方法完全够用。</strong></p><p>但是我们设想一种场景：</p><p>你的公司有一百个系统，你的用户名是 “我是老板”。我希望只注册一次账号，就能涉及所有的权限，登录所有的系统。但是有的人，注册一次账号只能进入某些系统。如果使用set-cookie存储，我们可能需要在用户的系统中存一个这样的字符串。“username=我是老板&amp;&amp;系统A=true&amp;&amp;系统B=true&amp;&amp;系统C=true。。。”。</p><p>可能今天涉及系统权限，明天还会添加每个用户的菜单权限，这样是无止尽的。而且cookie最大只能存储4k的数据，总有一天会存满，显然这种方案是不成立的。</p><p><strong>假如我们的cookie能够存储为对象，而且不受cookie的4k大小的限制，而且能够浏览器与服务端通信，那该有多好啊！</strong></p><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"><span class="token property">"我是老板"</span><span class="token operator">:</span><span class="token punctuation">{</span>
	xxx1<span class="token operator">:</span> 'xxx'<span class="token punctuation">,</span>
	xxx2<span class="token operator">:</span> 'xxxx'<span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>于是session诞生了。</strong></p><ol><li>用户输入用户名，密码，通过request发送给服务端</li><li>服务端去数据库查询用户名密码对不对</li><li>如果正确，假如 你的用户名是 “jack”， 服务端将在response中set-cookie为"username=jack"。</li><li>并且同时服务端在数据库（mondoDb, mysql）中存储一些以jack为key的对象或者数据 (购物车，权限, 登录状态 等等 )</li><li>客户端再次访问的时候，将携带 “username=jack” 这样一个cookie，服务端会拿到"jack"去查询 (购物车，权限, 登录状态 等等 )</li><li>服务器根据查询到的信息，返回不同的页面到客户端</li></ol><p><strong>总结： cookie是将用户数据存储在本地，session是将用户相关的数据存储到服务端。</strong></p><h3 id="%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B" tabindex="-1"><span class="prefix"></span><span class="content">业务流程</span><span class="suffix"></span></h3><figure><img src="https://gitee.com/artiely/Figure-bed/raw/master/images/20200313155720.png" alt="image-20190814185727785"></figure><h3 id="%E5%AE%9E%E7%8E%B0%E4%BB%A3%E7%A0%81" tabindex="-1"><span class="prefix"></span><span class="content">实现代码</span><span class="suffix"></span></h3><h4 id="%E9%A1%B9%E7%9B%AE%E5%88%9D%E5%A7%8B%E5%8C%96" tabindex="-1"><span class="prefix"></span><span class="content">项目初始化</span><span class="suffix"></span></h4><div class="language-shell ext-shell code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-shell line-numbers-mode"><code class="language-shell"><span class="token function">npm</span> init egg --type<span class="token operator">=</span>simple
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="%E9%A1%B9%E7%9B%AE%E4%BE%9D%E8%B5%96" tabindex="-1"><span class="prefix"></span><span class="content">项目依赖</span><span class="suffix"></span></h4><ul><li>egg-mongoose</li><li>egg-redis</li><li>egg-session</li></ul><div class="language-json ext-json code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-json line-numbers-mode"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"session-redis"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"1.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"description"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"egg"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"declarations"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"egg"</span><span class="token operator">:</span> <span class="token string">"^2.15.1"</span><span class="token punctuation">,</span>
    <span class="token property">"egg-mongoose"</span><span class="token operator">:</span> <span class="token string">"^3.2.0"</span><span class="token punctuation">,</span>
    <span class="token property">"egg-redis"</span><span class="token operator">:</span> <span class="token string">"^2.4.0"</span><span class="token punctuation">,</span>
    <span class="token property">"egg-scripts"</span><span class="token operator">:</span> <span class="token string">"^2.11.0"</span><span class="token punctuation">,</span>
    <span class="token property">"egg-session"</span><span class="token operator">:</span> <span class="token string">"^3.1.0"</span><span class="token punctuation">,</span>
    <span class="token property">"egg-view-nunjucks"</span><span class="token operator">:</span> <span class="token string">"^2.2.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"autod"</span><span class="token operator">:</span> <span class="token string">"^3.0.1"</span><span class="token punctuation">,</span>
    <span class="token property">"autod-egg"</span><span class="token operator">:</span> <span class="token string">"^1.1.0"</span><span class="token punctuation">,</span>
    <span class="token property">"egg-bin"</span><span class="token operator">:</span> <span class="token string">"^4.13.1"</span><span class="token punctuation">,</span>
    <span class="token property">"egg-ci"</span><span class="token operator">:</span> <span class="token string">"^1.11.0"</span><span class="token punctuation">,</span>
    <span class="token property">"egg-mock"</span><span class="token operator">:</span> <span class="token string">"^3.21.0"</span><span class="token punctuation">,</span>
    <span class="token property">"eslint"</span><span class="token operator">:</span> <span class="token string">"^5.13.0"</span><span class="token punctuation">,</span>
    <span class="token property">"eslint-config-egg"</span><span class="token operator">:</span> <span class="token string">"^7.1.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"engines"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"node"</span><span class="token operator">:</span> <span class="token string">"&gt;=10.0.0"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"egg-scripts start --daemon --title=egg-server-session-redis"</span><span class="token punctuation">,</span>
    <span class="token property">"stop"</span><span class="token operator">:</span> <span class="token string">"egg-scripts stop --title=egg-server-session-redis"</span><span class="token punctuation">,</span>
    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"egg-bin dev"</span><span class="token punctuation">,</span>
    <span class="token property">"debug"</span><span class="token operator">:</span> <span class="token string">"egg-bin debug"</span><span class="token punctuation">,</span>
    <span class="token property">"test"</span><span class="token operator">:</span> <span class="token string">"npm run lint -- --fix &amp;&amp; npm run test-local"</span><span class="token punctuation">,</span>
    <span class="token property">"test-local"</span><span class="token operator">:</span> <span class="token string">"egg-bin test"</span><span class="token punctuation">,</span>
    <span class="token property">"cov"</span><span class="token operator">:</span> <span class="token string">"egg-bin cov"</span><span class="token punctuation">,</span>
    <span class="token property">"lint"</span><span class="token operator">:</span> <span class="token string">"eslint ."</span><span class="token punctuation">,</span>
    <span class="token property">"ci"</span><span class="token operator">:</span> <span class="token string">"npm run lint &amp;&amp; npm run cov"</span><span class="token punctuation">,</span>
    <span class="token property">"autod"</span><span class="token operator">:</span> <span class="token string">"autod"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"ci"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"10"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"repository"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"git"</span><span class="token punctuation">,</span>
    <span class="token property">"url"</span><span class="token operator">:</span> <span class="token string">""</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"author"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
  <span class="token property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><h4 id="%E6%8F%92%E4%BB%B6%E9%85%8D%E7%BD%AE" tabindex="-1"><span class="prefix"></span><span class="content">插件配置</span><span class="suffix"></span></h4><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js">config<span class="token punctuation">.</span>session <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">encrypt</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">signed</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token comment">// maxAge: 10000</span>
<span class="token punctuation">}</span>

config<span class="token punctuation">.</span>redis <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">client</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">6379</span><span class="token punctuation">,</span> <span class="token comment">// Redis port</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token comment">// Redis host</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'auth'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">db</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

config<span class="token punctuation">.</span>mongoose <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'mongodb://127.0.0.1/redis-mongoose'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// mongoose global plugins, expected a function or an array of function and options</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token comment">/** @type Egg.EggPlugin */</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// had enabled by egg</span>
  <span class="token comment">// static: {</span>
  <span class="token comment">//   enable: true,</span>
  <span class="token comment">// }</span>
  <span class="token literal-property property">nunjucks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">enable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">'egg-view-nunjucks'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">redis</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">enable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">'egg-redis'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">session</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mongoose</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">enable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">'egg-mongoose'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h4 id="%E8%B7%AF%E7%94%B1" tabindex="-1"><span class="prefix"></span><span class="content">路由</span><span class="suffix"></span></h4><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> router<span class="token punctuation">,</span> controller <span class="token punctuation">}</span> <span class="token operator">=</span> app
  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>home<span class="token punctuation">.</span>index<span class="token punctuation">)</span>

  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/sign'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>login<span class="token punctuation">.</span>signHtml<span class="token punctuation">)</span>
  router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/sign'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>login<span class="token punctuation">.</span>sign<span class="token punctuation">)</span>

  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>login<span class="token punctuation">.</span>loginHtml<span class="token punctuation">)</span>
  router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/login'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>login<span class="token punctuation">.</span>login<span class="token punctuation">)</span>
  router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">,</span> controller<span class="token punctuation">.</span>login<span class="token punctuation">.</span>logout<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="%E6%8E%A7%E5%88%B6%E5%99%A8" tabindex="-1"><span class="prefix"></span><span class="content">控制器</span><span class="suffix"></span></h4><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token comment">// app/controller/home.js</span>
<span class="token string">'use strict'</span>

<span class="token keyword">const</span> Controller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'egg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Controller

<span class="token keyword">class</span> <span class="token class-name">HomeController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>login<span class="token punctuation">)</span>
      <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'home'</span><span class="token punctuation">)</span>

    <span class="token keyword">else</span>
      ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> HomeController
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token comment">// app/controller/login.js</span>
<span class="token string">'use strict'</span>

<span class="token keyword">const</span> Controller <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'egg'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Controller

<span class="token keyword">class</span> <span class="token class-name">SignController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">signHtml</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">// console.log(user);</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'sign'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token comment">// console.log('================',ctx.request.body);</span>
    <span class="token keyword">const</span> requestBody <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">.</span><span class="token function">insertMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">username</span><span class="token operator">:</span> requestBody<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
      <span class="token literal-property property">password</span><span class="token operator">:</span> requestBody<span class="token punctuation">.</span>password<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// console.log(user);</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'&lt;h1&gt;注册成功！&lt;/h1&gt;'</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">loginHtml</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token keyword">const</span> requestBody <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body
    <span class="token keyword">const</span> inputPassword <span class="token operator">=</span> requestBody<span class="token punctuation">.</span>password

    <span class="token keyword">const</span> findUser <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">username</span><span class="token operator">:</span> requestBody<span class="token punctuation">.</span>username<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>findUser<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> findUser<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>password <span class="token operator">===</span> inputPassword<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>login <span class="token operator">=</span> <span class="token boolean">true</span>
      ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// console.log('findUser', findUser)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> ctx<span class="token punctuation">,</span> app <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span>
    ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>login <span class="token operator">=</span> <span class="token boolean">false</span>
    ctx<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> SignController
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h4 id="model" tabindex="-1"><span class="prefix"></span><span class="content">model</span><span class="suffix"></span></h4><div class="language-js ext-js code-wrapper"><div class="cbt-traffic_light"><span></span><span></span><span></span></div><span class="copy"></span><div class="code-inner"><pre class="language-js line-numbers-mode"><code class="language-js"><span class="token comment">// {app_root}/app/model/user.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> mongoose <span class="token operator">=</span> app<span class="token punctuation">.</span>mongoose
  <span class="token keyword">const</span> Schema <span class="token operator">=</span> mongoose<span class="token punctuation">.</span>Schema

  <span class="token keyword">const</span> UserSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">'User'</span><span class="token punctuation">,</span> UserSchema<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div><div pt-10=""><div class="flex justify-between"><a href="/post/2019/2019-10-3-alinode" class="text-gray-500"><span class="text-gray-500">上一篇: </span><span class="text-gray-500">Nodejs通用业务模块</span></a></div><div class="flex justify-between"><a href="/post/2019/2019-7-13-automated-testing" class="text-gray-500"><span class="text-gray-500">下一篇: </span><span class="text-gray-500">自动化测试</span></a></div></div></div></main><nav text-xl="" mt-6="" text-center="" py-10="" class="footer" style="--3b7ca6b3:rgba(92, 110, 130, 0.05)"><a href="/" class="icon-btn mx-2" title="Home"><div i-iconoir:home-simple-door=""></div></a><button class="icon-btn mx-2 !outline-none" title="Toggle dark mode"><div i="carbon-sun dark:carbon-moon"></div></button><a href="/about" class="icon-btn mx-2" title="About"><div i-carbon-dicom-overlay=""></div></a><a href="/pic" class="icon-btn mx-2" title="图集"><div i-ph:image-fill=""></div></a><a class="icon-btn mx-2" rel="noreferrer" href="https://github.com/artiely" target="_blank" title="GitHub"><div i-carbon-logo-github=""></div></a></nav><!--]--><!--teleport start--><div class="el-overlay" style="z-index:3071;display:none"><!--[--><!--[--><div aria-modal="true" aria-label="评论" aria-describedby="el-id-9564-140" class="el-drawer rtl" style="width:620px" role="dialog"><span class="el-drawer__sr-focus" tabindex="-1"></span><header class="el-drawer__header"><!--[--><span id="el-id-9564-141" role="heading" class="el-drawer__title">评论</span><!--]--><button aria-label="Close this dialog" class="el-drawer__close-btn" type="button"><i class="el-icon el-drawer__close" style=""><!--[--><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"></path></svg><!--]--></i></button></header><!--v-if--><!--v-if--></div><!--]--><!--]--></div><!--teleport end--><div class="i-ant-design:comment-outlined icon" title="评论"></div><!--]--></div><script>window.__INITIAL_STATE__='{"pinia":{"data":{"bookmark":[{"version":3,"lists":[{"title":"博客","cards":[{"title":"Hacker News","url":"https://news.ycombinator.com/","favIconUrl":"https://news.ycombinator.com/favicon.ico","customTitle":"","customDescription":""},{"title":"酷壳 – CoolShell.cn","url":"https://coolshell.cn/","favIconUrl":"https://coolshell.cn/favicon.ico","customTitle":"","customDescription":""},{"title":"OurJS 爱我技术 我们的技术-IT文摘 JavaScript社区 Node.JS社区 前端社区 全端论坛 MongoDB html5 CSS3 开源社区 | OurJS","url":"http://ourjs.com/home","favIconUrl":"http://ourjs.com/ourjs/img/favicon.ico","customTitle":"OurJS","customDescription":"OurJS 爱我技术 我们的技术-IT文摘 JavaScript社区 Node.JS社区 前端社区 全端论坛 MongoDB html5 CSS3 开源社区 | OurJS"},{"title":"开始Web自动化测试 · CukeTest帮助文档","url":"http://cuketest.com/zh-cn/web/web_auto.html","favIconUrl":"http://cuketest.com/zh-cn/assets/images/favicon.ico","customTitle":"","customDescription":""},{"title":"好奇猫学院","url":"http://haoduoshipin.com/","favIconUrl":"","customTitle":"","customDescription":""},{"title":"Josh W Comeau","url":"https://www.joshwcomeau.com/","favIconUrl":"https://www.joshwcomeau.com/assets/favicon.png?v=4","customTitle":"","customDescription":""},{"title":"Smashing Magazine — For Web Designers And Developers","url":"https://www.smashingmagazine.com/","favIconUrl":"https://www.smashingmagazine.com/images/favicon/favicon.svg","customTitle":"","customDescription":""},{"title":"CSS-Tricks - Tips, Tricks, and Techniques on using Cascading Style Sheets.","url":"https://css-tricks.com/","favIconUrl":"https://css-tricks.com/favicon.svg","customTitle":"","customDescription":""},{"title":"Medium","url":"https://medium.com/","favIconUrl":"https://miro.medium.com/1*m-R_BkNf1Qjr1YbyOIJY2w.png","customTitle":"","customDescription":""},{"title":"DEV Community 👩‍💻👨‍💻 - Latest posts","url":"https://dev.to/latest","favIconUrl":"https://res.cloudinary.com/practicaldev/image/fetch/s--E8ak4Hr1--/c_limit,f_auto,fl_progressive,q_auto,w_32/https://dev-to.s3.us-east-2.amazonaws.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Blog - JakeArchibald.com","url":"https://jakearchibald.com/","favIconUrl":"https://jakearchibald.com/c/favicon-67801369.png","customTitle":"","customDescription":""},{"title":"Red Stapler | Coding Tutorials and Development Tips","url":"https://redstapler.co/","favIconUrl":"https://redstapler.co/wp-content/uploads/2016/12/cropped-favicon-32x32.png","customTitle":"","customDescription":""},{"title":"阮一峰的网络日志","url":"https://www.ruanyifeng.com/blog/","favIconUrl":"https://www.ruanyifeng.com/favicon.ico","customTitle":"","customDescription":""}],"labels":[{"title":"blog","color":"blue"}]}]},{"version":3,"lists":[{"title":"灵感","cards":[{"title":"Awwwards - Website Awards - Best Web Design Trends","url":"https://www.awwwards.com/","favIconUrl":"https://assets.awwwards.com/assets/images/favicon.svg","customTitle":"","customDescription":""},{"title":"(166) Pinterest","url":"https://www.pinterest.com/","favIconUrl":"https://s.pinimg.com/webapp/favicon-54a5b2af.png","customTitle":"Pinterest","customDescription":"Pinterest"},{"title":"Godly — The Best Web Design Inspiration","url":"https://godly.website/","favIconUrl":"https://godly.website/favicon.png","customTitle":"","customDescription":""},{"title":"OpenProcessing - Creative Coding for the Curious Mind","url":"https://openprocessing.org/","favIconUrl":"https://openprocessing.org/assets/img/logo/favicons/favicon.ico","customTitle":"","customDescription":""},{"title":"No images for this search have been found — Yandex.Images","url":"https://yandex.com/images/search","favIconUrl":"https://yastatic.net/images-thumbs/_/8cS_MbHl6VBweqVjWeI-eNy0tzE.ico","customTitle":"","customDescription":""},{"title":"Dribbble - Discover the World’s Top Designers & Creative Professionals","url":"https://dribbble.com/","favIconUrl":"https://cdn.dribbble.com/assets/favicon-b38525134603b9513174ec887944bde1a869eb6cd414f4d640ee48ab2a15a26b.ico","customTitle":"","customDescription":""},{"title":"Similarsites.com - Easily Explore alternative websites","url":"https://www.similarsites.com/","favIconUrl":"https://www.similarsites.com/static/favicon.png","customTitle":"","customDescription":""}],"labels":[]}]},{"version":3,"lists":[{"title":"学习","cards":[{"title":"Frontend Masters — Learn JavaScript, React, Vue & Angular from Masters of Front-End Development!","url":"https://frontendmasters.com/","favIconUrl":"https://frontendmasters.com/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Three.js Journey — Learn WebGL with Three.js","url":"https://threejs-journey.com/#","favIconUrl":"https://threejs-journey.com/assets/favicons/favicon.ico","customTitle":"","customDescription":""},{"title":"JavaScript Garden","url":"http://bonsaiden.github.io/JavaScript-Garden/","favIconUrl":"http://bonsaiden.github.io/JavaScript-Garden/favicon.ico?v=2","customTitle":"","customDescription":""},{"title":"The Book of Shaders","url":"https://thebookofshaders.com/?lan=ch","favIconUrl":"https://thebookofshaders.com/favicon.gif","customTitle":"","customDescription":""},{"title":"Creative Coding TW - 互動程式創作台灣站 | 蒐集互動設計案例、教學與業界資源，幫助你一起進入互動程式創作的產業","url":"https://creativecoding.in/?utm_source=youtube&amp%3Butm_medium=weekend-chat&amp%3Butm_campaign=200912","favIconUrl":"https://creativecoding.in/wp-content/uploads/2022/03/cropped-cct-logo-icon-2-32x32.png","customTitle":"","customDescription":""},{"title":"Free JavaScript Resources | Java5cript.com - Learn JavaScript for free","url":"https://www.java5cript.com/","favIconUrl":"https://www.java5cript.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Codrops - 网络专业人士的创意前端资源和灵感","url":"https://tympanus.net/codrops/","favIconUrl":"https://i7x7p5b7.stackpathcdn.com/codrops/wp-content/themes/codropstheme03/favicons/favicon.ico?v=2","customTitle":"","customDescription":""},{"title":"The Modern JavaScript Tutorial","url":"https://javascript.info/","favIconUrl":"https://javascript.info/img/favicon/favicon.png","customTitle":"","customDescription":""},{"title":"lib.d.ts | 深入理解 TypeScript","url":"https://jkchao.github.io/typescript-book-chinese/typings/lib.html#%E4%BF%AE%E6%94%B9%E5%8E%9F%E5%A7%8B%E7%B1%BB%E5%9E%8B","favIconUrl":"https://jkchao.github.io/typescript-book-chinese/logo.png","customTitle":"理解 TypeScript","customDescription":"lib.d.ts | 深入理解 TypeScript"},{"title":"大前端面试宝典 - 图解前端","url":"https://lucifer.ren/fe-interview/#/","favIconUrl":"https://lucifer.ren/favicon.ico","customTitle":"","customDescription":""},{"title":"Learn to Code — For Free — Coding Courses for Busy People","url":"https://www.freecodecamp.org/","favIconUrl":"https://www.freecodecamp.org/favicon-32x32.png?v=6cba562cbd10e31af925a976f3db73f7","customTitle":"","customDescription":""},{"title":"The Complete Flutter Development Bootcamp with Dart | The App Brewery","url":"https://www.appbrewery.co/p/flutter-development-bootcamp-with-dart","favIconUrl":"https://process.fs.teachablecdn.com/ADNupMnWyR7kCWRvm76Laz/resize=width:32,height:32/https://d2vvqscadf4c1f.cloudfront.net/vz7d3KSRSQ6tfzXoQJfE_LABlogoCircularSmall.png","customTitle":"","customDescription":""},{"title":"JavaScript Promise迷你书（中文版）","url":"http://liubin.org/promises-book/","favIconUrl":"http://liubin.org/promises-book/public/img/favicon.ico","customTitle":"","customDescription":""},{"title":"Free JavaScript Resources | Java5cript.com - Learn JavaScript for free","url":"https://www.java5cript.com/","favIconUrl":"https://www.java5cript.com/favicon.ico","customTitle":"","customDescription":""},{"title":"极客时间","url":"https://time.geekbang.org/course/detail/269-193915","favIconUrl":"https://static001.geekbang.org/static/time/icon/favicon-32x32.jpg","customTitle":"","customDescription":""},{"title":"All the tags! | HackerNoon","url":"https://hackernoon.com/tagged","favIconUrl":"https://hackernoon.com/favicon.ico","customTitle":"HackerNoon","customDescription":"All the tags! | HackerNoon"},{"title":"Learn VIM while playing a game - VIM Adventures","url":"https://vim-adventures.com/","favIconUrl":"","customTitle":"","customDescription":""}],"labels":[]}]},{"version":3,"lists":[{"title":"JS工具","cards":[{"title":"regex101: build, test, and debug regex","url":"https://regex101.com/","favIconUrl":"https://regex101.com/static/assets/favicon.ico","customTitle":"regex","customDescription":"创建，测试，调试正则"},{"title":"Three Nebula - A Particle System Engine For ThreeJs","url":"https://three-nebula.org/","favIconUrl":"https://three-nebula.org/favicon/favicon.ico","customTitle":"ThreeJs离子","customDescription":"Three Nebula - A Particle System Engine For ThreeJs"},{"title":"A lightweight Node.js private proxy registry | Verdaccio","url":"https://verdaccio.org/zh-cn/","favIconUrl":"https://verdaccio.org/zh-CN/img/logo/uk/verdaccio-tiny-uk-no-bg.svg","customTitle":"Nodejs Npm私有仓库","customDescription":"A lightweight Node.js private proxy registry | Verdaccio"},{"title":"objkt.com | Tezos 上最大的 NFT 市场","url":"https://objkt.com/","favIconUrl":"https://objkt.com/favicon.ico","customTitle":"Tezos 上最大的 NFT 市场","customDescription":"objkt.com | Tezos 上最大的 NFT 市场"},{"title":"Random User Generator | Home","url":"https://randomuser.me/","favIconUrl":"https://randomuser.me/favicon.ico","customTitle":"Random User Generator","customDescription":"随机用户api"},{"title":"RxMarbles: Interactive diagrams of Rx Observables","url":"https://rxmarbles.com/#every","favIconUrl":"https://rxmarbles.com/favicon.png","customTitle":"Interactive diagrams of Rx Observables","customDescription":"可视化RXjs"},{"title":"RunKit + npm: dayjs | RunKit","url":"https://runkit.com/embed/7q6iei0v6p89","favIconUrl":"https://runkit.com/favicon.ico","customTitle":"RunKit + npm","customDescription":"浏览器中测试你的nodejs包"},{"title":"All – Tiny Helpers","url":"https://tiny-helpers.dev/","favIconUrl":"https://tiny-helpers.dev/favicon-32x32.png","customTitle":"","customDescription":""}],"labels":[]}]},{"version":3,"lists":[{"title":"CSS工具","cards":[{"title":"Gradient Collection: Subtle Backgrounds - Light","url":"https://www.gradientmagic.com/collection/subtlebg_light","favIconUrl":"https://www.gradientmagic.com/favicon/favicon.ico","customTitle":"CSS 背景","customDescription":"Gradient Collection: Subtle Backgrounds - Light"},{"title":"CSSのコピペだけ！おしゃれな見出しのデザイン例まとめ68選","url":"https://saruwakakun.com/html-css/reference/h-design","favIconUrl":"https://saruwakakun.com/wp-content/uploads/2017/03/cropped-favicon-01-32x32.png","customTitle":"CSSのコピペだけ！おしゃれな見出しのデザイン例まとめ68選","customDescription":"CSS标题设计范例"},{"title":"TTF转WOFF2 - 在线转换图像文件","url":"https://www.aconvert.com/cn/image/ttf-to-woff2/","favIconUrl":"https://www.aconvert.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Neumorphism/Soft UI CSS shadow generator","url":"https://neumorphism.io/#e0e0e0","favIconUrl":"https://neumorphism.io/favicon.ico","customTitle":"Neumorphism/Soft UI CSS shadow generator","customDescription":"拟物化UI"},{"title":"outline access time • Google Material Icons • Iconify","url":"https://icon-sets.iconify.design/ic/outline-access-time/","favIconUrl":"https://icon-sets.iconify.design/favicon@32.png","customTitle":"Iconify","customDescription":"icon图标大全"},{"title":"CSS Gradient — Generator, Maker, and Background","url":"https://cssgradient.io/","favIconUrl":"https://cssgradient.io/images/favicon-23859487.png","customTitle":"","customDescription":""},{"title":"SDK、插件-有字库","url":"https://www.webfont.com/sdk/MV95ems/59295bfbf629d81914b80ad4.html","favIconUrl":"https://cdn.res.webfont.com/wwwroot/www/favicon.ico","customTitle":"","customDescription":""},{"title":"Smooth Shadow","url":"https://shadows.brumm.af/","favIconUrl":"https://shadows.brumm.af/favicon.svg","customTitle":"","customDescription":""},{"title":"Fancy Border Radius Generator","url":"https://9elements.github.io/fancy-border-radius/#30.30.43.33--433.433","favIconUrl":"https://9elements.github.io/fancy-border-radius/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Keyframes","url":"https://keyframes.app/","favIconUrl":"https://keyframes.app/img/icons/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Interactive CSS Grid Generator | Layoutit Grid","url":"https://grid.layoutit.com/","favIconUrl":"https://grid.layoutit.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Easing Gradients","url":"https://larsenwork.com/easing-gradients/","favIconUrl":"https://larsenwork.com/favicon.ico","customTitle":"","customDescription":""},{"title":"CSS Arrow Please - By Simon Hoejberg - @shojberg","url":"https://cssarrowplease.com/","favIconUrl":"","customTitle":"","customDescription":""},{"title":"CSS Color Gradient Generator: beautiful gradients for free","url":"https://mybrandnewlogo.com/color-gradient-generator","favIconUrl":"https://static.mybrandnewlogo.com/images/icon.svg","customTitle":"","customDescription":""},{"title":"Animista - CSS Animations on Demand","url":"https://animista.net/","favIconUrl":"","customTitle":"","customDescription":""},{"title":"CSS Duotone Generator","url":"https://cssduotone.com/","favIconUrl":"https://cssduotone.com/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"CSS Cuboid Generator w/ React && Prism 😎","url":"https://codepen.io/jh3y/pen/MWJdqBo","favIconUrl":"https://cpwebassets.codepen.io/assets/favicon/favicon-aec34940fbc1a6e787974dcd360f2c6b63348d4b1f4e06c77743096d55480f33.ico","customTitle":"","customDescription":""},{"title":"Plaiceholder","url":"https://plaiceholder.co/","favIconUrl":"https://plaiceholder.co/assets/images/favicon/favicon@192px.png","customTitle":"","customDescription":""},{"title":"CSS Grid Generator","url":"https://cssgrid-generator.netlify.app/","favIconUrl":"https://cssgrid-generator.netlify.app/favicon.ico","customTitle":"","customDescription":""},{"title":"<css-doodle />","url":"https://css-doodle.com/","favIconUrl":"https://css-doodle.com/favicon.png","customTitle":"","customDescription":""},{"title":"CSSWAND","url":"https://www.csswand.dev/","favIconUrl":"https://www.csswand.dev/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Clippy — CSS clip-path maker","url":"https://bennettfeely.com/clippy/","favIconUrl":"https://bennettfeely.com/clippy/pics/favicon.png","customTitle":"","customDescription":""},{"title":"Type Scale - A Visual Calculator","url":"https://type-scale.com/","favIconUrl":"https://type-scale.com/favicon.ico","customTitle":"Type Scale","customDescription":"可视化文本布局调试"},{"title":"1-Line Layouts","url":"https://1linelayouts.glitch.me/","favIconUrl":"","customTitle":"1-Line Layouts","customDescription":"CSS经典布局"},{"title":"Omatsuri","url":"https://omatsuri.app/","favIconUrl":"https://omatsuri.app/assets/favicon.ico","customTitle":"Omatsuri","customDescription":"CSS网页工具"},{"title":"Fluid Typography","url":"https://fluid-typography.netlify.app/","favIconUrl":"","customTitle":"","customDescription":""}],"labels":[]}]},{"version":3,"lists":[{"title":"工具","cards":[{"title":"TinyPNG – Compress WebP, PNG and JPEG images intelligently","url":"https://tinypng.com/","favIconUrl":"https://tinypng.com/images/favicon.ico","customTitle":"TinyPNG","customDescription":"图片压缩webp,png,jpg"},{"title":"Excalidraw","url":"https://excalidraw.com/","favIconUrl":"https://excalidraw.com/favicon.ico","customTitle":"Excalidraw","customDescription":"手绘风流程图"},{"title":"让微信排版变Nice","url":"https://md.guozh.net/","favIconUrl":"https://md.guozh.net/favicon.svg","customTitle":"让微信排版变Nice","customDescription":"让微信排版变Nice 私有仓库"},{"title":"Lorem Picsum","url":"https://picsum.photos/","favIconUrl":"https://picsum.photos/assets/images/favicon/favicon-32x32.png","customTitle":"Lorem Picsum","customDescription":"随机图片"},{"title":"Create a Palette - Coolors","url":"https://coolors.co/ad343e-191308-454b66-677db7-9ca3db","favIconUrl":"https://coolors.co/assets/img/favicon.png","customTitle":"Coolors","customDescription":"调色板"},{"title":"🎁 Emoji cheat sheet for GitHub, Basecamp, Slack & more","url":"https://www.webfx.com/tools/emoji-cheat-sheet/","favIconUrl":"https://www.webfx.com/wp-content/uploads/2021/10/favicon.png","customTitle":"🎁 Emoji cheat sheet for GitHub, Basecamp, Slack & more","customDescription":"🎁 表情符号备忘单"},{"title":"Live2d Cubism 2","url":"https://imuncle.github.io/live2d/","favIconUrl":"https://imuncle.github.io/live2d/avatar.png","customTitle":"","customDescription":""},{"title":"HelloGitHub 第 74 期","url":"https://hellogithub.com/periodical/volume/74/","favIconUrl":"https://img.hellogithub.com/favicon/favicon.ico","customTitle":"HelloGitHub","customDescription":"HelloGitHub 推荐项目集合"},{"title":"过期域名查询 - 国际域名 - 站长工具","url":"http://del.chinaz.com/?kw=&p=0&bl=&el=&ds%5B%5D=1&ds%5B%5D=2&ds%5B%5D=3&pl=&sort=1&suffix%5B%5D=com&dt=1&date=1&pagesize=30&st=1&qq-pf-to=pcqq.c2c","favIconUrl":"http://csstools.chinaz.com/favicon.ico","customTitle":"过期域名查询 ","customDescription":"过期域名查询 - 国际域名 - 站长工具"},{"title":"Github Rank (China)","url":"https://githubrank.com/","favIconUrl":"https://githubrank.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Easing Functions Cheat Sheet","url":"https://easings.net/","favIconUrl":"https://easings.net/96.8aa68ac4.png","customTitle":"Easing Functions Cheat Sheet","customDescription":"缓动函数查询"},{"title":"Shields.io：开源项目的质量元数据徽章","url":"https://shields.io/","favIconUrl":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAABE0lEQVR4AWJkAIKkpCQ7TU3NySIiIlosQMCABejbMWAFf//8YXj77vWn27duZWVGz1nKGBYWZiQkJHSIkZGRmwEPCMxiwAt+/fz3/86VL8EAbuiiAKEoiMLwGcHdCQMBiUAlurDErmJ75tmKP8A3oiJyuF6vAxglws+0C5pv81GJaJdzhlWMMJssaaXM3C0CpmSDLAQtgH3BiCIVB2NRMKWEIoXQMBiLgjHGP9nQ+6ZPLgqGgs9xriDovX8A6Jjgw8ZyIigzn5xz+yZ+6O/tsz7Hy8tb/PLlywPAHMOFT/G3LwRc95fxPyerQCojuKwLDLQAGjoJWIzpAw1mw6bB0guHSYyMDBysnO/5hUTTGvM3rQEAI8qCnLiY3O4AAAAASUVORK5CYII=","customTitle":"Shields.io","customDescription":"开源项目的质量元数据徽章"},{"title":"diagrams.net","url":"https://app.diagrams.net/?tdsourcetag=s_pctim_aiomsg#G1fMS2g_n3fuV8FyS5o3faiOwtPGs-uL24","favIconUrl":"https://app.diagrams.net/favicon.ico","customTitle":"diagrams.net","customDescription":"流程图"},{"title":"Carbon | Create and share beautiful images of your source code","url":"https://carbon.now.sh/?bg=rgba(171%2C%20184%2C%20195%2C%201)&t=seti&wt=none&l=auto&ds=true&dsyoff=20px&dsblur=68px&wc=true&wa=true&pv=56px&ph=56px&ln=false&fm=Hack&fs=14px&lh=133%25&si=false&es=2x&wm=false","favIconUrl":"https://carbon.now.sh/favicon.ico","customTitle":"Carbon","customDescription":"Carbon | Create and share beautiful images of your source code"},{"title":"Free Icons in SVG / PNG + Animated in GIF / APNG · Loading.io","url":"https://loading.io/icon/","favIconUrl":"https://loading.io/favicon.ico","customTitle":"Free Icons in SVG / PNG + Animated in GIF / APNG · Loading.io","customDescription":"带动画SVG"},{"title":"Text to ASCII Art Generator (TAAG)","url":"http://patorjk.com/software/taag/#p=testall&h=2&v=2&f=Bulbhead&t=tanjie","favIconUrl":"","customTitle":"Text to ASCII Art Generator (TAAG)","customDescription":"文字转ASCII"},{"title":"cubic-bezier(.17,.67,.83,.67) ✿ cubic-bezier.com","url":"https://cubic-bezier.com/#.17,.67,.83,.67","favIconUrl":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAtRJREFUWEftll1IU2Ecxp8zt6mtdHObbs2vTNT5QQ7SBHEZYpJG1E3khRdBXhR21U1SsF1U3oQQ3RVCMYT0IgpMVruI3IXL1CWmbmXqtOnMj/mx3ObaFudo4MfOYHK2ddH/7nBe3uf3Ps///SDQoVOBgBpRKb+KQKfOHxXtbdH/ABFzoDolCbr55X1pRwRAnsDDUHUZnkz8wE2jGTubLuwARYmHoa1QUCuXdekj6wBpu6a0ELExLNT0GNG3vBo5AHVBFm7nZeK7w4nWrxa0Tc4G3O2MR0Dm/ag4F0oxH8+mZtE58xOjaw7YXJvhBRBwOWjOy8StnAzYXG5cNgxTltekCNE1t0h71gV1IP1QHC7JkvFmbhHjjo2Ak3BYBOrTJHheWgCX14f7Y5N4YJpCFi8eTdmp0FhsGLCvHQxAKRagMUuGF9M2CmJvnRYL0H6qELL4WLRP29DYPwqn10cNOy8VoTJZgNfWBegXVw4GcITNRp1UiJfWBWz6tib+W+TWqkpJgtG+joa+EZjXf+36z2WxkMhhY8XjgcdHf90EjYDcw6St33bYXykWoK0kH9K4WFwfHEPHzDw15qAVFIC0UWtbwm//1grq0yXQlBagd2kV1/pHYV4P3BehwAQFqJWK0L2d/b3C49S+Vo1M4KHZAveeSEIR3TmWFoBNECgX8fFhwY678mNolmeiVv+Z+mayaAHyE3hU81w4KkZLUTaufhqhOp3pogW4kiaBJI6L1uIc3BkeR4tpimltaj5agIYMKR4rcqlTrOHjl11XKJMktABDZ8soB+TaXixvepjU3DVXQIA6qQivyk/gxqAJTyesYROnjcBQVYIYgoDy/QCcXm/kAewXK9E0aApL1+9dzb4IzkmE6K5QILVLD6vTHdbV74uAANBz5iT4HDaK3hnCLk7bA+Q7YHrDFT2AiChvizD+JgwV/h8A6HirBsFShUrOyHg/1H8AtegvrVPeS60AAAAASUVORK5CYII=","customTitle":"✿ cubic-bezier.com","customDescription":"生成贝塞尔曲线"},{"title":"Epic Spinners","url":"https://epic-spinners.epicmax.co/","favIconUrl":"https://epic-spinners.epicmax.co/favicon.ico","customTitle":"","customDescription":""}],"labels":[]}]},{"version":3,"lists":[{"title":"游戏","cards":[{"title":"Spine: Demos","url":"http://zh.esotericsoftware.com/spine-demos","favIconUrl":"http://zh.esotericsoftware.com/img/favicon/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Shadertoy BETA","url":"https://www.shadertoy.com/","favIconUrl":"https://www.shadertoy.com/img/favicon.ico","customTitle":"","customDescription":""},{"title":"Metaverse Full-Body Online 3D Avatar Creator | Ready Player Me","url":"https://readyplayer.me/","favIconUrl":"https://readyplayer.me/images/favicon-32x32.png","customTitle":"","customDescription":""},{"title":"Mixamo","url":"https://www.mixamo.com/#/","favIconUrl":"https://www.mixamo.com/favicon.ico","customTitle":"","customDescription":""},{"title":"Explore 3D Models - Sketchfab","url":"https://sketchfab.com/3d-models?features=downloadable&sort_by=-likeCount","favIconUrl":"https://static.sketchfab.com/static/builds/web/dist/static/assets/images/favicon/2f53b6d625305dad5f61e53c5b3d8125-v2.png","customTitle":"","customDescription":""},{"title":"PlayCanvas WebGL Game Engine","url":"https://playcanvas.com/","favIconUrl":"https://playcanvas.com/static-assets/images/icons/favicon.png","customTitle":"","customDescription":""},{"title":"Medieval Town (base) 3D assets | OpenGameArt.org","url":"https://opengameart.org/content/medieval-town-base-3d-assets","favIconUrl":"https://opengameart.org/sites/all/themes/oga/opengameart2_favicon.ico","customTitle":"","customDescription":""},{"title":"Blend Swap | Home","url":"https://blendswap.com/","favIconUrl":"https://blendswap.com/static/img/favicon.ico","customTitle":"","customDescription":""},{"title":"Kaboom","url":"https://kaboomjs.com/","favIconUrl":"https://kaboomjs.com/site/img/k.png","customTitle":"","customDescription":""},{"title":"Unity Asset Collection | All Unity Assets That You Need","url":"https://unityassetcollection.com/","favIconUrl":"","customTitle":"","customDescription":""}],"labels":[]}]}],"books":[{"cover":"/bookmark/2022-06-08-14-43-51.png","name":"《边城》"},{"cover":"/bookmark/2022-05-22-18-58-23.png","name":"《在细雨中呼喊》"},{"cover":"/bookmark/2022-05-22-18-59-43.png","name":"《活着》"},{"cover":"/bookmark/2022-06-08-14-37-35.png","name":"《蛙》"},{"cover":"/bookmark/2022-06-08-14-40-51.png","name":"《丰/乳/肥/臀》"},{"cover":"/bookmark/2022-06-08-14-41-41.png","name":"《天堂蒜薹之歌》"},{"cover":"/bookmark/2022-06-08-14-45-12.png","name":"《人间失格》"}],"skills":[{"name":"JavaScript","cover":"/bookmark/2022-05-23-08-24-51.png"},{"name":"HTML","cover":"/bookmark/2022-05-23-08-26-29.png"},{"name":"CSS","cover":"/bookmark/2022-05-23-08-27-06.png"},{"name":"Vue","cover":"/bookmark/2022-05-23-08-27-44.png"},{"name":"React","cover":"/bookmark/2022-05-23-08-28-52.png"},{"name":"Node","cover":"/bookmark/2022-05-23-08-30-12.png"},{"name":"TypeScript","cover":"/bookmark/2022-05-23-08-31-32.png"}],"tools":[{"name":"VS code","cover":"/bookmark/2022-05-23-17-23-45.png"},{"name":"Unity","cover":"/bookmark/2022-05-23-17-27-18.png"},{"name":"Termius","cover":"/bookmark/2022-05-23-17-28-46.png"},{"name":"Rider","cover":"/bookmark/2022-05-23-17-34-54.png"},{"name":"SourceTree","cover":"/bookmark/2022-05-23-17-36-38.png"},{"name":"Docker","cover":"/bookmark/2022-05-23-17-37-38.png"}]}}}'</script><link rel="stylesheet" href="/assets/2019-8-14-nosql.0c9c6b89.css"><link rel="stylesheet" href="/assets/app.016e68df.css"></body></html>